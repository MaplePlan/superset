"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8551],{88551:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var r=n(78580),l=n.n(r),a=n(67294),o=n(63475),u=n(6915),c=n(51995),s=n(356),i=n(49239),h=n(11965);const{RadioButtonControl:f}=s.Z,d=c.iK.div`
  text-align: center;
`;function g(e){let{formData:t,setControlValue:n}=e;const{extraControlsOptions:r,extraControlsHandler:l,extraValue:o}=function(e){let{formData:t,setControlValue:n}=e;const{stack:r,area:l}=t,[o,u]=(0,a.useState)(null!=r?r:void 0);return(0,a.useEffect)((()=>{u(r)}),[r]),{extraControlsOptions:(0,a.useMemo)((()=>l?i.O0:[]),[l]),extraControlsHandler:(0,a.useCallback)((e=>{l&&n&&(n("stack",e),u(e))}),[l,n]),extraValue:o}}({formData:t,setControlValue:n});return t.showExtraControls?(0,h.tZ)(d,null,(0,h.tZ)(f,{options:r,onChange:l,value:o})):null}function p(e){let{formData:t,height:n,width:r,echartOptions:c,groupby:s,labelMap:i,selectedValues:f,setDataMask:d,setControlValue:p,legendData:m=[],onContextMenu:v,xValueFormatter:C}=e;const{emitFilter:b,stack:w}=t,x=(0,a.useRef)(null),E=(0,a.useRef)(Date.now()),k=(0,a.useRef)(""),y=(0,a.useRef)(),I=(0,a.useRef)(null),[V,S]=(0,a.useState)(0);(0,a.useEffect)((()=>{var e;const t=(null==(e=I.current)?void 0:e.offsetHeight)||0;S(t)}),[t.showExtraControls]);const O=(0,a.useCallback)((e=>{var t;const n=null==(t=x.current)?void 0:t.getEchartInstance();e?m.forEach((t=>{t===e?(u.aI.legend=t,null==n||n.dispatchAction({type:"legendSelect",name:t})):null==n||n.dispatchAction({type:"legendUnSelect",name:t})})):(u.aI.legend="",null==n||n.dispatchAction({type:"legendAllSelect"}))}),[m]),Z=(0,a.useCallback)((e=>{if(!b)return;const t=e.map((e=>i[e]));d({extraFormData:{filters:0===e.length?[]:s.map(((e,n)=>{const r=t.map((e=>e[n]));return null==r?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:r}}))},filterState:{label:t.length?t:void 0,value:t.length?t:null,selectedValues:e.length?e:null}})}),[s,i,d,b]),D={click:e=>{y.current&&clearTimeout(y.current),y.current=setTimeout((()=>{const{seriesName:t}=e,n=Object.values(f);l()(n).call(n,t)?Z(n.filter((e=>e!==t))):Z([t])}),300)},mouseout:()=>{u.aI.name=""},mouseover:e=>{u.aI.name=e.seriesName},legendselectchanged:e=>{const t=Date.now();t-E.current<300&&k.current===e.name?O(e.name):(E.current=t,k.current=e.name),Object.values(e.selected).every((e=>!e))&&O()},contextmenu:e=>{if(v){e.event.stop();const{data:n}=e;if(n){const r=e.event.event,l=i[e.seriesName],a=[];a.push({col:t.granularitySqla,grain:t.timeGrainSqla,op:"==",val:n[0],formattedVal:C(n[0])}),t.groupby.forEach(((e,t)=>a.push({col:e,op:"==",val:l[t],formattedVal:String(l[t])}))),v(a,r.clientX,r.clientY)}}}},R={dblclick:e=>{var t;y.current&&clearTimeout(y.current);const n=[e.offsetX,e.offsetY],r=null==(t=x.current)?void 0:t.getEchartInstance();if(null!=r&&r.containPixel("grid",n)){var l;if(!w&&"ec-polygon"===(null==(l=e.target)?void 0:l.type))return;const t=r.getModel(),n=((e,t)=>{let n=e,r=null;for(;n;){const e=n.__ecComponentInfo;if(null!=e){r=t.getComponent(e.mainType,e.index);break}n=n.parent}return r})(e.target,t),a=t.getSeriesCount(),o=t.getCurrentSeriesIndices();if(n){const{name:e}=n;a!==o.length?O():O(e)}}}};return(0,h.tZ)(a.Fragment,null,(0,h.tZ)("div",{ref:I},(0,h.tZ)(g,{formData:t,setControlValue:p})),(0,h.tZ)(o.Z,{ref:x,height:n-V,width:r,echartOptions:c,eventHandlers:D,zrEventHandlers:R,selectedValues:f}))}},63475:(e,t,n)=>{n.d(t,{Z:()=>h});var r=n(78580),l=n.n(r),a=n(67294),o=n(51995),u=n(29027),c=n(11965);const s=o.iK.div`
  height: ${e=>{let{height:t}=e;return t}};
  width: ${e=>{let{width:t}=e;return t}};
`;function i(e,t){let{width:n,height:r,echartOptions:o,eventHandlers:i,zrEventHandlers:h,selectedValues:f={}}=e;const d=(0,a.useRef)(null),g=(0,a.useRef)(),p=(0,a.useMemo)((()=>Object.keys(f)||[]),[f]),m=(0,a.useRef)([]);(0,a.useImperativeHandle)(t,(()=>({getEchartInstance:()=>g.current}))),(0,a.useEffect)((()=>{d.current&&(g.current||(g.current=(0,u.S1)(d.current)),Object.entries(i||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=g.current)||t.off(r),null==(n=g.current)||n.on(r,l)})),Object.entries(h||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=g.current)||t.getZr().off(r),null==(n=g.current)||n.getZr().on(r,l)})),g.current.setOption(o,!0))}),[o,i,h]),(0,a.useEffect)((()=>{g.current&&(g.current.dispatchAction({type:"downplay",dataIndex:m.current.filter((e=>!l()(p).call(p,e)))}),p.length&&g.current.dispatchAction({type:"highlight",dataIndex:p}),m.current=p)}),[p]);const v=(0,a.useCallback)((e=>{let{width:t,height:n}=e;g.current&&g.current.resize({width:t,height:n})}),[]);return(0,a.useEffect)((()=>{v({width:n,height:r})}),[]),(0,a.useLayoutEffect)((()=>{v({width:n,height:r})}),[n,r,v]),(0,c.tZ)(s,{ref:d,height:r,width:n})}const h=(0,a.forwardRef)(i)}}]);
//# sourceMappingURL=e7e046dea522bfd04fc4.chunk.js.map