/*! For license information please see 1c2cabebf09fa34ae42b.chunk.js.LICENSE.txt */
(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[452],{8177:(e,t,n)=>{e.exports={default:n(77084),__esModule:!0}},77084:(e,t,n)=>{n(75789);var r=n(94731).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},75789:(e,t,n)=>{var r=n(64874),i=n(18437).f;n(44903)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},50139:(e,t)=>{"use strict";t.__esModule=!0,t.default=void 0;var n=!("undefined"==typeof window||!window.document||!window.document.createElement);t.default=n,e.exports=t.default},44825:(e,t,n)=>{"use strict";var r=n(95318);t.__esModule=!0,t.default=function(e){if((!i&&0!==i||e)&&o.default){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),i=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return i};var i,o=r(n(50139));e.exports=t.default},82689:(e,t,n)=>{var r=n(29932),i=n(97786),o=n(67206),a=n(69199),s=n(71131),l=n(7518),d=n(85022),c=n(6557),u=n(1469);e.exports=function(e,t,n){t=t.length?r(t,(function(e){return u(e)?function(t){return i(t,1===e.length?e[0]:e)}:e})):[c];var h=-1;t=r(t,l(o));var p=a(e,(function(e,n,i){return{criteria:r(t,(function(t){return t(e)})),index:++h,value:e}}));return s(p,(function(e,t){return d(e,t,n)}))}},71131:e=>{e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},26393:(e,t,n)=>{var r=n(33448);e.exports=function(e,t){if(e!==t){var n=void 0!==e,i=null===e,o=e==e,a=r(e),s=void 0!==t,l=null===t,d=t==t,c=r(t);if(!l&&!c&&!a&&e>t||a&&s&&d&&!l&&!c||i&&s&&d||!n&&d||!o)return 1;if(!i&&!a&&!c&&e<t||c&&n&&o&&!i&&!a||l&&n&&o||!s&&o||!d)return-1}return 0}},85022:(e,t,n)=>{var r=n(26393);e.exports=function(e,t,n){for(var i=-1,o=e.criteria,a=t.criteria,s=o.length,l=n.length;++i<s;){var d=r(o[i],a[i]);if(d)return i>=l?d:d*("desc"==n[i]?-1:1)}return e.index-t.index}},94654:(e,t,n)=>{var r=n(21078),i=n(35161);e.exports=function(e,t){return r(i(e,t),1)}},10752:(e,t,n)=>{var r=n(21078),i=n(35161);e.exports=function(e,t){return r(i(e,t),1/0)}},28368:(e,t,n)=>{var r=n(90939);e.exports=function(e,t,n){var i=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===i?r(e,t,void 0,n):!!i}},89734:(e,t,n)=>{var r=n(21078),i=n(82689),o=n(5976),a=n(16612),s=o((function(e,t){if(null==e)return[];var n=t.length;return n>1&&a(e,t[0],t[1])?t=[]:n>2&&a(t[0],t[1],t[2])&&(t=[t[0]]),i(e,r(t,1),[])}));e.exports=s},44908:(e,t,n)=>{var r=n(45652);e.exports=function(e){return e&&e.length?r(e):[]}},87185:(e,t,n)=>{var r=n(45652);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?r(e,void 0,t):[]}},75:function(e,t,n){var r=n(34155);(function(){var t,n,i,o,a,s;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=r&&r.hrtime?(e.exports=function(){return(t()-a)/1e6},n=r.hrtime,o=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*r.uptime(),a=o-s):Date.now?(e.exports=function(){return Date.now()-i},i=Date.now()):(e.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(this)},54087:(e,t,n)=>{for(var r=n(75),i="undefined"==typeof window?n.g:window,o=["moz","webkit"],a="AnimationFrame",s=i["request"+a],l=i["cancel"+a]||i["cancelRequest"+a],d=0;!s&&d<o.length;d++)s=i[o[d]+"Request"+a],l=i[o[d]+"Cancel"+a]||i[o[d]+"CancelRequest"+a];if(!s||!l){var c=0,u=0,h=[];s=function(e){if(0===h.length){var t=r(),n=Math.max(0,16.666666666666668-(t-c));c=n+t,setTimeout((function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(n))}return h.push({handle:++u,callback:e,cancelled:!1}),u},l=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}e.exports=function(e){return s.call(i,e)},e.exports.cancel=function(){l.apply(i,arguments)},e.exports.polyfill=function(e){e||(e=i),e.requestAnimationFrame=s,e.cancelAnimationFrame=l}},28388:(e,t,n)=>{var r;window,e.exports=(r=n(67294),function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}([function(e,t,n){e.exports=n(96)()},function(e,t){e.exports=r},function(e,t,n){var r=n(16),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();e.exports=o},function(e,t,n){var r=n(41),i=n(47);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},function(e,t,n){var r=n(31),i=n(32),o=n(33),a=n(34),s=n(35);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var r=n(14);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(12),i=n(43),o=n(44),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},function(e,t,n){var r=n(3)(Object,"create");e.exports=r},function(e,t,n){var r=n(56);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var r;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r)&&r.length){var a=i.apply(null,r);a&&e.push(a)}else if("object"===o)for(var s in r)n.call(r,s)&&r[s]&&e.push(s)}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(r=function(){return i}.apply(t,[]))||(e.exports=r)}()},function(e,t,n){var r=n(3)(n(2),"Map");e.exports=r},function(e,t,n){var r=n(2).Symbol;e.exports=r},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(6),i=n(17);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(42))},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(48),i=n(55),o=n(57),a=n(58),s=n(59);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var r=n(60),i=n(63),o=n(64);e.exports=function(e,t,n,a,s,l){var d=1&n,c=e.length,u=t.length;if(c!=u&&!(d&&u>c))return!1;var h=l.get(e);if(h&&l.get(t))return h==t;var p=-1,f=!0,m=2&n?new r:void 0;for(l.set(e,t),l.set(t,e);++p<c;){var g=e[p],v=t[p];if(a)var b=d?a(v,g,p,t,e,l):a(g,v,p,e,t,l);if(void 0!==b){if(b)continue;f=!1;break}if(m){if(!i(t,(function(e,t){if(!o(m,t)&&(g===e||s(g,e,n,a,l)))return m.push(t)}))){f=!1;break}}else if(g!==v&&!s(g,v,n,a,l)){f=!1;break}}return l.delete(e),l.delete(t),f}},function(e,t,n){(function(e){var r=n(2),i=n(81),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o?r.Buffer:void 0,l=(s?s.isBuffer:void 0)||i;e.exports=l}).call(this,n(22)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(83),i=n(84),o=n(85),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,n){var r=n(28);e.exports=function(e,t){return r(e,t)}},function(e,t,n){var r=self.crypto||self.msCrypto;e.exports=function(e){e=e||21;for(var t="",n=r.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz-"[63&n[e]];return t}},function(e,t,n){e.exports=n(98).default},function(e,t,n){var r=n(29),i=n(9);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,o,a,e,s))}},function(e,t,n){var r=n(30),i=n(20),o=n(65),a=n(69),s=n(91),l=n(13),d=n(21),c=n(23),u="[object Arguments]",h="[object Array]",p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,m,g,v){var b=l(e),y=l(t),C=b?h:s(e),S=y?h:s(t),x=(C=C==u?p:C)==p,w=(S=S==u?p:S)==p,k=C==S;if(k&&d(e)){if(!d(t))return!1;b=!0,x=!1}if(k&&!x)return v||(v=new r),b||c(e)?i(e,t,n,m,g,v):o(e,t,C,n,m,g,v);if(!(1&n)){var Z=x&&f.call(e,"__wrapped__"),R=w&&f.call(t,"__wrapped__");if(Z||R){var T=Z?e.value():e,F=R?t.value():t;return v||(v=new r),g(T,F,n,m,v)}}return!!k&&(v||(v=new r),a(e,t,n,m,g,v))}},function(e,t,n){var r=n(4),i=n(36),o=n(37),a=n(38),s=n(39),l=n(40);function d(e){var t=this.__data__=new r(e);this.size=t.size}d.prototype.clear=i,d.prototype.delete=o,d.prototype.get=a,d.prototype.has=s,d.prototype.set=l,e.exports=d},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(5),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():i.call(t,n,1),--this.size,0))}},function(e,t,n){var r=n(5);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(5);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(5);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},function(e,t,n){var r=n(4);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(4),i=n(11),o=n(19);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(15),i=n(45),o=n(17),a=n(18),s=/^\[object .+?Constructor\]$/,l=Function.prototype,d=Object.prototype,c=l.toString,u=d.hasOwnProperty,h=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?h:s).test(a(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(12),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,i=n(46),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var r=n(2)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(49),i=n(4),o=n(11);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},function(e,t,n){var r=n(50),i=n(51),o=n(52),a=n(53),s=n(54);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var r=n(7);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(7),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(7),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},function(e,t,n){var r=n(7);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(8);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(8);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(8);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(8);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},function(e,t,n){var r=n(19),i=n(61),o=n(62);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,e.exports=a},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(12),i=n(66),o=n(14),a=n(20),s=n(67),l=n(68),d=r?r.prototype:void 0,c=d?d.valueOf:void 0;e.exports=function(e,t,n,r,d,u,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!u(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var f=1&r;if(p||(p=l),e.size!=t.size&&!f)return!1;var m=h.get(e);if(m)return m==t;r|=2,h.set(e,t);var g=a(p(e),p(t),r,d,u,h);return h.delete(e),g;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},function(e,t,n){var r=n(2).Uint8Array;e.exports=r},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var r=n(70),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var l=1&n,d=r(e),c=d.length;if(c!=r(t).length&&!l)return!1;for(var u=c;u--;){var h=d[u];if(!(l?h in t:i.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var f=!0;s.set(e,t),s.set(t,e);for(var m=l;++u<c;){var g=e[h=d[u]],v=t[h];if(o)var b=l?o(v,g,h,t,e,s):o(g,v,h,e,t,s);if(!(void 0===b?g===v||a(g,v,n,o,s):b)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var y=e.constructor,C=t.constructor;y!=C&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof C&&C instanceof C)&&(f=!1)}return s.delete(e),s.delete(t),f}},function(e,t,n){var r=n(71),i=n(73),o=n(76);e.exports=function(e){return r(e,o,i)}},function(e,t,n){var r=n(72),i=n(13);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},function(e,t,n){var r=n(74),i=n(75),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return o.call(e,t)})))}:i;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var r=n(77),i=n(86),o=n(90);e.exports=function(e){return o(e)?r(e):i(e)}},function(e,t,n){var r=n(78),i=n(79),o=n(13),a=n(21),s=n(82),l=n(23),d=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&i(e),u=!n&&!c&&a(e),h=!n&&!c&&!u&&l(e),p=n||c||u||h,f=p?r(e.length,String):[],m=f.length;for(var g in e)!t&&!d.call(e,g)||p&&("length"==g||u&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,m))||f.push(g);return f}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(80),i=n(9),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},function(e,t,n){var r=n(6),i=n(9);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},function(e,t){e.exports=function(){return!1}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){var r=n(6),i=n(24),o=n(9),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(16),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===i&&r.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s}).call(this,n(22)(e))},function(e,t,n){var r=n(87),i=n(88),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(89)(Object.keys,Object);e.exports=r},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var r=n(15),i=n(24);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},function(e,t,n){var r=n(92),i=n(11),o=n(93),a=n(94),s=n(95),l=n(6),d=n(18),c=d(r),u=d(i),h=d(o),p=d(a),f=d(s),m=l;(r&&"[object DataView]"!=m(new r(new ArrayBuffer(1)))||i&&"[object Map]"!=m(new i)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(e){var t=l(e),n="[object Object]"==t?e.constructor:void 0,r=n?d(n):"";if(r)switch(r){case c:return"[object DataView]";case u:return"[object Map]";case h:return"[object Promise]";case p:return"[object Set]";case f:return"[object WeakMap]"}return t}),e.exports=m},function(e,t,n){var r=n(3)(n(2),"DataView");e.exports=r},function(e,t,n){var r=n(3)(n(2),"Promise");e.exports=r},function(e,t,n){var r=n(3)(n(2),"Set");e.exports=r},function(e,t,n){var r=n(3)(n(2),"WeakMap");e.exports=r},function(e,t,n){"use strict";var r=n(97);function i(){}e.exports=function(){function e(e,t,n,i,o,a){if(a!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=i,n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var r=n(10),i=n.n(r),o=n(25),a=n.n(o),s=n(26),l=n.n(s),d=n(0),c=n.n(d),u=n(1),h=n.n(u);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,v(t).apply(this,arguments))}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,h.a.PureComponent),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.children,n=e.title,r=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["children","title"]);return h.a.createElement("button",f({"aria-label":n,title:n,type:"button"},r),t)}}])&&m(n.prototype,r),t}();y(C,"propTypes",{children:c.a.node.isRequired,title:c.a.string}),y(C,"defaultProps",{title:null});var S=C;function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=t,this.flatNodes=n}var t,n;return t=e,(n=[{key:"setProps",value:function(e){this.props=e}},{key:"clone",value:function(){var t=this,n={};return Object.keys(this.flatNodes).forEach((function(e){var r=t.flatNodes[e];n[e]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}({},r)})),new e(this.props,n)}},{key:"getNode",value:function(e){return this.flatNodes[e]}},{key:"flattenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Array.isArray(e)&&0!==e.length){var i=this.props,o=i.disabled,a=i.noCascade;e.forEach((function(e,i){var s=t.nodeHasChildren(e);t.flatNodes[e.value]={label:e.label,value:e.value,children:e.children,parent:n,isParent:s,isLeaf:!s,showCheckbox:void 0===e.showCheckbox||e.showCheckbox,disabled:t.getDisabledState(e,n,o,a),treeDepth:r,index:i},t.flattenNodes(e.children,e,r+1)}))}}},{key:"nodeHasChildren",value:function(e){return Array.isArray(e.children)&&e.children.length>0}},{key:"getDisabledState",value:function(e,t,n,r){return!!n||!(r||!t.disabled)||Boolean(e.disabled)}},{key:"deserializeLists",value:function(e){var t=this,n=["checked","expanded"];Object.keys(this.flatNodes).forEach((function(e){n.forEach((function(n){t.flatNodes[e][n]=!1}))})),n.forEach((function(n){e[n].forEach((function(e){void 0!==t.flatNodes[e]&&(t.flatNodes[e][n]=!0)}))}))}},{key:"serializeList",value:function(e){var t=this,n=[];return Object.keys(this.flatNodes).forEach((function(r){t.flatNodes[r][e]&&n.push(r)})),n}},{key:"expandAllNodes",value:function(e){var t=this;return Object.keys(this.flatNodes).forEach((function(n){t.flatNodes[n].isParent&&(t.flatNodes[n].expanded=e)})),this}},{key:"toggleChecked",value:function(e,t,n){var r=this,i=this.flatNodes[e.value];if(i.isLeaf||n){if(e.disabled)return this;this.toggleNode(e.value,"checked",t)}else i.children.forEach((function(e){r.toggleChecked(e,t,n)}));return this}},{key:"toggleNode",value:function(e,t,n){return this.flatNodes[e][t]=n,this}}])&&w(t.prototype,n),e}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,D(t).apply(this,arguments))}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,h.a.PureComponent),n=t,(r=[{key:"componentDidMount",value:function(){this.updateDeterminateProperty()}},{key:"componentDidUpdate",value:function(){this.updateDeterminateProperty()}},{key:"updateDeterminateProperty",value:function(){var e=this.props.indeterminate;this.checkbox.indeterminate=e}},{key:"render",value:function(){var e=this,t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){E(e,t,n[t])}))}return e}({},this.props);return delete t.indeterminate,h.a.createElement("input",R({},t,{ref:function(t){e.checkbox=t},type:"checkbox"}))}}])&&T(n.prototype,r),t}();E(I,"propTypes",{indeterminate:c.a.bool}),E(I,"defaultProps",{indeterminate:!1});var M=I,O=c.a.shape({check:c.a.node,uncheck:c.a.node,halfCheck:c.a.node,expandClose:c.a.node,expandOpen:c.a.node,expandAll:c.a.node,collapseAll:c.a.node,parentClose:c.a.node,parentOpen:c.a.node,leaf:c.a.node}),P=c.a.shape({collapseAll:c.a.string.isRequired,expandAll:c.a.string.isRequired,toggle:c.a.string.isRequired});function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=function(e){function t(e){var n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this,(n=!(r=q(t).call(this,e))||"object"!==N(r)&&"function"!=typeof r?z(this):r).onCheck=n.onCheck.bind(z(z(n))),n.onClick=n.onClick.bind(z(z(n))),n.onExpand=n.onExpand.bind(z(z(n))),n}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(t,h.a.Component),n=t,(r=[{key:"onCheck",value:function(){var e=this.props,t=e.value;(0,e.onCheck)({value:t,checked:this.getCheckState({toggle:!0})})}},{key:"onClick",value:function(){var e=this.props,t=e.expandOnClick,n=e.isParent,r=e.value,i=e.onClick;n&&t&&this.onExpand(),i({value:r,checked:this.getCheckState({toggle:!1})})}},{key:"onExpand",value:function(){var e=this.props,t=e.expanded,n=e.value;(0,e.onExpand)({value:n,expanded:!t})}},{key:"getCheckState",value:function(e){var t=e.toggle,n=this.props,r=n.checked,i=n.optimisticToggle;return!(0!==r||!t)||1===r&&!t||2===r&&i}},{key:"renderCollapseButton",value:function(){var e=this.props,t=e.expandDisabled,n=e.isLeaf,r=e.lang;return n?h.a.createElement("span",{className:"rct-collapse"},h.a.createElement("span",{className:"rct-icon"})):h.a.createElement(S,{className:"rct-collapse rct-collapse-btn",disabled:t,title:r.toggle,onClick:this.onExpand},this.renderCollapseIcon())}},{key:"renderCollapseIcon",value:function(){var e=this.props,t=e.expanded,n=e.icons,r=n.expandClose,i=n.expandOpen;return t?i:r}},{key:"renderCheckboxIcon",value:function(){var e=this.props,t=e.checked,n=e.icons,r=n.uncheck,i=n.check,o=n.halfCheck;return 0===t?r:1===t?i:o}},{key:"renderNodeIcon",value:function(){var e=this.props,t=e.expanded,n=e.icon,r=e.icons,i=r.leaf,o=r.parentClose,a=r.parentOpen,s=e.isLeaf;return null!==n?n:s?i:t?a:o}},{key:"renderBareLabel",value:function(e){var t=this.props,n=t.onClick,r=t.title,i=null!==n;return h.a.createElement("span",{className:"rct-bare-label",title:r},i?h.a.createElement("span",{className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"button",tabIndex:0},e):e)}},{key:"renderCheckboxLabel",value:function(e){var t=this.props,n=t.checked,r=t.disabled,i=t.title,o=t.treeId,a=t.value,s=null!==t.onClick,l="".concat(o,"-").concat(String(a).split(" ").join("_")),d=[h.a.createElement("label",{key:0,htmlFor:l,title:i},h.a.createElement(M,{checked:1===n,disabled:r,id:l,indeterminate:2===n,onClick:this.onCheck,onChange:function(){}}),h.a.createElement("span",{className:"rct-checkbox"},this.renderCheckboxIcon()),s?null:e)];return s&&d.push(h.a.createElement("span",{key:1,className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"link",tabIndex:0},e)),d}},{key:"renderLabel",value:function(){var e=this.props,t=e.label,n=e.showCheckbox,r=[e.showNodeIcon?h.a.createElement("span",{key:0,className:"rct-node-icon"},this.renderNodeIcon()):null,h.a.createElement("span",{key:1,className:"rct-title"},t)];return n?this.renderCheckboxLabel(r):this.renderBareLabel(r)}},{key:"renderChildren",value:function(){return this.props.expanded?this.props.children:null}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.disabled,r=e.expanded,o=e.isLeaf,a=i()({"rct-node":!0,"rct-node-leaf":o,"rct-node-parent":!o,"rct-node-expanded":!o&&r,"rct-node-collapsed":!o&&!r,"rct-disabled":n},t);return h.a.createElement("li",{className:a},h.a.createElement("span",{className:"rct-text"},this.renderCollapseButton(),this.renderLabel()),this.renderChildren())}}])&&j(n.prototype,r),t}();A(U,"propTypes",{checked:c.a.number.isRequired,disabled:c.a.bool.isRequired,expandDisabled:c.a.bool.isRequired,expanded:c.a.bool.isRequired,icons:O.isRequired,isLeaf:c.a.bool.isRequired,isParent:c.a.bool.isRequired,label:c.a.node.isRequired,lang:P.isRequired,optimisticToggle:c.a.bool.isRequired,showNodeIcon:c.a.bool.isRequired,treeId:c.a.string.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,onCheck:c.a.func.isRequired,onExpand:c.a.func.isRequired,children:c.a.node,className:c.a.string,expandOnClick:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string,onClick:c.a.func}),A(U,"defaultProps",{children:null,className:null,expandOnClick:!1,icon:null,showCheckbox:!0,title:null,onClick:function(){}});var L=U,V=c.a.oneOfType([c.a.arrayOf(c.a.string),c.a.arrayOf(c.a.number)]);function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W={label:c.a.node.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,disabled:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string},B=c.a.oneOfType([c.a.shape(W),c.a.shape(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){K(e,t,n[t])}))}return e}({},W,{children:c.a.arrayOf(W).isRequired}))]);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ee(e,t,n[t])}))}return e}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(e){function t(e){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=!(r=J(t).call(this,e))||"object"!==H(r)&&"function"!=typeof r?X(this):r;var i=new k(e);return i.flattenNodes(e.nodes),i.deserializeLists({checked:e.checked,expanded:e.expanded}),n.state={id:e.id||"rct-".concat(l()(7)),model:i,prevProps:e},n.onCheck=n.onCheck.bind(X(X(n))),n.onExpand=n.onExpand.bind(X(X(n))),n.onNodeClick=n.onNodeClick.bind(X(X(n))),n.onExpandAll=n.onExpandAll.bind(X(X(n))),n.onCollapseAll=n.onCollapseAll.bind(X(X(n))),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,h.a.Component),n=t,o=[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.model,r=t.prevProps,i=e.disabled,o=e.id,s=e.nodes,l=G({},t,{prevProps:e});return n.setProps(e),a()(r.nodes,s)&&r.disabled===i||n.flattenNodes(s),null!==o&&(l=G({},l,{id:o})),n.deserializeLists({checked:e.checked,expanded:e.expanded}),l}}],(r=[{key:"onCheck",value:function(e){var t=this.props,n=t.noCascade,r=t.onCheck,i=this.state.model.clone(),o=i.getNode(e.value);i.toggleChecked(e,e.checked,n),r(i.serializeList("checked"),G({},o,e))}},{key:"onExpand",value:function(e){var t=this.props.onExpand,n=this.state.model.clone(),r=n.getNode(e.value);n.toggleNode(e.value,"expanded",e.expanded),t(n.serializeList("expanded"),G({},r,e))}},{key:"onNodeClick",value:function(e){(0,this.props.onClick)(G({},this.state.model.getNode(e.value),e))}},{key:"onExpandAll",value:function(){this.expandAllNodes()}},{key:"onCollapseAll",value:function(){this.expandAllNodes(!1)}},{key:"expandAllNodes",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,this.props.onExpand)(this.state.model.clone().expandAllNodes(e).serializeList("expanded"))}},{key:"determineShallowCheckState",value:function(e,t){var n=this.state.model.getNode(e.value);return n.isLeaf||t?n.checked?1:0:this.isEveryChildChecked(e)?1:this.isSomeChildChecked(e)?2:0}},{key:"isEveryChildChecked",value:function(e){var t=this;return e.children.every((function(e){return 1===t.state.model.getNode(e.value).checkState}))}},{key:"isSomeChildChecked",value:function(e){var t=this;return e.children.some((function(e){return t.state.model.getNode(e.value).checkState>0}))}},{key:"renderTreeNodes",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.props,o=i.expandDisabled,a=i.expandOnClick,s=i.icons,l=i.lang,d=i.noCascade,c=i.onClick,u=i.onlyLeafCheckboxes,p=i.optimisticToggle,f=i.showNodeTitle,m=i.showNodeIcon,g=this.state,v=g.id,b=g.model,y=t.defaultProps.icons,C=e.map((function(e){var t=e.value,i=b.getNode(e.value),g=i.isParent?n.renderTreeNodes(e.children,e):null;i.checkState=n.determineShallowCheckState(e,d);var C=u?i.isLeaf:i.showCheckbox;return!r.value||b.getNode(r.value).expanded?h.a.createElement(L,{key:t,checked:i.checkState,className:e.className,disabled:i.disabled,expandDisabled:o,expandOnClick:a,expanded:i.expanded,icon:e.icon,icons:G({},y,s),label:e.label,lang:l,optimisticToggle:p,isLeaf:i.isLeaf,isParent:i.isParent,showCheckbox:C,showNodeIcon:m,title:f?e.title||e.label:e.title,treeId:v,value:e.value,onCheck:n.onCheck,onClick:c&&n.onNodeClick,onExpand:n.onExpand},g):null}));return h.a.createElement("ol",null,C)}},{key:"renderExpandAll",value:function(){var e=this.props,t=e.icons,n=t.expandAll,r=t.collapseAll,i=e.lang;return e.showExpandAll?h.a.createElement("div",{className:"rct-options"},h.a.createElement(S,{className:"rct-option rct-option-expand-all",title:i.expandAll,onClick:this.onExpandAll},n),h.a.createElement(S,{className:"rct-option rct-option-collapse-all",title:i.collapseAll,onClick:this.onCollapseAll},r)):null}},{key:"renderHiddenInput",value:function(){var e=this.props,t=e.name,n=e.nameAsArray;return void 0===t?null:n?this.renderArrayHiddenInput():this.renderJoinedHiddenInput()}},{key:"renderArrayHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name;return t.map((function(e){var t="".concat(n,"[]");return h.a.createElement("input",{key:e,name:t,type:"hidden",value:e})}))}},{key:"renderJoinedHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name,r=t.join(",");return h.a.createElement("input",{name:n,type:"hidden",value:r})}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.nodes,r=e.nativeCheckboxes,o=this.renderTreeNodes(n),a=i()({"react-checkbox-tree":!0,"rct-disabled":t,"rct-native-display":r});return h.a.createElement("div",{className:a},this.renderExpandAll(),this.renderHiddenInput(),o)}}])&&Y(n.prototype,r),o&&Y(n,o),t}();ee(te,"propTypes",{nodes:c.a.arrayOf(B).isRequired,checked:V,disabled:c.a.bool,expandDisabled:c.a.bool,expandOnClick:c.a.bool,expanded:V,icons:O,id:c.a.string,lang:P,name:c.a.string,nameAsArray:c.a.bool,nativeCheckboxes:c.a.bool,noCascade:c.a.bool,onlyLeafCheckboxes:c.a.bool,optimisticToggle:c.a.bool,showExpandAll:c.a.bool,showNodeIcon:c.a.bool,showNodeTitle:c.a.bool,onCheck:c.a.func,onClick:c.a.func,onExpand:c.a.func}),ee(te,"defaultProps",{checked:[],disabled:!1,expandDisabled:!1,expandOnClick:!1,expanded:[],icons:{check:h.a.createElement("span",{className:"rct-icon rct-icon-check"}),uncheck:h.a.createElement("span",{className:"rct-icon rct-icon-uncheck"}),halfCheck:h.a.createElement("span",{className:"rct-icon rct-icon-half-check"}),expandClose:h.a.createElement("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:h.a.createElement("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:h.a.createElement("span",{className:"rct-icon rct-icon-expand-all"}),collapseAll:h.a.createElement("span",{className:"rct-icon rct-icon-collapse-all"}),parentClose:h.a.createElement("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:h.a.createElement("span",{className:"rct-icon rct-icon-parent-open"}),leaf:h.a.createElement("span",{className:"rct-icon rct-icon-leaf"})},id:null,lang:{collapseAll:"Collapse all",expandAll:"Expand all",toggle:"Toggle"},name:void 0,nameAsArray:!1,nativeCheckboxes:!1,noCascade:!1,onlyLeafCheckboxes:!1,optimisticToggle:!0,showExpandAll:!1,showNodeIcon:!0,showNodeTitle:!1,onCheck:function(){},onClick:null,onExpand:function(){}}),t.default=te}]))},9238:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>te,DragSource:()=>q,DropTarget:()=>K});var r=n(28195);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e){return"function"==typeof e}function a(){}function s(e){if(!function(e){return"object"===i(e)&&null!==e}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function l(e){var t=e.current;return null==t?null:t.decoratedRef?t.decoratedRef.current:t}function d(e){return(t=e)&&t.prototype&&"function"==typeof t.prototype.render||function(e){var t;return"Symbol(react.forward_ref)"===(null==e||null===(t=e.$$typeof)||void 0===t?void 0:t.toString())}(e);var t}var c=n(67294),u=n(15047),h=n(8679),p=n.n(h),f=n(82514);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}var b=function(){var e=function(){function e(t){m(this,e),this.isDisposed=!1,this.action=o(t)?t:a}return v(e,[{key:"dispose",value:function(){this.isDisposed||(this.action(),this.isDisposed=!0)}}],[{key:"isDisposable",value:function(e){return Boolean(e&&o(e.dispose))}},{key:"_fixup",value:function(t){return e.isDisposable(t)?t:e.empty}},{key:"create",value:function(t){return new e(t)}}]),e}();return e.empty={dispose:a},e}(),y=function(){function e(){m(this,e),this.isDisposed=!1;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.disposables=n}return v(e,[{key:"add",value:function(e){this.isDisposed?e.dispose():this.disposables.push(e)}},{key:"remove",value:function(e){var t=!1;if(!this.isDisposed){var n=this.disposables.indexOf(e);-1!==n&&(t=!0,this.disposables.splice(n,1),e.dispose())}return t}},{key:"clear",value:function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var r=0;r<e;r++)t[r].dispose()}}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var r=0;r<e;r++)t[r].dispose()}}}]),e}(),C=function(){function e(){m(this,e),this.isDisposed=!1}return v(e,[{key:"getDisposable",value:function(){return this.current}},{key:"setDisposable",value:function(e){var t=this.isDisposed;if(!t){var n=this.current;this.current=e,n&&n.dispose()}t&&e&&e.dispose()}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}}}]),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function Z(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function T(e){var t=e.DecoratedComponent,n=e.createHandler,i=e.createMonitor,o=e.createConnector,a=e.registerHandler,s=e.containerDisplayName,l=e.getType,h=e.collect,m=e.options.arePropsEqual,g=void 0===m?u.w:m,v=t,S=t.displayName||t.name||"Component",T=function(){var e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(F,e);var t,s,p,m,T=(p=F,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(p);if(m){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Z(this,e)});function F(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,F),(t=T.call(this,e)).decoratedRef=c.createRef(),t.handleChange=function(){var e=t.getCurrentState();(0,u.w)(e,t.state)||t.setState(e)},t.disposable=new C,t.receiveProps(e),t.dispose(),t}return t=F,(s=[{key:"getHandlerId",value:function(){return this.handlerId}},{key:"getDecoratedComponentInstance",value:function(){return(0,r.k)(this.decoratedRef.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.decoratedRef.current}},{key:"shouldComponentUpdate",value:function(e,t){return!g(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.disposable=new C,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()}},{key:"componentDidUpdate",value:function(e){g(this.props,e)||(this.receiveProps(this.props),this.handleChange())}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"receiveProps",value:function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(l(e)))}},{key:"receiveType",value:function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=(o=a(e,this.handler,this.manager),s=2,function(e){if(Array.isArray(e))return e}(o)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(o,s)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(o,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=t[0],r=t[1];this.handlerId=n,this.handlerMonitor.receiveHandlerId(n),this.handlerConnector.receiveHandlerId(n);var i=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[n]});this.disposable.setDisposable(new y(new b(i),new b(r)))}var o,s}},{key:"dispose",value:function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)}},{key:"getCurrentState",value:function(){return this.handlerConnector?h(this.handlerConnector.hooks,this.handlerMonitor,this.props):{}}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return e.receiveDragDropManager(n),"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame((function(){var t;return null===(t=e.handlerConnector)||void 0===t?void 0:t.reconnect()})),c.createElement(v,Object.assign({},e.props,e.getCurrentState(),{ref:d(v)?e.decoratedRef:null}))}))}},{key:"receiveDragDropManager",value:function(e){void 0===this.manager&&((0,r.k)(void 0!==e,"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",S,S),void 0!==e&&(this.manager=e,this.handlerMonitor=i(e),this.handlerConnector=o(e.getBackend()),this.handler=n(this.handlerMonitor,this.decoratedRef)))}}])&&w(t.prototype,s),F}(c.Component);return e.DecoratedComponent=t,e.displayName="".concat(s,"(").concat(S,")"),e}();return p()(T,t)}var F=n(33273),D=n(60938),_=n(8556);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function I(e,t){return"string"==typeof e||"symbol"===E(e)||!!t&&Array.isArray(e)&&e.every((function(e){return I(e,!1)}))}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=["canDrag","beginDrag","isDragging","endDrag"],P=["beginDrag"],N=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.beginDrag=function(){if(i.props)return i.spec.beginDrag(i.props,i.monitor,i.ref.current)},this.spec=t,this.monitor=n,this.ref=r}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"canDrag",value:function(){return!!this.props&&(!this.spec.canDrag||this.spec.canDrag(this.props,this.monitor))}},{key:"isDragging",value:function(e,t){return!!this.props&&(this.spec.isDragging?this.spec.isDragging(this.props,this.monitor):t===e.getSourceId())}},{key:"endDrag",value:function(){this.props&&this.spec.endDrag&&this.spec.endDrag(this.props,this.monitor,l(this.ref))}}])&&M(t.prototype,n),e}();function j(e){return Object.keys(e).forEach((function(t){(0,r.k)(O.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',O.join(", "),t),(0,r.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),P.forEach((function(t){(0,r.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),function(t,n){return new N(e,t,n)}}function q(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,r.k)(I(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',e),o=function(){return e}),(0,r.k)(s(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',t);var a=j(t);return(0,r.k)("function"==typeof n,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),(0,r.k)(s(i),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),function(e){return T({containerDisplayName:"DragSource",createHandler:a,registerHandler:F.w,createConnector:function(e){return new _.x(e)},createMonitor:function(e){return new D.p(e)},DecoratedComponent:e,getType:o,collect:n,options:i})}}var $=n(89026),z=n(56941);function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=["canDrop","hover","drop"],L=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.spec=t,this.monitor=n,this.ref=r}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"receiveMonitor",value:function(e){this.monitor=e}},{key:"canDrop",value:function(){return!this.spec.canDrop||this.spec.canDrop(this.props,this.monitor)}},{key:"hover",value:function(){this.spec.hover&&this.props&&this.spec.hover(this.props,this.monitor,l(this.ref))}},{key:"drop",value:function(){if(this.spec.drop)return this.spec.drop(this.props,this.monitor,this.ref.current)}}])&&A(t.prototype,n),e}();function V(e){return Object.keys(e).forEach((function(t){(0,r.k)(U.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',U.join(", "),t),(0,r.k)("function"==typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target",t,t,e[t])})),function(t,n){return new L(e,t,n)}}function K(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,r.k)(I(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',e),o=function(){return e}),(0,r.k)(s(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',t);var a=V(t);return(0,r.k)("function"==typeof n,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),(0,r.k)(s(i),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),function(e){return T({containerDisplayName:"DropTarget",createHandler:a,registerHandler:F.n,createMonitor:function(e){return new z.H(e)},createConnector:function(e){return new $.Y(e)},DecoratedComponent:e,getType:o,collect:n,options:i})}}function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),e}function Y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}function J(e,t){return J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},J(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ee(e);if(t){var i=ee(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.k)("function"==typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer",e),(0,r.k)(s(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer',t),function(n){var i=n,o=t.arePropsEqual,a=void 0===o?u.w:o,s=i.displayName||i.name||"Component",l=function(){var t=function(t){Y(o,t);var n=Q(o);function o(){var e;return B(this,o),(e=n.apply(this,arguments)).isCurrentlyMounted=!1,e.ref=c.createRef(),e.handleChange=function(){if(e.isCurrentlyMounted){var t=e.getCurrentState();(0,u.w)(t,e.state)||e.setState(t)}},e}return G(o,[{key:"getDecoratedComponentInstance",value:function(){return(0,r.k)(this.ref.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.ref.current}},{key:"shouldComponentUpdate",value:function(e,t){return!a(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,this.handleChange()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return void 0===n?null:(e.receiveDragDropManager(n),e.isCurrentlyMounted?c.createElement(i,Object.assign({},e.props,e.state,{ref:d(i)?e.ref:null})):null)}))}},{key:"receiveDragDropManager",value:function(e){if(void 0===this.manager){this.manager=e,(0,r.k)("object"===W(e),"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",s,s);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}}},{key:"getCurrentState",value:function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)}}]),o}(c.Component);return t.displayName="DragLayer(".concat(s,")"),t.DecoratedComponent=n,t}();return p()(l,n)}}},84785:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>i.DragLayer,DragSource:()=>i.DragSource,DropTarget:()=>i.DropTarget});var r=n(31388);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var i=n(9238)},73897:()=>{},48058:()=>{},31388:(e,t,n)=>{"use strict";var r=n(75253);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var i=n(48058);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var o=n(72105);n.o(o,"DragLayer")&&n.d(t,{DragLayer:function(){return o.DragLayer}}),n.o(o,"DragSource")&&n.d(t,{DragSource:function(){return o.DragSource}}),n.o(o,"DropTarget")&&n.d(t,{DropTarget:function(){return o.DropTarget}});var a=n(73897);n.o(a,"DragLayer")&&n.d(t,{DragLayer:function(){return a.DragLayer}}),n.o(a,"DragSource")&&n.d(t,{DragSource:function(){return a.DragSource}}),n.o(a,"DropTarget")&&n.d(t,{DropTarget:function(){return a.DropTarget}})},75253:()=>{},72105:()=>{},46871:(e,t,n)=>{"use strict";function r(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function i(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function o(e,t){try{var n=this.props,r=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,r)}finally{this.props=n,this.state=r}}function a(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,s=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?s="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==s){var l=e.displayName||e.name,d="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+d+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=r,t.componentWillReceiveProps=i),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var c=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var r=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;c.call(this,e,t,r)}}return e}n.r(t),n.d(t,{polyfill:()=>a}),r.__suppressDeprecationWarning=!0,i.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0},24903:(e,t,n)=>{"use strict";t.cj=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(67294),o=l(i),a=l(n(45697)),s=n(76597);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchTerm:n.props.value||""},n.updateSearch=n.updateSearch.bind(n),n.filter=n.filter.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.value&&e.value!==this.props.value){var t={target:{value:e.value}};this.updateSearch(t)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=(e.onChange,e.caseSensitive,e.sortResults,e.throttle,e.filterKeys,e.value,e.fuzzy,e.inputClassName),r=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["className","onChange","caseSensitive","sortResults","throttle","filterKeys","value","fuzzy","inputClassName"]);return r.type=r.type||"search",r.value=this.state.searchTerm,r.onChange=this.updateSearch,r.className=n,r.placeholder=r.placeholder||"Search",o.default.createElement("div",{className:t},o.default.createElement("input",r))}},{key:"updateSearch",value:function(e){var t=this,n=e.target.value;this.setState({searchTerm:n},(function(){t._throttleTimeout&&clearTimeout(t._throttleTimeout),t._throttleTimeout=setTimeout((function(){return t.props.onChange(n)}),t.props.throttle)}))}},{key:"filter",value:function(e){var t=this.props,n=t.filterKeys,r=t.caseSensitive,i=t.fuzzy,o=t.sortResults;return(0,s.createFilter)(this.state.searchTerm,e||n,{caseSensitive:r,fuzzy:i,sortResults:o})}}]),t}(i.Component);d.defaultProps={className:"",onChange:function(){},caseSensitive:!1,fuzzy:!1,throttle:200},d.propTypes={className:a.default.string,inputClassName:a.default.string,onChange:a.default.func,caseSensitive:a.default.bool,sortResults:a.default.bool,fuzzy:a.default.bool,throttle:a.default.number,filterKeys:a.default.oneOf([a.default.string,a.default.arrayOf(a.default.string)]),value:a.default.string},t.cj=s.createFilter},76597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValuesForKey=a,t.searchStrings=s,t.createFilter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(r){if(""===e)return!0;n.caseSensitive||(e=e.toLowerCase());var i=e.split(" ");return t?("string"==typeof t&&(t=[t]),i.every((function(e){var i=void 0;if(-1!==e.indexOf(":")){var o=e.split(":")[0];e=e.split(":")[1],i=t.filter((function(e){return e.toLowerCase().indexOf(o)>-1}))}else i=t;return i.some((function(t){return s(a(t,r),e,n)}))}))):i.every((function(e){return s([r],e,n)}))}};var r,i=(r=n(69021))&&r.__esModule?r:{default:r};function o(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?o(t):t)}),[])}function a(e,t){var n=e.split("."),r=[t];return n.forEach((function(e){var t=[];r.forEach((function(n){if(n)if(n instanceof Array){var r=parseInt(e,10);if(!isNaN(r))return t.push(n[r]);n.forEach((function(n){t.push(n[e])}))}else n&&"function"==typeof n.get?t.push(n.get(e)):t.push(n[e])})),r=t})),(r=o(r=r.map((function(e){return e&&e.push&&e.toArray?e.toArray():e})))).filter((function(e){return"string"==typeof e||"number"==typeof e}))}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.caseSensitive,o=n.fuzzy,a=n.sortResults,s=n.exactMatch;e=e.map((function(e){return e.toString()}));try{if(o){"function"==typeof e.toJS&&(e=e.toJS());var l=new i.default(e.map((function(e){return{id:e}})),{keys:["id"],id:"id",caseSensitive:r,shouldSort:a});return l.search(t).length}return e.some((function(e){try{return r||(e=e.toLowerCase()),s&&(t=new RegExp("^"+t+"$","i")),!(!e||-1===e.search(t))}catch(e){return!1}}))}catch(e){return!1}}},69021:function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),d=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,a=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.caseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.id,S=void 0===C?null:C,x=n.keys,w=void 0===x?[]:x,k=n.shouldSort,Z=void 0===k||k,R=n.getFn,T=void 0===R?s:R,F=n.sortFn,D=void 0===F?function(e,t){return e.score-t.score}:F,_=n.tokenize,E=void 0!==_&&_,I=n.matchAllTokens,M=void 0!==I&&I,O=n.includeMatches,P=void 0!==O&&O,N=n.includeScore,j=void 0!==N&&N,q=n.verbose,$=void 0!==q&&q;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,minMatchCharLength:y,id:S,keys:w,includeMatches:P,includeScore:j,shouldSort:Z,getFn:T,sortFn:D,verbose:$,tokenize:E,matchAllTokens:M},this.setCollection(t),this._processKeys(w)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var i=null,o=null,a=0,s=0,l=e.length;s<l;s+=1){var d=e[s];if(!d.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=d.name;if(this._keyNames.push(c),!d.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var u=d.weight;if(u<0||u>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?u:Math.max(o,u),i=null==i?u:Math.min(i,u),this._keyWeights[c]=u,a+=u}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),r=n.tokenSearchers,i=n.fullSearcher,o=this._search(r,i);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),r=0,i=n.length;r<i;r+=1)t.push(new o(n[r],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,r={},i=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t});return i}for(var s=0,l=n.length;s<l;s+=1)for(var d=n[s],c=0,u=this._keyNames.length;c<u;c+=1){var h=this._keyNames[c];this._analyze({key:h,value:this.options.getFn(d,h),record:d,index:s},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t})}return i}},{key:"_analyze",value:function(e,t){var n=this,r=e.key,i=e.arrayIndex,o=void 0===i?-1:i,a=e.value,s=e.record,d=e.index,c=t.tokenSearchers,u=void 0===c?[]:c,h=t.fullSearcher,p=t.resultMap,f=void 0===p?{}:p,m=t.results,g=void 0===m?[]:m;!function e(t,i,o,a){if(null!=i)if("string"==typeof i){var s=!1,d=-1,c=0;n._log("\nKey: ".concat(""===r?"--":r));var p=h.search(i);if(n._log('Full text: "'.concat(i,'", score: ').concat(p.score)),n.options.tokenize){for(var m=i.split(n.options.tokenSeparator),v=m.length,b=[],y=0,C=u.length;y<C;y+=1){var S=u[y];n._log('\nPattern: "'.concat(S.pattern,'"'));for(var x=!1,w=0;w<v;w+=1){var k=m[w],Z=S.search(k),R={};Z.isMatch?(R[k]=Z.score,s=!0,x=!0,b.push(Z.score)):(R[k]=1,n.options.matchAllTokens||b.push(1)),n._log('Token: "'.concat(k,'", score: ').concat(R[k]))}x&&(c+=1)}d=b[0];for(var T=b.length,F=1;F<T;F+=1)d+=b[F];d/=T,n._log("Token score average:",d)}var D=p.score;d>-1&&(D=(D+d)/2),n._log("Score average:",D);var _=!n.options.tokenize||!n.options.matchAllTokens||c>=u.length;if(n._log("\nCheck Matches: ".concat(_)),(s||p.isMatch)&&_){var E={key:r,arrayIndex:t,value:i,score:D};n.options.includeMatches&&(E.matchedIndices=p.matchedIndices);var I=f[a];I?I.output.push(E):(f[a]={item:o,output:[E]},g.push(f[a]))}}else if(l(i))for(var M=0,O=i.length;M<O;M+=1)e(M,i[M],o,a)}(o,a,s,d)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,r=0,i=e.length;r<i;r+=1){for(var o=e[r],a=o.output,s=a.length,l=1,d=0;d<s;d+=1){var c=a[d],u=c.key,h=n?t[u]:1,p=0===c.score&&t&&t[u]>0?Number.EPSILON:c.score;l*=Math.pow(p,h)}o.score=l,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===r(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var i=[];this.options.includeMatches&&i.push((function(e,t){var n=e.output;t.matches=[];for(var r=0,i=n.length;r<i;r+=1){var o=n[r];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&i.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var l={item:s.item},d=0,c=i.length;d<c;d+=1)i[d](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&i(t.prototype,n),e}();e.exports=d},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,s=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.isCaseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.includeMatches,S=void 0!==C&&C;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:s,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,includeMatches:S,minMatchCharLength:y},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,r=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return r&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,l=s.maxPatternLength,d=s.tokenSeparator;if(this.pattern.length>l)return i(e,this.pattern,d);var c=this.options,u=c.location,h=c.distance,p=c.threshold,f=c.findAllMatches,m=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:u,distance:h,threshold:p,findAllMatches:f,minMatchCharLength:m,includeMatches:r})}}])&&r(t.prototype,n),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(n,"\\$&").replace(r,"|")),o=e.match(i),a=!!o,s=[];if(a)for(var l=0,d=o.length;l<d;l+=1){var c=o[l];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var r=n(4),i=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,l=o.distance,d=void 0===l?100:l,c=o.threshold,u=void 0===c?.6:c,h=o.findAllMatches,p=void 0!==h&&h,f=o.minMatchCharLength,m=void 0===f?1:f,g=o.includeMatches,v=void 0!==g&&g,b=s,y=e.length,C=u,S=e.indexOf(t,b),x=t.length,w=[],k=0;k<y;k+=1)w[k]=0;if(-1!==S){var Z=r(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});if(C=Math.min(Z,C),-1!==(S=e.lastIndexOf(t,b+x))){var R=r(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});C=Math.min(R,C)}}S=-1;for(var T=[],F=1,D=x+y,_=1<<(x<=31?x-1:30),E=0;E<x;E+=1){for(var I=0,M=D;I<M;)r(t,{errors:E,currentLocation:b+M,expectedLocation:b,distance:d})<=C?I=M:D=M,M=Math.floor((D-I)/2+I);D=M;var O=Math.max(1,b-M+1),P=p?y:Math.min(b+M,y)+x,N=Array(P+2);N[P+1]=(1<<E)-1;for(var j=P;j>=O;j-=1){var q=j-1,$=n[e.charAt(q)];if($&&(w[q]=1),N[j]=(N[j+1]<<1|1)&$,0!==E&&(N[j]|=(T[j+1]|T[j])<<1|1|T[j+1]),N[j]&_&&(F=r(t,{errors:E,currentLocation:q,expectedLocation:b,distance:d}))<=C){if(C=F,(S=q)<=b)break;O=Math.max(1,2*b-S)}}if(r(t,{errors:E+1,currentLocation:b,expectedLocation:b,distance:d})>C)break;T=N}var z={isMatch:S>=0,score:0===F?.001:F};return v&&(z.matchedIndices=i(w,m)),z}},function(e,t){e.exports=function(e,t){var n=t.errors,r=void 0===n?0:n,i=t.currentLocation,o=void 0===i?0:i,a=t.expectedLocation,s=void 0===a?0:a,l=t.distance,d=void 0===l?100:l,c=r/e.length,u=Math.abs(s-o);return d?c+u/d:u?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=-1,i=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===r?r=o:s||-1===r||((i=o-1)-r+1>=t&&n.push([r,i]),r=-1)}return e[o-1]&&o-r>=t&&n.push([r,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,r=0;r<n;r+=1)t[e.charAt(r)]=0;for(var i=0;i<n;i+=1)t[e.charAt(i)]|=1<<n-i-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},i=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var l=s.indexOf("."),d=s,c=null;-1!==l&&(d=s.slice(0,l),c=s.slice(l+1));var u=t[d];if(null!=u)if(c||!i(u)&&!o(u))if(n(u))for(var h=0,p=u.length;h<p;h+=1)e(u[h],c);else c&&e(u,c);else a.push(r(u))}else a.push(t)}(e,t),a},isArray:n,isString:i,isNum:o,toString:r}}])},18474:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(67294),a=d(o),s=d(n(45697)),l=d(n(54087));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(){var e,n,r;c(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.events=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"],r.subscribers=[],r.rafHandle=null,r.subscribe=function(e){r.subscribers=r.subscribers.concat(e)},r.unsubscribe=function(e){r.subscribers=r.subscribers.filter((function(t){return t!==e}))},r.notifySubscribers=function(e){if(!r.framePending){var t=e.currentTarget;r.rafHandle=(0,l.default)((function(){r.framePending=!1;var e=r.node.getBoundingClientRect(),n=e.top,i=e.bottom;r.subscribers.forEach((function(e){return e({distanceFromTop:n,distanceFromBottom:i,eventSource:t===window?document.body:r.node})}))})),r.framePending=!0}},r.getParent=function(){return r.node},u(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"getChildContext",value:function(){return{subscribe:this.subscribe,unsubscribe:this.unsubscribe,getParent:this.getParent}}},{key:"componentDidMount",value:function(){var e=this;this.events.forEach((function(t){return window.addEventListener(t,e.notifySubscribers)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.rafHandle&&(l.default.cancel(this.rafHandle),this.rafHandle=null),this.events.forEach((function(t){return window.removeEventListener(t,e.notifySubscribers)}))}},{key:"render",value:function(){var e=this;return a.default.createElement("div",r({},this.props,{ref:function(t){return e.node=t},onScroll:this.notifySubscribers,onTouchStart:this.notifySubscribers,onTouchMove:this.notifySubscribers,onTouchEnd:this.notifySubscribers}))}}]),t}(o.PureComponent);h.childContextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=h},78579:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(67294),o=l(i),a=l(n(90731)),s=l(n(45697));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,n,r;d(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={isSticky:!1,wasSticky:!1,style:{}},r.handleContainerEvent=function(e){var t=e.distanceFromTop,n=e.distanceFromBottom,i=e.eventSource,o=r.context.getParent(),a=!1;r.props.relative&&(a=i!==o,t=-(i.scrollTop+i.offsetTop)+r.placeholder.offsetTop);var s=r.placeholder.getBoundingClientRect(),l=r.content.getBoundingClientRect().height,d=n-r.props.bottomOffset-l,c=!!r.state.isSticky,u=a?c:t<=-r.props.topOffset&&n>-r.props.bottomOffset;n=(r.props.relative?o.scrollHeight-o.scrollTop:n)-l;var h=u?{position:"fixed",top:d>0?r.props.relative?o.offsetTop-o.offsetParent.scrollTop:0:d,left:s.left,width:s.width}:{};r.props.disableHardwareAcceleration||(h.transform="translateZ(0)"),r.setState({isSticky:u,wasSticky:c,distanceFromTop:t,distanceFromBottom:n,calculatedHeight:l,style:h})},c(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillMount",value:function(){if(!this.context.subscribe)throw new TypeError("Expected Sticky to be mounted within StickyContainer");this.context.subscribe(this.handleContainerEvent)}},{key:"componentWillUnmount",value:function(){this.context.unsubscribe(this.handleContainerEvent)}},{key:"componentDidUpdate",value:function(){this.placeholder.style.paddingBottom=this.props.disableCompensation?0:(this.state.isSticky?this.state.calculatedHeight:0)+"px"}},{key:"render",value:function(){var e=this,t=o.default.cloneElement(this.props.children({isSticky:this.state.isSticky,wasSticky:this.state.wasSticky,distanceFromTop:this.state.distanceFromTop,distanceFromBottom:this.state.distanceFromBottom,calculatedHeight:this.state.calculatedHeight,style:this.state.style}),{ref:function(t){e.content=a.default.findDOMNode(t)}});return o.default.createElement("div",null,o.default.createElement("div",{ref:function(t){return e.placeholder=t}}),t)}}]),t}(i.Component);u.propTypes={topOffset:s.default.number,bottomOffset:s.default.number,relative:s.default.bool,children:s.default.func.isRequired},u.defaultProps={relative:!1,topOffset:0,bottomOffset:0,disableCompensation:!1,disableHardwareAcceleration:!1},u.contextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=u},58439:(e,t,n)=>{"use strict";t.L9=t.Le=void 0;var r=o(n(78579)),i=o(n(18474));function o(e){return e&&e.__esModule?e:{default:e}}t.Le=r.default,t.L9=i.default,r.default},53652:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=class{constructor(e){this.name="TypedRegistry",this.records=void 0,this.records=e}get(e){return this.records[e]}set(e,t){this.records[e]=t}}},75049:(e,t,n)=>{"use strict";n.d(t,{I:()=>a,_:()=>s});var r=n(53652),i=n(1875);class o extends r.Z{constructor(){super(...arguments),this.name="ExtensionsRegistry"}}const a=(0,i.Z)(o,{}),s=a},38270:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r=n(5872),i=n.n(r),o=n(67294),a=n(73727),s=n(94184),l=n.n(s),d=n(51995),c=n(61988),u=n(11965),h=n(58593),p=n(79789);const f=(0,d.iK)(p.Z)`
  vertical-align: middle;
`;function m(e){let{canEdit:t=!1,editing:n=!1,extraClasses:r,multiLine:s=!1,noPermitTooltip:d,onSaveTitle:p,showTooltip:m=!0,style:g,title:v="",defaultTitle:b="",placeholder:y="",certifiedBy:C,certificationDetails:S,url:x,...w}=e;const[k,Z]=(0,o.useState)(n),[R,T]=(0,o.useState)(v),[F,D]=(0,o.useState)(v),[_,E]=(0,o.useState)(null),I=(0,o.useRef)();function M(){if(!t||k)return;const e=I.current?I.current.getBoundingClientRect():null;Z(!0),E(e)}function O(){const e=R.trim();t&&(Z(!1),e.length?(F!==e&&D(e),v!==e&&p(e)):T(F))}function P(e){" "===e.key&&e.stopPropagation(),"Enter"===e.key&&(e.preventDefault(),O())}function N(e){t&&T(e.target.value)}function j(e){"Enter"===e.key&&(e.preventDefault(),O())}let q;(0,o.useEffect)((()=>{v!==R&&(D(R),T(v))}),[v]),(0,o.useEffect)((()=>{if(k&&(I.current.focus(),I.current.setSelectionRange)){const{length:e}=I.current.value;I.current.setSelectionRange(e,e),I.current.scrollLeft=I.current.scrollWidth,I.current.scrollTop=I.current.scrollHeight}}),[k]),q=R,k||R||(q=b||v);const $=k&&_?{height:`${_.height}px`}:void 0;let z=s&&k?(0,u.tZ)("textarea",{ref:I,value:q,className:v?void 0:"text-muted",onKeyDown:P,onChange:N,onBlur:O,onClick:M,onKeyPress:j,placeholder:y,style:$}):(0,u.tZ)("input",{ref:I,type:k?"text":"button",value:q,className:v?void 0:"text-muted",onKeyDown:P,onChange:N,onBlur:O,onClick:M,onKeyPress:j,placeholder:y});return m&&!k&&(z=(0,u.tZ)(h.u,{id:"title-tooltip",title:t?(0,c.t)("Click to edit"):d||(0,c.t)("You don't have the rights to alter this title.")},z)),t||(z=x?(0,u.tZ)(a.rU,{to:x,css:e=>u.iv`
          color: ${e.colors.grayscale.dark1};
          text-decoration: none;
          :hover {
            text-decoration: underline;
          }
        `},q):(0,u.tZ)("span",null,q)),(0,u.tZ)("span",i()({className:l()("editable-title",r,t&&"editable-title--editable",k&&"editable-title--editing"),style:g},w),C&&(0,u.tZ)(o.Fragment,null,(0,u.tZ)(f,{certifiedBy:C,details:S,size:"xl"})," "),z)}},85931:(e,t,n)=>{"use strict";n.d(t,{m:()=>l});var r=n(5872),i=n.n(r),o=(n(67294),n(73727)),a=n(23525),s=n(11965);const l=e=>{let{to:t,component:n,replace:r,innerRef:l,children:d,...c}=e;return"string"==typeof t&&(0,a.TO)(t)?(0,s.tZ)("a",i()({href:(0,a.en)(t)},c),d):(0,s.tZ)(o.rU,i()({to:t,component:n,replace:r,innerRef:l},c),d)}},69011:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ph});var r=n(14890),i=n(37703),o=n(78580),a=n.n(o),s=n(67294),l=n(45697),d=n.n(l),c=n(61988),u=n(93185),h=n(14278),p=n(38703),f=n(81255);function m(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===f.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var g=n(94184),v=n.n(g),b=n(29119),y=n(51995),C=n(11965),S=n(57902),x=n(71262),w=n(58439),k=n(23279),Z=n.n(k),R=n(91033);function T(){return T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},T.apply(this,arguments)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(e){var t,n;function r(t){var n;return D(F(n=e.call(this,t)||this),"animationFrameID",void 0),D(F(n),"resizeObserver",void 0),D(F(n),"target",null),D(F(n),"resize",(function(e){var t=e.width,r=e.height,i=e.top,o=e.left;n.setState((function(){return{width:t,height:r,top:i,left:o}}))})),D(F(n),"setTarget",(function(e){n.target=e})),n.state={width:0,height:0,top:0,left:0},n.resize=Z()(n.resize,t.debounceTime),n.animationFrameID=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.componentDidMount=function(){var e=this;this.resizeObserver=new R.Z((function(t){void 0===t&&(t=[]),t.forEach((function(t){var n=t.contentRect,r=n.left,i=n.top,o=n.width,a=n.height;e.animationFrameID=window.requestAnimationFrame((function(){e.resize({width:o,height:a,top:i,left:r})}))}))})),this.target&&this.resizeObserver.observe(this.target)},i.componentWillUnmount=function(){this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeObserver&&this.resizeObserver.disconnect()},i.render=function(){var e=this.props,t=e.className,n=e.children,r=(e.debounceTime,e.parentSizeStyles),i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["className","children","debounceTime","parentSizeStyles"]);return s.createElement("div",T({style:r,ref:this.setTarget,className:t},i),n(T({},this.state,{ref:this.target,resize:this.resize})))},r}(s.Component);D(_,"propTypes",{className:d().string,debounceTime:d().number,children:d().func.isRequired}),D(_,"defaultProps",{debounceTime:300,parentSizeStyles:{width:"100%",height:"100%"}});var E=n(68969),I=n(88239),M=n(8177),O=n.n(M),P=n(85105),N=n.n(P),j=n(99663),q=n(46058),$=n(49135),z=n(93196),A=n(75621),U=n(94396),L=function(e){function t(){var e,n,r,i;(0,j.default)(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=r=(0,$.default)(this,(e=t.__proto__||N()(t)).call.apply(e,[this].concat(a))),r._cellRenderer=function(e){var t=e.parent,n=e.rowIndex,i=e.style,o=e.isScrolling,a=e.isVisible,s=e.key,l=r.props.rowRenderer;return O()(i,"width").writable&&(i.width="100%"),l({index:n,style:i,isScrolling:o,isVisible:a,key:s,parent:t})},r._setRef=function(e){r.Grid=e},r._onScroll=function(e){var t=e.clientHeight,n=e.scrollHeight,i=e.scrollTop;(0,r.props.onScroll)({clientHeight:t,scrollHeight:n,scrollTop:i})},r._onSectionRendered=function(e){var t=e.rowOverscanStartIndex,n=e.rowOverscanStopIndex,i=e.rowStartIndex,o=e.rowStopIndex;(0,r.props.onRowsRendered)({overscanStartIndex:t,overscanStopIndex:n,startIndex:i,stopIndex:o})},i=n,(0,$.default)(r,i)}return(0,z.default)(t,e),(0,q.default)(t,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,n=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:n,columnIndex:0}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,r=e.rowIndex,i=void 0===r?0:r;this.Grid&&this.Grid.recomputeGridSize({rowIndex:i,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e,columnIndex:0})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.noRowsRenderer,r=e.scrollToIndex,i=e.width,o=v()("ReactVirtualized__List",t);return s.createElement(A.Z,(0,I.default)({},this.props,{autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:o,columnWidth:i,columnCount:1,noContentRenderer:n,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:r}))}}]),t}(s.PureComponent);L.defaultProps={autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:U.ZP,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}},L.propTypes=null;const V=L;var K=n(24903),W=n(9875),B=n(4715),H=n(35932),G=n(70163),Y=n(80621),J=n(2275),Q=n(69856),X=n(5872),ee=n.n(X),te=n(4144),ne=n(58593),re=n(85931);const ie=e=>{let{children:t,...n}=e;const[r,i]=(0,s.useState)(!1),o=(0,s.useRef)(null);(0,s.useEffect)((()=>{i(!!o.current&&o.current.scrollWidth>o.current.clientWidth)}),[t]);const a=(0,C.tZ)("div",ee()({},n,{ref:o,css:C.iv`
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
      `}),t);return r?(0,C.tZ)(ne.u,{title:t},a):a},oe=e=>{let{label:t,value:n}=e;return(0,C.tZ)("div",{css:e=>C.iv`
      font-size: ${e.typography.sizes.s}px;
      display: flex;
      justify-content: space-between;

      &:not(:last-child) {
        margin-bottom: ${e.gridUnit}px;
      }
    `},(0,C.tZ)("span",{css:e=>C.iv`
        margin-right: ${4*e.gridUnit}px;
        color: ${e.colors.grayscale.base};
      `},t),(0,C.tZ)("span",{css:C.iv`
        min-width: 0;
      `},(0,C.tZ)(ie,null,n)))},ae=e=>{let{showThumbnails:t,placeholderRef:n}=e;return(0,C.tZ)("div",{ref:n,css:e=>C.iv`
      /* Display styles */
      border: 1px solid ${e.colors.primary.dark1};
      border-radius: ${e.gridUnit}px;
      color: ${e.colors.primary.dark1};
      font-size: ${e.typography.sizes.xs}px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      padding: ${e.gridUnit/2}px ${2*e.gridUnit}px;
      margin-left: ${4*e.gridUnit}px;
      pointer-events: none;

      /* Position styles */
      visibility: hidden;
      position: ${t?"absolute":"unset"};
      top: ${t?"72px":"unset"};
      left: ${t?"84px":"unset"};
    `},(0,c.t)("Added"))},se=e=>{let{placeholder:t}=e;return(0,C.tZ)("div",{css:e=>C.iv`
      /* Display styles */
      border: 1px solid ${e.colors.primary.dark1};
      border-radius: ${e.gridUnit}px;
      color: ${e.colors.primary.dark1};
      font-size: ${e.typography.sizes.xs}px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      padding: ${e.gridUnit/2}px ${2*e.gridUnit}px;
      margin-left: ${4*e.gridUnit}px;
      pointer-events: none;

      /* Position styles */
      display: ${t?"unset":"none"};
      position: absolute;
      top: ${t?`${t.offsetTop}px`:"unset"};
      left: ${t?t.offsetLeft-2+"px":"unset"};
    `},(0,c.t)("Added"))},le=e=>{let{datasourceUrl:t,datasourceName:n="-",innerRef:r,isSelected:i=!1,lastModified:o,sliceName:a,style:l={},thumbnailUrl:d,visType:p}=e;const f=(0,u.c)(u.T.THUMBNAILS),[m,g]=(0,s.useState)(),{mountedPluginMetadata:v}=(0,h.gp)(),b=(0,s.useMemo)((()=>v[p].name),[v,p]);return(0,C.tZ)("div",{ref:r,style:l},(0,C.tZ)("div",{css:e=>C.iv`
          border: 1px solid ${e.colors.grayscale.light2};
          border-radius: ${e.gridUnit}px;
          background: ${e.colors.grayscale.light5};
          padding: ${4*e.gridUnit}px;
          margin: 0 ${3*e.gridUnit}px
            ${3*e.gridUnit}px
            ${3*e.gridUnit}px;
          position: relative;
          cursor: ${i?"not-allowed":"move"};
          white-space: nowrap;
          overflow: hidden;
          line-height: 1.3;
          color: ${e.colors.grayscale.dark1}

          &:hover {
            background: ${e.colors.grayscale.light4};
          }

          opacity: ${i?.4:"unset"};
        `},(0,C.tZ)("div",{css:C.iv`
            display: flex;
          `},f?(0,C.tZ)("div",{css:C.iv`
                width: 146px;
                height: 82px;
                flex-shrink: 0;
                margin-right: 16px;
              `},(0,C.tZ)(te.Z,{src:d||"",fallback:"/static/assets/images/chart-card-fallback.svg",position:"top"}),i&&f?(0,C.tZ)(ae,{placeholderRef:g,showThumbnails:f}):null):null,(0,C.tZ)("div",{css:C.iv`
              flex-grow: 1;
              min-width: 0;
            `},(0,C.tZ)("div",{css:e=>C.iv`
                margin-bottom: ${2*e.gridUnit}px;
                font-weight: ${e.typography.weights.bold};
                display: flex;
                justify-content: space-between;
                align-items: center;
              `},(0,C.tZ)(ie,null,a),i&&!f?(0,C.tZ)(ae,{placeholderRef:g}):null),(0,C.tZ)("div",{css:C.iv`
                display: flex;
                flex-direction: column;
              `},(0,C.tZ)(oe,{label:(0,c.t)("Viz type"),value:b}),(0,C.tZ)(oe,{label:(0,c.t)("Dataset"),value:t?(0,C.tZ)(re.m,{to:t},n):n}),(0,C.tZ)(oe,{label:(0,c.t)("Modified"),value:o}))))),(0,C.tZ)(se,{placeholder:m}))};var de=n(84785);const ce={position:"fixed",pointerEvents:"none",top:0,left:0,zIndex:101,width:344},ue={dragItem:d().shape({index:d().number.isRequired}),slices:d().arrayOf(J.Rw),isDragging:d().bool.isRequired,currentOffset:d().shape({x:d().number.isRequired,y:d().number.isRequired})};function he(e){let{dragItem:t,slices:n,isDragging:r,currentOffset:i}=e;if(!(r&&i&&t&&n))return null;const o=n[t.index];return o&&t.parentType===f.F0&&t.type===f.dW?(0,C.tZ)(le,{style:{...ce,transform:`translate(${i.x}px, ${i.y}px)`},sliceName:o.slice_name,lastModified:o.changed_on_humanized,visType:o.viz_type,datasourceUrl:o.datasource_url,datasourceName:o.datasource_name}):null}he.propTypes=ue,he.defaultProps={currentOffset:null,dragItem:null,slices:null};const pe=(0,de.DragLayer)((e=>({dragItem:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()})))(he);var fe,me=n(23493),ge=n.n(me);const ve=Y.Mu+1,be=Y.Mu+3,ye=Y.Mu+4,Ce=Y.Mu+5,Se={[f.U0]:{[f.yR]:Y.Mu,[f.BG]:Y.Mu},[f.BG]:{[f.dW]:ve,[f.t]:ve,[f.xh]:ve,[f.BA]:ve,[f.hE]:ve,[f.Nc]:ve,[f.Os]:ve,[f.yR]:ve},[f.Os]:{[f.dW]:ye,[f.t]:ye,[f.xh]:ye,[f.BA]:ye},[f.yR]:{[f.gn]:be},[f.gn]:{[f.dW]:Ce,[f.t]:Ce,[f.xh]:Ce,[f.BA]:be,[f.hE]:Ce,[f.Nc]:Ce,[f.Os]:be,[f.yR]:be},[f.BA]:{[f.dW]:Ce,[f.Nc]:Ce,[f.xh]:Ce,[f.Os]:be,[f.hE]:be,[f.yR]:be},[f.dW]:{},[f.t]:{},[f.hE]:{},[f.Nc]:{},[f.xh]:{}};function xe(e){const{parentType:t,childType:n,parentDepth:r}=e;if(!t||!n||"number"!=typeof r)return!1;const i=(Se[t]||{})[n];return"number"==typeof i&&r<=i}const we="DROP_TOP",ke="DROP_RIGHT",Ze="DROP_BOTTOM",Re="DROP_LEFT";let Te,Fe={};function De(e,t){const{depth:n,parentComponent:r,component:i,orientation:o,isDraggingOverShallow:a}=t.props,s=e.getItem();if(!s||s.id===i.id)return null;const l=xe({parentType:i.type,parentDepth:n,childType:s.type}),d=r&&r.type,c=xe({parentType:d,parentDepth:n+(d===f.gn||d===f.yR?0:-1),childType:s.type});if(!l&&!c)return null;const u=(i.children||[]).length>0,h="row"===o?"vertical":"horizontal",p="row"===o?"horizontal":"vertical";if(a&&l&&!c)return"vertical"===h?u?ke:Re:u?Ze:we;const m=t.ref.getBoundingClientRect(),g=e.getClientOffset()||Fe[i.id];if(!g||!m)return null;Fe[i.id]=g;const v=Math.abs(g.y-m.top),b=Math.abs(g.y-m.bottom),y=Math.abs(g.x-m.left),C=Math.abs(g.x-m.right);if(!a&&[v,b,y,C].every((e=>e>20)))return null;if(c&&!l){if("vertical"===p){const e=m.left+(m.right-m.left)/2;return g.x<e?Re:ke}const e=m.top+(m.bottom-m.top)/2;return g.y<e?we:Ze}if(c&&l){if("vertical"===p){if(y<20)return Re;if(C<20)return ke}else{if(v<20)return we;if(b<20)return Ze}return"vertical"===h?u?ke:Re:u?Ze:we}return null}const _e=ge()((function(e,t,n){var r,i;if(!n.mounted)return;const o=De(t,n);!function(e){const t="SCROLL_TOP"===e&&!Te&&0!==document.documentElement.scrollTop,n=Te&&("SCROLL_TOP"!==e||0===document.documentElement.scrollTop);t?Te=setInterval((()=>{if(0===document.documentElement.scrollTop)return clearInterval(Te),void(Te=null);let e=document.documentElement.scrollTop-120;e<0&&(e=0),window.scroll({top:e,behavior:"smooth"})}),50):n&&(clearInterval(Te),Te=null)}((null==n||null==(r=n.props)||null==(i=r.component)?void 0:i.type)===f.U0?"SCROLL_TOP":null),o?n.setState((()=>({dropIndicator:o}))):n.setState((()=>({dropIndicator:null})))}),100);const Ee="DRAG_DROPPABLE",Ie=[Ee,{canDrag:e=>!e.disableDragDrop,beginDrag(e){const{component:t,index:n,parentComponent:r={}}=e;return{type:t.type,id:t.id,meta:t.meta,index:n,parentId:r.id,parentType:r.type}}},function(e,t){return{dragSourceRef:e.dragSource(),dragPreviewRef:e.dragPreview(),isDragging:t.isDragging()}}],Me=[Ee,{canDrop:e=>!e.disableDragDrop,hover(e,t,n){n&&n.mounted&&_e(e,t,n)},drop(e,t,n){const r=t.getDropResult();if((!r||!r.destination)&&n.mounted)return function(e,t,n){if(!n.mounted)return;n.setState((()=>({dropIndicator:null})));const r=De(t,n);if(!r)return;const{parentComponent:i,component:o,index:a,onDrop:s,orientation:l}=n.props,d=t.getItem(),c="row"===l&&(r===we||r===Ze)||"column"===l&&(r===Re||r===ke)?"sibling":"child",u={source:{id:d.parentId,type:d.parentType,index:d.index},dragging:{id:d.id,type:d.type,meta:d.meta}};if("child"===c)u.destination={id:o.id,type:o.type,index:o.children.length};else{let e=i&&d.parentId===i.id&&d.index<a?a-1:a;r!==Ze&&r!==ke||(e+=1),u.destination={id:i.id,type:i.type,index:e}}return s(u),Fe={},u}(0,t,n)}},function(e,t){return{droppableRef:e.dropTarget(),isDraggingOver:t.isOver(),isDraggingOverShallow:t.isOver({shallow:!0})}}],Oe={children:d().func,className:d().string,component:J.cP.isRequired,parentComponent:J.cP,depth:d().number.isRequired,disableDragDrop:d().bool,orientation:d().oneOf(["row","column"]),index:d().number.isRequired,style:d().object,onDrop:d().func,editMode:d().bool.isRequired,useEmptyDragPreview:d().bool,isDragging:d().bool.isRequired,isDraggingOver:d().bool.isRequired,isDraggingOverShallow:d().bool.isRequired,droppableRef:d().func.isRequired,dragSourceRef:d().func.isRequired,dragPreviewRef:d().func.isRequired},Pe={className:null,style:null,parentComponent:null,disableDragDrop:!1,children(){},onDrop(){},orientation:"row",useEmptyDragPreview:!1};class Ne extends s.PureComponent{constructor(e){super(e),this.state={dropIndicator:null},this.setRef=this.setRef.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}setRef(e){this.ref=e,this.props.useEmptyDragPreview?this.props.dragPreviewRef((fe||((fe=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),fe),{captureDraggingState:!0}):this.props.dragPreviewRef(e),this.props.droppableRef(e)}render(){const{children:e,className:t,orientation:n,dragSourceRef:r,disableDragDrop:i,isDragging:o,isDraggingOver:a,style:s,editMode:l}=this.props,{dropIndicator:d}=this.state,c=a&&d&&!i?{className:v()("drop-indicator",d===we&&"drop-indicator--top",d===Ze&&"drop-indicator--bottom",d===Re&&"drop-indicator--left",d===ke&&"drop-indicator--right")}:null,u=l?{dragSourceRef:r,dropIndicatorProps:c}:{};return(0,C.tZ)("div",{style:s,ref:this.setRef,className:v()("dragdroppable","row"===n&&"dragdroppable-row","column"===n&&"dragdroppable-column",o&&"dragdroppable--dragging",t)},e(u))}}Ne.propTypes=Oe,Ne.defaultProps=Pe;const je=(0,de.DragSource)(...Ie)((0,de.DropTarget)(...Me)(Ne)),qe={fetchAllSlices:d().func.isRequired,isLoading:d().bool.isRequired,slices:d().objectOf(J.Rw).isRequired,lastUpdated:d().number.isRequired,errorMessage:d().string,userId:d().string.isRequired,selectedSliceIds:d().arrayOf(d().number),editMode:d().bool,height:d().number,filterboxMigrationState:Q.Qi,dashboardId:d().number},$e={selectedSliceIds:[],editMode:!1,errorMessage:"",height:window.innerHeight,filterboxMigrationState:Q.Qi.NOOP},ze=["slice_name","viz_type","datasource_name"],Ae={slice_name:"name",viz_type:"viz type",datasource_name:"dataset",changed_on:"recent"},Ue=y.iK.div`
  display: flex;
  flex-direction: row;
  padding: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
  padding-top: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,Le=(0,y.iK)(B.Ph)`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  min-width: 150px;
`,Ve=y.iK.div`
  ${e=>{let{theme:t}=e;return C.iv`
    display: flex;
    justify-content: flex-end;
    padding-right: ${2*t.gridUnit}px;
  `}}
`,Ke=(0,y.iK)(H.Z)`
  ${e=>{let{theme:t}=e;return C.iv`
    height: auto;
    & > .anticon + span {
      margin-left: 0;
    }
    & > [role='img']:first-of-type {
      margin-right: ${t.gridUnit}px;
      padding-bottom: 1px;
      line-height: 0;
    }
  `}}
`;class We extends s.Component{static sortByComparator(e){const t="changed_on"===e?-1:1;return(n,r)=>n[e]<r[e]?-1*t:n[e]>r[e]?1*t:0}constructor(e){super(e),this.handleChange=Z()((e=>{this.searchUpdated(e);const{userId:t,filterboxMigrationState:n}=this.props;this.slicesRequest=this.props.fetchFilteredSlices(t,(0,u.c)(u.T.ENABLE_FILTER_BOX_MIGRATION)&&n!==Q.Qi.SNOOZED,e)}),300),this.state={filteredSlices:[],searchTerm:"",sortBy:"changed_on",selectedSliceIdsSet:new Set(e.selectedSliceIds)},this.rowRenderer=this.rowRenderer.bind(this),this.searchUpdated=this.searchUpdated.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleSelect=this.handleSelect.bind(this)}componentDidMount(){const{userId:e,filterboxMigrationState:t}=this.props;this.slicesRequest=this.props.fetchAllSlices(e,(0,u.c)(u.T.ENABLE_FILTER_BOX_MIGRATION)&&t!==Q.Qi.SNOOZED)}UNSAFE_componentWillReceiveProps(e){const t={};e.lastUpdated!==this.props.lastUpdated&&(t.filteredSlices=Object.values(e.slices).filter((0,K.cj)(this.state.searchTerm,ze)).sort(We.sortByComparator(this.state.sortBy))),e.selectedSliceIds!==this.props.selectedSliceIds&&(t.selectedSliceIdsSet=new Set(e.selectedSliceIds)),Object.keys(t).length&&this.setState(t)}componentWillUnmount(){this.slicesRequest&&this.slicesRequest.abort&&this.slicesRequest.abort()}getFilteredSortedSlices(e,t){return Object.values(this.props.slices).filter((0,K.cj)(e,ze)).sort(We.sortByComparator(t))}handleKeyPress(e){"Enter"===e.key&&(e.preventDefault(),this.searchUpdated(e.target.value))}searchUpdated(e){this.setState((t=>({searchTerm:e,filteredSlices:this.getFilteredSortedSlices(e,t.sortBy)})))}handleSelect(e){this.setState((t=>({sortBy:e,filteredSlices:this.getFilteredSortedSlices(t.searchTerm,e)})));const{userId:t,filterboxMigrationState:n}=this.props;this.slicesRequest=this.props.fetchSortedSlices(t,(0,u.c)(u.T.ENABLE_FILTER_BOX_MIGRATION)&&n!==Q.Qi.SNOOZED,e)}rowRenderer(e){let{key:t,index:n,style:r}=e;const{filteredSlices:i,selectedSliceIdsSet:o}=this.state,a=i[n],s=o.has(a.slice_id),l=f.dW,d=Y.Jd,c={chartId:a.slice_id,sliceName:a.slice_name};return(0,C.tZ)(je,{key:t,component:{type:l,id:d,meta:c},parentComponent:{id:Y.D0,type:f.F0},index:n,depth:0,disableDragDrop:s,editMode:this.props.editMode,useEmptyDragPreview:!0,style:{}},(e=>{let{dragSourceRef:t}=e;return(0,C.tZ)(le,{innerRef:t,style:r,sliceName:a.slice_name,lastModified:a.changed_on_humanized,visType:a.viz_type,datasourceUrl:a.datasource_url,datasourceName:a.datasource_name,thumbnailUrl:a.thumbnail_url,isSelected:s})}))}render(){const e=this.props.height-30-64-16;return(0,C.tZ)("div",{className:"slice-adder-container"},(0,C.tZ)(Ve,null,(0,C.tZ)(Ke,{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>window.open(`/chart/add?dashboard_id=${this.props.dashboardId}`,"_blank","noopener noreferrer")},(0,C.tZ)(G.Z.PlusSmall,null),(0,c.t)("Create new chart"))),(0,C.tZ)(Ue,null,(0,C.tZ)(W.II,{placeholder:(0,c.t)("Filter your charts"),className:"search-input",onChange:e=>this.handleChange(e.target.value),onKeyPress:this.handleKeyPress}),(0,C.tZ)(Le,{id:"slice-adder-sortby",value:this.state.sortBy,onChange:this.handleSelect,options:Object.entries(Ae).map((e=>{let[t,n]=e;return{label:(0,c.t)("Sort by %s",n),value:t}})),placeholder:(0,c.t)("Sort by")})),this.props.isLoading&&(0,C.tZ)(p.Z,null),!this.props.isLoading&&this.state.filteredSlices.length>0&&(0,C.tZ)(V,{width:376,height:e,rowCount:this.state.filteredSlices.length,rowHeight:128,rowRenderer:this.rowRenderer,searchTerm:this.state.searchTerm,sortBy:this.state.sortBy,selectedSliceIds:this.props.selectedSliceIds}),this.props.errorMessage&&(0,C.tZ)("div",{className:"error-message"},this.props.errorMessage),(0,C.tZ)(pe,{slices:this.state.filteredSlices}))}}We.propTypes=qe,We.defaultProps=$e;const Be=We,He=(0,i.$j)((function(e,t){let{sliceEntities:n,dashboardInfo:r,dashboardState:i}=e;return{height:t.height,userId:r.userId,dashboardId:r.id,selectedSliceIds:i.sliceIds,slices:n.slices,isLoading:n.isLoading,errorMessage:n.errorMessage,lastUpdated:n.lastUpdated,editMode:i.editMode,filterboxMigrationState:i.filterboxMigrationState}}),(function(e){return(0,r.DE)({fetchAllSlices:E.To,fetchSortedSlices:E.Fv,fetchFilteredSlices:E.uC},e)}))(Be),Ge=e=>{let{registryKeys:t,registry:n}=e;return()=>t.map((e=>n[e]))},Ye=e=>{let{registryKeys:t,registry:n}=e;return e=>{t=t.filter((t=>t!==e)),delete n[e]}},Je=e=>{let{registry:t}=e;return e=>t[e]},Qe=function(e){void 0===e&&(e=[]);const t={registry:{},registryKeys:[]},n=(e=>{let{registryKeys:t,registry:n}=e;return(e,r)=>{t.push(e),n[e]={key:e,metadata:r.metadata,Component:s.lazy(r.loadComponent)}}})(t);return e.forEach((e=>{let{key:t,item:r}=e;n(t,r)})),{set:n,get:Je(t),delete:Ye(t),getAll:Ge(t)}}([]),Xe={id:d().string.isRequired,type:d().string.isRequired,label:d().string.isRequired,className:d().string};class et extends s.PureComponent{render(){const{label:e,id:t,type:n,className:r,meta:i}=this.props;return(0,C.tZ)(je,{component:{type:n,id:t,meta:i},parentComponent:{id:Y.D0,type:f.F0},index:0,depth:0,editMode:!0},(t=>{let{dragSourceRef:n}=t;return(0,C.tZ)("div",{ref:n,className:"new-component"},(0,C.tZ)("div",{className:v()("new-component-placeholder",r)}),e)}))}}function tt(){return(0,C.tZ)(et,{id:Y.Nb,type:f.BA,label:(0,c.t)("Column"),className:"fa fa-long-arrow-down"})}function nt(){return(0,C.tZ)(et,{id:Y.ES,type:f.hE,label:(0,c.t)("Divider"),className:"divider-placeholder"})}function rt(){return(0,C.tZ)(et,{id:Y.Z1,type:f.Nc,label:(0,c.t)("Header"),className:"fa fa-header"})}function it(){return(0,C.tZ)(et,{id:Y.vD,type:f.Os,label:(0,c.t)("Row"),className:"fa fa-long-arrow-right"})}function ot(){return(0,C.tZ)(et,{id:Y.NN,type:f.yR,label:(0,c.t)("Tabs"),className:"fa fa-window-restore"})}function at(){return(0,C.tZ)(et,{id:Y.C3,type:f.xh,label:"Markdown",className:"fa fa-code"})}et.propTypes=Xe,et.defaultProps={className:null};const st=e=>{let{componentKey:t,metadata:n}=e;return(0,C.tZ)(et,{id:Y.gR,type:f.t,label:n.name,meta:{metadata:n,componentKey:t},className:`fa fa-${n.iconName}`})},lt=(0,y.iK)(x.ZP)`
  line-height: inherit;
  margin-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,dt=y.iK.div`
  height: calc(100% - ${210}px);
  position: fixed;
  right: 0;
  top: 0;
`,ct=e=>{let{isStandalone:t,topOffset:n=0}=e;return(0,C.tZ)(dt,{topOffset:n,className:"dashboard-builder-sidepane"},(0,C.tZ)(_,null,(e=>{let{height:r}=e;return(0,C.tZ)(w.L9,null,(0,C.tZ)(w.Le,{topOffset:-n,bottomOffset:1/0},(e=>{let{style:i,isSticky:o}=e;const{pageYOffset:a}=window,s=a<59&&!t,l=n+(59-a-4);return(0,C.tZ)("div",{className:"viewport",style:{...i,top:s?l:n}},(0,C.tZ)(lt,{id:"tabs",className:"tabs-components"},(0,C.tZ)(x.ZP.TabPane,{key:1,tab:(0,c.t)("Charts"),className:"tab-charts"},(0,C.tZ)(He,{height:r+(o?59:0)})),(0,C.tZ)(x.ZP.TabPane,{key:2,tab:(0,c.t)("Layout elements")},(0,C.tZ)(ot,null),(0,C.tZ)(it,null),(0,C.tZ)(tt,null),(0,C.tZ)(rt,null),(0,C.tZ)(at,null),(0,C.tZ)(nt,null),Qe.getAll().map((e=>{let{key:t,metadata:n}=e;return(0,C.tZ)(st,{metadata:n,componentKey:t})})))))})))})))};var ut=n(74599),ht=n(30381),pt=n.n(ht),ft=n(75049),mt=n(78161),gt=n(91877),vt=n(3741),bt=n(12617),yt=n(9679),Ct=n(31069),St=n(83862),xt=n(27600),wt=n(10222),kt=n(68492),Zt=n(23525);const Rt=e=>{const{copyMenuItemTitle:t,emailMenuItemTitle:n,emailSubject:r,emailBody:o,addDangerToast:a,addSuccessToast:s,dashboardId:l,dashboardComponentId:d,...u}=e,{dataMask:h,activeTabs:p}=(0,i.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs})));async function f(){return(0,Zt.Nm)({dashboardId:l,dataMask:h,activeTabs:p,anchor:d})}return(0,C.tZ)(St.v,{selectable:!1},(0,C.tZ)(St.v.Item,ee()({key:"copy-url"},u),(0,C.tZ)("div",{onClick:async function(){try{await(0,wt.Z)(f),s((0,c.t)("Copied to clipboard!"))}catch(e){kt.Z.error(e),a((0,c.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},t)),(0,C.tZ)(St.v.Item,ee()({key:"share-by-email"},u),(0,C.tZ)("div",{onClick:async function(){try{const e=encodeURIComponent(`${o}${await f()}`),t=encodeURIComponent(r);window.location.href=`mailto:?Subject=${t}%20&Body=${e}`}catch(e){kt.Z.error(e),a((0,c.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},n)))};var Tt=n(1304),Ft=n(94670);const Dt=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    .css-editor-header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      margin-bottom: ${2*t.gridUnit}px;\n\n      h5 {\n        margin-top: ${t.gridUnit}px;\n      }\n    }\n    .css-editor {\n      border: 1px solid ${t.colors.grayscale.light1};\n    }\n  `}}
`,_t={initialCss:d().string,triggerNode:d().node.isRequired,onChange:d().func,templates:d().array};class Et extends s.PureComponent{constructor(e){super(e),this.state={css:e.initialCss},this.changeCss=this.changeCss.bind(this),this.changeCssTemplate=this.changeCssTemplate.bind(this)}componentDidMount(){Ft.ry.preload()}changeCss(e){this.setState({css:e},(()=>{this.props.onChange(e)}))}changeCssTemplate(e){let{key:t}=e;this.changeCss(t)}renderTemplateSelector(){if(this.props.templates){const e=(0,C.tZ)(St.v,{onClick:this.changeCssTemplate},this.props.templates.map((e=>(0,C.tZ)(St.v.Item,{key:e.css},e.label))));return(0,C.tZ)(B.Gj,{overlay:e,placement:"bottomRight"},(0,C.tZ)(H.Z,null,(0,c.t)("Load a CSS template")))}return null}render(){return(0,C.tZ)(Tt.Z,{triggerNode:this.props.triggerNode,modalTitle:(0,c.t)("CSS"),modalBody:(0,C.tZ)(Dt,null,(0,C.tZ)("div",{className:"css-editor-header"},(0,C.tZ)("h5",null,(0,c.t)("Live CSS editor")),this.renderTemplateSelector()),(0,C.tZ)(Ft.ry,{className:"css-editor",minLines:12,maxLines:30,onChange:this.changeCss,height:"200px",width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.css||""}))})}}Et.propTypes=_t,Et.defaultProps={initialCss:"",onChange:()=>{}};const It=Et;var Mt=n(81315),Ot=n(29487),Pt=n(49238);const Nt=[[0,(0,c.t)("Don't refresh")],[10,(0,c.t)("10 seconds")],[30,(0,c.t)("30 seconds")],[60,(0,c.t)("1 minute")],[300,(0,c.t)("5 minutes")],[1800,(0,c.t)("30 minutes")],[3600,(0,c.t)("1 hour")],[21600,(0,c.t)("6 hours")],[43200,(0,c.t)("12 hours")],[86400,(0,c.t)("24 hours")]].map((e=>({value:e[0],label:e[1]}))),jt=(0,y.iK)(Tt.Z)`
  .ant-modal-body {
    overflow: visible;
  }
`,qt=y.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
`;class $t extends s.PureComponent{constructor(e){super(e),this.modalRef=void 0,this.modalRef=s.createRef(),this.state={refreshFrequency:e.refreshFrequency},this.handleFrequencyChange=this.handleFrequencyChange.bind(this),this.onSave=this.onSave.bind(this),this.onCancel=this.onCancel.bind(this)}onSave(){var e,t;this.props.onChange(this.state.refreshFrequency,this.props.editMode),null==(e=this.modalRef)||null==(t=e.current)||t.close(),this.props.addSuccessToast((0,c.t)("Refresh interval saved"))}onCancel(){var e,t;this.setState({refreshFrequency:this.props.refreshFrequency}),null==(e=this.modalRef)||null==(t=e.current)||t.close()}handleFrequencyChange(e){this.setState({refreshFrequency:e||Nt[0].value})}render(){const{refreshLimit:e=0,refreshWarning:t,editMode:n}=this.props,{refreshFrequency:r=0}=this.state,i=!!r&&!!t&&r<e;return(0,C.tZ)(jt,{ref:this.modalRef,triggerNode:this.props.triggerNode,modalTitle:(0,c.t)("Refresh interval"),modalBody:(0,C.tZ)("div",null,(0,C.tZ)(Pt.lX,null,(0,c.t)("Refresh frequency")),(0,C.tZ)(Mt.ZP,{ariaLabel:(0,c.t)("Refresh interval"),options:Nt,value:r,onChange:this.handleFrequencyChange,sortComparator:(0,Mt.mj)("value")}),i&&(0,C.tZ)(qt,null,(0,C.tZ)(Ot.Z,{type:"warning",message:(0,C.tZ)(s.Fragment,null,(0,C.tZ)("div",null,t),(0,C.tZ)("br",null),(0,C.tZ)("strong",null,(0,c.t)("Are you sure you want to proceed?")))}))),modalFooter:(0,C.tZ)(s.Fragment,null,(0,C.tZ)(H.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave},n?(0,c.t)("Save"):(0,c.t)("Save for this session")),(0,C.tZ)(H.Z,{onClick:this.onCancel,buttonSize:"small"},(0,c.t)("Cancel")))})}}$t.defaultProps={refreshLimit:0,refreshWarning:null};const zt=$t;var At=n(87183),Ut=n(87253);const Lt={saveType:Y.TN,colorNamespace:void 0,colorScheme:void 0,shouldPersistRefreshFrequency:!1};class Vt extends s.PureComponent{constructor(e){super(e),this.modal=void 0,this.onSave=void 0,this.state={saveType:e.saveType,newDashName:`${e.dashboardTitle} [copy]`,duplicateSlices:!1},this.handleSaveTypeChange=this.handleSaveTypeChange.bind(this),this.handleNameChange=this.handleNameChange.bind(this),this.saveDashboard=this.saveDashboard.bind(this),this.toggleDuplicateSlices=this.toggleDuplicateSlices.bind(this),this.onSave=this.props.onSave.bind(this),this.modal=s.createRef()}toggleDuplicateSlices(){this.setState((e=>({duplicateSlices:!e.duplicateSlices})))}handleSaveTypeChange(e){this.setState({saveType:e.target.value})}handleNameChange(e){this.setState({newDashName:e,saveType:Y.kS})}saveDashboard(){var e;const{saveType:t,newDashName:n}=this.state,{dashboardTitle:r,dashboardInfo:i,layout:o,customCss:a,dashboardId:s,refreshFrequency:l,shouldPersistRefreshFrequency:d,lastModifiedTime:u}=this.props,h=d?l:null==(e=i.metadata)?void 0:e.refresh_frequency,p={certified_by:i.certified_by,certification_details:i.certification_details,css:a,dashboard_title:t===Y.kS?n:r,duplicate_slices:this.state.duplicateSlices,last_modified_time:u,owners:i.owners,roles:i.roles,metadata:{...null==i?void 0:i.metadata,positions:o,refresh_frequency:h}};var f,m;t!==Y.kS||n?(this.onSave(p,s,t).then((e=>{t===Y.kS&&e&&e.json&&e.json.id&&(window.location.href=`/superset/dashboard/${e.json.id}/`)})),null==(f=this.modal)||null==(m=f.current)||null==m.close||m.close()):this.props.addDangerToast((0,c.t)("You must pick a name for the new dashboard"))}render(){return(0,C.tZ)(Tt.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalTitle:(0,c.t)("Save dashboard"),modalBody:(0,C.tZ)("div",null,(0,C.tZ)(At.Y,{value:Y.TN,onChange:this.handleSaveTypeChange,checked:this.state.saveType===Y.TN,disabled:!this.props.canOverwrite},(0,c.t)("Overwrite Dashboard [%s]",this.props.dashboardTitle)),(0,C.tZ)("hr",null),(0,C.tZ)(At.Y,{value:Y.kS,onChange:this.handleSaveTypeChange,checked:this.state.saveType===Y.kS},(0,c.t)("Save as:")),(0,C.tZ)(W.II,{type:"text",placeholder:(0,c.t)("[dashboard name]"),value:this.state.newDashName,onFocus:e=>this.handleNameChange(e.target.value),onChange:e=>this.handleNameChange(e.target.value)}),(0,C.tZ)("div",{className:"m-l-25 m-t-5"},(0,C.tZ)(Ut.ZP,{checked:this.state.duplicateSlices,onChange:()=>this.toggleDuplicateSlices()}),(0,C.tZ)("span",{className:"m-l-5"},(0,c.t)("also copy (duplicate) charts")))),modalFooter:(0,C.tZ)("div",null,(0,C.tZ)(H.Z,{buttonStyle:"primary",onClick:this.saveDashboard},(0,c.t)("Save")))})}}Vt.defaultProps=Lt;const Kt=Vt;var Wt=n(97634),Bt=n(14505),Ht=n(81395),Gt=n(31758),Yt=n(41609),Jt=n.n(Yt);const Qt=[f.gn,f.U0];function Xt(e){let{currentNode:t={},components:n={},filterFields:r=[],selectedChartId:i}=e;if(!t)return null;const{type:o}=t;if(f.dW===o&&t&&t.meta&&t.meta.chartId){const e={value:t.meta.chartId,label:t.meta.sliceName||`${o} ${t.meta.chartId}`,type:o,showCheckbox:i!==t.meta.chartId};return{...e,children:r.map((n=>({value:`${t.meta.chartId}:${n}`,label:`${e.label}`,type:"filter_box",showCheckbox:!1})))}}let s=[];if(t.children&&t.children.length&&t.children.forEach((e=>{const t=Xt({currentNode:n[e],components:n,filterFields:r,selectedChartId:i}),o=n[e].type;a()(Qt).call(Qt,o)?s.push(t):s=s.concat(t)})),a()(Qt).call(Qt,o)){let e=null;return e=o===f.U0?(0,c.t)("All charts"):t.meta&&t.meta.text?t.meta.text:`${o} ${t.id}`,{value:t.id,label:e,type:o,children:s}}return s}function en(e){let{components:t={},filterFields:n=[],selectedChartId:r}=e;return Jt()(t)?[]:[{...Xt({currentNode:t[Y._4],components:t,filterFields:n,selectedChartId:r})}]}function tn(e,t){void 0===e&&(e=[]),void 0===t&&(t=-1);const n=[],r=(e,i)=>{e&&e.children&&(-1===t||i<t)&&(n.push(e.value),e.children.forEach((e=>r(e,i+1))))};return e.length>0&&e.forEach((e=>{r(e,0)})),n}function nn(e){let{activeFilterField:t,checkedFilterFields:n}=e;return(0,yt.o)(t?[t]:n)}var rn=n(20194);function on(e){let{activeFilterField:t,checkedFilterFields:n}=e;if(t)return(0,rn._)(t).chartId;if(n.length){const{chartId:e}=(0,rn._)(n[0]);return n.some((t=>(0,rn._)(t).chartId!==e))?null:e}return null}function an(e){let{checkedFilterFields:t=[],activeFilterField:n,filterScopeMap:r={},layout:i={}}=e;const o=nn({checkedFilterFields:t,activeFilterField:n}),a=n?[n]:t,s=en({components:i,filterFields:a,selectedChartId:on({checkedFilterFields:t,activeFilterField:n})}),l=new Set;a.forEach((e=>{(r[e].checked||[]).forEach((t=>{l.add(`${t}:${e}`)}))}));const d=[...l],c=r[o]?r[o].expanded:tn(s,1);return{[o]:{nodes:s,nodesFiltered:[...s],checked:d,expanded:c}}}var sn=n(94654),ln=n.n(sn),dn=n(83927),cn=n.n(dn),un=n(58809),hn=n.n(un),pn=n(8816),fn=n.n(pn);function mn(e){let{tabScopes:t,parentNodeValue:n,forceAggregate:r=!1,hasChartSiblings:i=!1,tabChildren:o=[],immuneChartSiblings:s=[]}=e;if(r||!i&&Object.entries(t).every((e=>{let[t,{scope:n}]=e;return n&&n.length&&t===n[0]}))){const e=function(e){let{tabs:t=[],tabsInScope:n=[]}=e;const r=[];return t.forEach((e=>{let{value:t,children:i}=e;i&&!a()(n).call(n,t)&&i.forEach((e=>{let{value:t,children:i}=e;i&&!a()(n).call(n,t)&&r.push(...i.filter((e=>{let{type:t}=e;return t===f.dW})))}))})),r.map((e=>{let{value:t}=e;return t}))}({tabs:o,tabsInScope:ln()(t,(e=>{let{scope:t}=e;return t}))}),r=ln()(Object.values(t),(e=>{let{immune:t}=e;return t}));return{scope:[n],immune:[...new Set([...e,...r])]}}const l=Object.values(t).filter((e=>{let{scope:t}=e;return t&&t.length}));return{scope:ln()(l,(e=>{let{scope:t}=e;return t})),immune:l.length?ln()(l,(e=>{let{immune:t}=e;return t})):ln()(Object.values(t),(e=>{let{immune:t}=e;return t})).concat(s)}}function gn(e){let{currentNode:t={},filterId:n,checkedChartIds:r=[]}=e;if(!t)return{};const{value:i,children:o}=t,s=o.filter((e=>{let{type:t}=e;return t===f.dW})),l=o.filter((e=>{let{type:t}=e;return t===f.gn})),d=s.filter((e=>{let{value:t}=e;return n!==t&&!a()(r).call(r,t)})).map((e=>{let{value:t}=e;return t})),c=fn()(hn()((e=>e.value)),cn()((e=>gn({currentNode:e,filterId:n,checkedChartIds:r}))))(l);if(!Jt()(s)&&s.some((e=>{let{value:t}=e;return a()(r).call(r,t)}))){if(Jt()(l))return{scope:[i],immune:d};const{scope:e,immune:t}=mn({tabScopes:c,parentNodeValue:i,forceAggregate:!0,tabChildren:l});return{scope:e,immune:d.concat(t)}}return l.length?mn({tabScopes:c,parentNodeValue:i,hasChartSiblings:!Jt()(s),tabChildren:l,immuneChartSiblings:d}):{scope:[],immune:d}}function vn(e){let{filterKey:t,nodes:n=[],checkedChartIds:r=[]}=e;if(n.length){const{chartId:e}=(0,rn._)(t);return gn({currentNode:n[0],filterId:e,checkedChartIds:r})}return{}}var bn=n(43399),yn=n(28388),Cn=n.n(yn);const Sn=(0,y.iK)(G.Z.BarChartOutlined)`
  ${e=>{let{theme:t}=e;return`\n    position: relative;\n    top: ${t.gridUnit-1}px;\n    color: ${t.colors.primary.base};\n    margin-right: ${2*t.gridUnit}px;\n  `}}
`;function xn(e){let{currentNode:t={},selectedChartId:n}=e;if(!t)return null;const{label:r,value:i,type:o,children:a}=t;if(a&&a.length){const e=a.map((e=>xn({currentNode:e,selectedChartId:n})));return{...t,label:(0,C.tZ)("span",{className:v()(`filter-scope-type ${o.toLowerCase()}`,{"selected-filter":n===i})},o===f.dW&&(0,C.tZ)(Sn,null),r),children:e}}return{...t,label:(0,C.tZ)("span",{className:v()(`filter-scope-type ${o.toLowerCase()}`,{"selected-filter":n===i})},r)}}function wn(e){let{nodes:t,selectedChartId:n}=e;return t?t.map((e=>xn({currentNode:e,selectedChartId:n}))):[]}var kn=n(13842);const Zn={check:(0,C.tZ)(kn.lU,null),uncheck:(0,C.tZ)(kn.zq,null),halfCheck:(0,C.tZ)(kn.dc,null),expandClose:(0,C.tZ)("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:(0,C.tZ)("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:(0,C.tZ)("span",{className:"rct-icon rct-icon-expand-all"},(0,c.t)("Expand all")),collapseAll:(0,C.tZ)("span",{className:"rct-icon rct-icon-collapse-all"},(0,c.t)("Collapse all")),parentClose:(0,C.tZ)("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:(0,C.tZ)("span",{className:"rct-icon rct-icon-parent-open"}),leaf:(0,C.tZ)("span",{className:"rct-icon rct-icon-leaf"})},Rn={nodes:d().arrayOf(J.ck).isRequired,checked:d().arrayOf(d().oneOfType([d().number,d().string])).isRequired,expanded:d().arrayOf(d().oneOfType([d().number,d().string])).isRequired,onCheck:d().func.isRequired,onExpand:d().func.isRequired,selectedChartId:d().number},Tn=()=>{};function Fn(e){let{nodes:t=[],checked:n=[],expanded:r=[],onCheck:i,onExpand:o,selectedChartId:a}=e;return(0,C.tZ)(Cn(),{showExpandAll:!0,expandOnClick:!0,showNodeIcon:!1,nodes:wn({nodes:t,selectedChartId:a}),checked:n,expanded:r,onCheck:i,onExpand:o,onClick:Tn,icons:Zn})}Fn.propTypes=Rn,Fn.defaultProps={selectedChartId:null};const Dn={label:d().string.isRequired,isSelected:d().bool.isRequired};function _n(e){let{label:t,isSelected:n}=e;return(0,C.tZ)("span",{className:v()("filter-field-item filter-container",{"is-selected":n})},(0,C.tZ)(Pt.lX,{htmlFor:t},t))}function En(e){let{nodes:t,activeKey:n}=e;if(!t)return[];const r=t[0],i=r.children.map((e=>({...e,children:e.children.map((e=>{const{label:t,value:r}=e;return{...e,label:(0,C.tZ)(_n,{isSelected:r===n,label:t})}}))})));return[{...r,label:(0,C.tZ)("span",{className:"root"},r.label),children:i}]}_n.propTypes=Dn;const In={activeKey:d().string,nodes:d().arrayOf(J.ck).isRequired,checked:d().arrayOf(d().oneOfType([d().number,d().string])).isRequired,expanded:d().arrayOf(d().oneOfType([d().number,d().string])).isRequired,onCheck:d().func.isRequired,onExpand:d().func.isRequired,onClick:d().func.isRequired};function Mn(e){let{activeKey:t,nodes:n=[],checked:r=[],expanded:i=[],onClick:o,onCheck:a,onExpand:s}=e;return(0,C.tZ)(Cn(),{showExpandAll:!0,showNodeIcon:!1,expandOnClick:!0,nodes:En({nodes:n,activeKey:t}),checked:r,expanded:i,onClick:o,onCheck:a,onExpand:s,icons:Zn})}Mn.propTypes=In,Mn.defaultProps={activeKey:null};const On={dashboardFilters:d().objectOf(J.Er).isRequired,layout:d().object.isRequired,updateDashboardFiltersScope:d().func.isRequired,setUnsavedChanges:d().func.isRequired,onCloseModal:d().func.isRequired},Pn=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    height: ${16*t.gridUnit}px;\n\n    border-top: ${t.gridUnit/4}px solid ${t.colors.primary.light3};\n    padding: ${6*t.gridUnit}px;\n    margin: 0 0 0 ${6*-t.gridUnit}px;\n    text-align: right;\n\n    .btn {\n      margin-right: ${4*t.gridUnit}px;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  `}}
`;class Nn extends s.PureComponent{constructor(e){super(e);const{dashboardFilters:t,layout:n}=e;if(Object.keys(t).length>0){const e=function(e){let{dashboardFilters:t={}}=e;const n=Object.values(t).map((e=>{const{chartId:t,filterName:n,columns:r,labels:i}=e,o=Object.keys(r).map((e=>({value:(0,rn.w)({chartId:t,column:e}),label:i[e]||e})));return{value:t,label:n,children:o,showCheckbox:!0}}));return[{value:Y.dU,type:f.U0,label:(0,c.t)("All filters"),children:n}]}({dashboardFilters:t}),r=e[0].children;this.allfilterFields=[],r.forEach((e=>{let{children:t}=e;t.forEach((e=>{this.allfilterFields.push(e.value)}))})),this.defaultFilterKey=r[0].children[0].value;const i=Object.values(t).reduce(((e,r)=>{let{chartId:i,columns:o}=r;return{...e,...Object.keys(o).reduce(((e,r)=>{const o=(0,rn.w)({chartId:i,column:r}),a=en({components:n,filterFields:[o],selectedChartId:i}),s=tn(a,1),l=((0,bn.up)({filterScope:t[i].scopes[r]})||[]).filter((e=>e!==i));return{...e,[o]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:s}}}),{})}}),{}),{chartId:o}=(0,rn._)(this.defaultFilterKey),a=[],s=this.defaultFilterKey,l=[Y.dU].concat(o),d=an({checkedFilterFields:a,activeFilterField:s,filterScopeMap:i,layout:n});this.state={showSelector:!0,activeFilterField:s,searchText:"",filterScopeMap:{...i,...d},filterFieldNodes:e,checkedFilterFields:a,expandedFilterIds:l}}else this.state={showSelector:!1};this.filterNodes=this.filterNodes.bind(this),this.onChangeFilterField=this.onChangeFilterField.bind(this),this.onCheckFilterScope=this.onCheckFilterScope.bind(this),this.onExpandFilterScope=this.onExpandFilterScope.bind(this),this.onSearchInputChange=this.onSearchInputChange.bind(this),this.onCheckFilterField=this.onCheckFilterField.bind(this),this.onExpandFilterField=this.onExpandFilterField.bind(this),this.onClose=this.onClose.bind(this),this.onSave=this.onSave.bind(this)}onCheckFilterScope(e){void 0===e&&(e=[]);const{activeFilterField:t,filterScopeMap:n,checkedFilterFields:r}=this.state,i=nn({activeFilterField:t,checkedFilterFields:r}),o=t?[t]:r,a={...n[i],checked:e},s=function(e){let{checked:t=[],filterFields:n=[],filterScopeMap:r={}}=e;const i=t.reduce(((e,t)=>{const[n,r]=t.split(":");return{...e,[r]:(e[r]||[]).concat(parseInt(n,10))}}),{});return n.reduce(((e,t)=>{const{chartId:n}=(0,rn._)(t),o=(i[t]||[]).filter((e=>e!==n));return{...e,[t]:{...r[t],checked:o}}}),{})}({checked:e,filterFields:o,filterScopeMap:n});this.setState((()=>({filterScopeMap:{...n,...s,[i]:a}})))}onExpandFilterScope(e){void 0===e&&(e=[]);const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:r}=this.state,i=nn({activeFilterField:t,checkedFilterFields:n}),o={...r[i],expanded:e};this.setState((()=>({filterScopeMap:{...r,[i]:o}})))}onCheckFilterField(e){void 0===e&&(e=[]);const{layout:t}=this.props,{filterScopeMap:n}=this.state,r=an({checkedFilterFields:e,activeFilterField:null,filterScopeMap:n,layout:t});this.setState((()=>({activeFilterField:null,checkedFilterFields:e,filterScopeMap:{...n,...r}})))}onExpandFilterField(e){void 0===e&&(e=[]),this.setState((()=>({expandedFilterIds:e})))}onChangeFilterField(e){var t;void 0===e&&(e={});const{layout:n}=this.props,r=e.value,{activeFilterField:i,checkedFilterFields:o,filterScopeMap:s}=this.state;if(r===i){const e=an({checkedFilterFields:o,activeFilterField:null,filterScopeMap:s,layout:n});this.setState({activeFilterField:null,filterScopeMap:{...s,...e}})}else if(a()(t=this.allfilterFields).call(t,r)){const e=an({checkedFilterFields:o,activeFilterField:r,filterScopeMap:s,layout:n});this.setState({activeFilterField:r,filterScopeMap:{...s,...e}})}}onSearchInputChange(e){this.setState({searchText:e.target.value},this.filterTree)}onClose(){this.props.onCloseModal()}onSave(){const{filterScopeMap:e}=this.state,t=this.allfilterFields.reduce(((t,n)=>{const{nodes:r}=e[n];return{...t,[n]:vn({filterKey:n,nodes:r,checkedChartIds:e[n].checked})}}),{});this.props.updateDashboardFiltersScope(t),this.props.setUnsavedChanges(!0),this.props.onCloseModal()}filterTree(){if(this.state.searchText){const e=e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:r}=e,i=nn({activeFilterField:t,checkedFilterFields:n}),o=r[i].nodes.reduce(this.filterNodes,[]),a=tn([...o]),s={...r[i],nodesFiltered:o,expanded:a};return{filterScopeMap:{...r,[i]:s}}};this.setState(e)}else this.setState((e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:r}=e,i=nn({activeFilterField:t,checkedFilterFields:n}),o={...r[i],nodesFiltered:r[i].nodes};return{filterScopeMap:{...r,[i]:o}}}))}filterNodes(e,t){void 0===e&&(e=[]),void 0===t&&(t={});const{searchText:n}=this.state,r=(t.children||[]).reduce(this.filterNodes,[]);return(t.label.toLocaleLowerCase().indexOf(n.toLocaleLowerCase())>-1||r.length)&&e.push({...t,children:r}),e}renderFilterFieldList(){const{activeFilterField:e,filterFieldNodes:t,checkedFilterFields:n,expandedFilterIds:r}=this.state;return(0,C.tZ)(Mn,{activeKey:e,nodes:t,checked:n,expanded:r,onClick:this.onChangeFilterField,onCheck:this.onCheckFilterField,onExpand:this.onExpandFilterField})}renderFilterScopeTree(){const{filterScopeMap:e,activeFilterField:t,checkedFilterFields:n,searchText:r}=this.state,i=nn({activeFilterField:t,checkedFilterFields:n}),o=on({activeFilterField:t,checkedFilterFields:n});return(0,C.tZ)(s.Fragment,null,(0,C.tZ)("input",{className:"filter-text scope-search multi-edit-mode",placeholder:(0,c.t)("Search..."),type:"text",value:r,onChange:this.onSearchInputChange}),(0,C.tZ)(Fn,{nodes:e[i].nodesFiltered,checked:e[i].checked,expanded:e[i].expanded,onCheck:this.onCheckFilterScope,onExpand:this.onExpandFilterScope,selectedChartId:o}))}renderEditingFiltersName(){const{dashboardFilters:e}=this.props,{activeFilterField:t,checkedFilterFields:n}=this.state,r=[].concat(t||n).map((t=>{const{chartId:n,column:r}=(0,rn._)(t);return e[n].labels[r]||r}));return(0,C.tZ)("div",{className:"selected-fields multi-edit-mode"},0===r.length&&(0,c.t)("No filter is selected."),1===r.length&&(0,c.t)("Editing 1 filter:"),r.length>1&&(0,c.t)("Batch editing %d filters:",r.length),(0,C.tZ)("span",{className:"selected-scopes"},r.join(", ")))}render(){const{showSelector:e}=this.state;return(0,C.tZ)("div",{className:"filter-scope-container"},(0,C.tZ)("div",{className:"filter-scope-header"},(0,C.tZ)("h4",null,(0,c.t)("Configure filter scopes")),e&&this.renderEditingFiltersName()),(0,C.tZ)("div",{className:"filter-scope-body"},e?(0,C.tZ)("div",{className:"filters-scope-selector"},(0,C.tZ)("div",{className:v()("filter-field-pane multi-edit-mode")},this.renderFilterFieldList()),(0,C.tZ)("div",{className:"filter-scope-pane multi-edit-mode"},this.renderFilterScopeTree())):(0,C.tZ)("div",{className:"warning-message"},(0,c.t)("There are no filters in this dashboard."))),(0,C.tZ)(Pn,null,(0,C.tZ)(H.Z,{buttonSize:"small",onClick:this.onClose},(0,c.t)("Close")),e&&(0,C.tZ)(H.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.onSave},(0,c.t)("Save"))))}}Nn.propTypes=On;const jn=(0,i.$j)((function(e){let{dashboardLayout:t,dashboardFilters:n}=e;return{dashboardFilters:n,layout:t.present}}),(function(e){return(0,r.DE)({updateDashboardFiltersScope:Ht.l6,setUnsavedChanges:Gt.if},e)}))(Nn),qn=y.iK.div((e=>{let{theme:{gridUnit:t}}=e;return{padding:2*t,paddingBottom:3*t}}));class $n extends s.PureComponent{constructor(e){super(e),this.modal=void 0,this.modal=s.createRef(),this.handleCloseModal=this.handleCloseModal.bind(this)}handleCloseModal(){var e,t;null==this||null==(e=this.modal)||null==(t=e.current)||null==t.close||t.close()}render(){const e={onCloseModal:this.handleCloseModal};return(0,C.tZ)(Tt.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalBody:(0,C.tZ)(qn,null,(0,C.tZ)(jn,e)),width:"80%"})}}var zn=n(56727),An=n(11370);function Un(e){let{pathname:t,filters:n={},hash:r="",standalone:i}=e;const o=new URLSearchParams;o.set(xt.KD.preselectFilters.name,JSON.stringify((0,An.Z)(n))),i&&o.set(xt.KD.standalone.name,i.toString());const a=(0,Zt.eY)(xt.KD.nativeFiltersKey);a&&o.set(xt.KD.nativeFiltersKey.name,a);const s=r?`#${r}`:"";return`${t}?${o.toString()}${s}`}const Ln={addSuccessToast:d().func.isRequired,addDangerToast:d().func.isRequired,dashboardInfo:d().object.isRequired,dashboardId:d().number.isRequired,dashboardTitle:d().string.isRequired,dataMask:d().object.isRequired,customCss:d().string.isRequired,colorNamespace:d().string,colorScheme:d().string,onChange:d().func.isRequired,updateCss:d().func.isRequired,forceRefreshAllCharts:d().func.isRequired,refreshFrequency:d().number.isRequired,shouldPersistRefreshFrequency:d().bool.isRequired,setRefreshFrequency:d().func.isRequired,startPeriodicRender:d().func.isRequired,editMode:d().bool.isRequired,userCanEdit:d().bool.isRequired,userCanShare:d().bool.isRequired,userCanSave:d().bool.isRequired,userCanCurate:d().bool.isRequired,isLoading:d().bool.isRequired,layout:d().object.isRequired,expandedSlices:d().object.isRequired,onSave:d().func.isRequired,showPropertiesModal:d().func.isRequired,manageEmbedded:d().func.isRequired,refreshLimit:d().number,refreshWarning:d().string,lastModifiedTime:d().number.isRequired,filterboxMigrationState:Q.Qi},Vn={colorNamespace:void 0,colorScheme:void 0,refreshLimit:0,refreshWarning:null,filterboxMigrationState:Q.Qi.NOOP},Kn="refresh-dashboard",Wn="edit-properties",Bn="download-as-image",Hn="toggle-fullscreen",Gn="manage-embedded";class Yn extends s.PureComponent{static discardChanges(){window.location.reload()}constructor(e){super(e),this.state={css:e.customCss,cssTemplates:[],showReportSubMenu:null},this.changeCss=this.changeCss.bind(this),this.changeRefreshInterval=this.changeRefreshInterval.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.setShowReportSubMenu=this.setShowReportSubMenu.bind(this)}UNSAFE_componentWillMount(){Ct.Z.get({endpoint:"/csstemplateasyncmodelview/api/read"}).then((e=>{let{json:t}=e;const n=t.result.map((e=>({value:e.template_name,css:e.css,label:e.template_name})));this.setState({cssTemplates:n})})).catch((()=>{this.props.addDangerToast((0,c.t)("An error occurred while fetching available CSS templates"))}))}UNSAFE_componentWillReceiveProps(e){this.props.customCss!==e.customCss&&this.setState({css:e.customCss},(()=>{(0,Bt.Z)(e.customCss)}))}setShowReportSubMenu(e){this.setState({showReportSubMenu:e})}changeCss(e){this.props.onChange(),this.props.updateCss(e)}changeRefreshInterval(e,t){this.props.setRefreshFrequency(e,t),this.props.startPeriodicRender(1e3*e)}handleMenuClick(e){let{key:t,domEvent:n}=e;switch(t){case Kn:this.props.forceRefreshAllCharts(),this.props.addSuccessToast((0,c.t)("Refreshing charts"));break;case Wn:this.props.showPropertiesModal();break;case Bn:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,zn.Z)(".dashboard",this.props.dashboardTitle,!0)(n).then((()=>{e.style.visibility="visible"}));break}case Hn:{const e=Un({pathname:window.location.pathname,filters:(0,bn.De)(),hash:window.location.hash,standalone:!(0,Zt.eY)(xt.KD.standalone)});window.location.replace(e);break}case Gn:this.props.manageEmbedded()}}render(){const{dashboardTitle:e,dashboardId:t,dashboardInfo:n,refreshFrequency:r,shouldPersistRefreshFrequency:i,editMode:o,customCss:a,colorNamespace:l,colorScheme:d,layout:u,expandedSlices:h,onSave:p,userCanEdit:f,userCanShare:m,userCanSave:g,userCanCurate:v,isLoading:b,refreshLimit:y,refreshWarning:S,lastModifiedTime:x,addSuccessToast:w,addDangerToast:k,filterboxMigrationState:Z,setIsDropdownVisible:R,isDropdownVisible:T,...F}=this.props,D=`${(0,c.t)("Superset dashboard")} ${e}`,_=(0,c.t)("Check out this dashboard: "),E=Un({pathname:window.location.pathname,filters:(0,bn.De)(),hash:window.location.hash});return(0,C.tZ)(St.v,ee()({selectable:!1},F),!o&&(0,C.tZ)(St.v.Item,{key:Kn,disabled:b,onClick:this.handleMenuClick},(0,c.t)("Refresh dashboard")),!o&&(0,C.tZ)(St.v.Item,{key:Hn,onClick:this.handleMenuClick},(0,Zt.eY)(xt.KD.standalone)?(0,c.t)("Exit fullscreen"):(0,c.t)("Enter fullscreen")),o&&(0,C.tZ)(St.v.Item,{key:Wn,onClick:this.handleMenuClick},(0,c.t)("Edit properties")),o&&(0,C.tZ)(St.v.Item,{key:"edit-css"},(0,C.tZ)(It,{triggerNode:(0,C.tZ)("span",null,(0,c.t)("Edit CSS")),initialCss:this.state.css,templates:this.state.cssTemplates,onChange:this.changeCss})),(0,C.tZ)(St.v.Divider,null),g&&(0,C.tZ)(St.v.Item,{key:"save-modal"},(0,C.tZ)(Kt,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:t,dashboardTitle:e,dashboardInfo:n,saveType:Y.kS,layout:u,expandedSlices:h,refreshFrequency:r,shouldPersistRefreshFrequency:i,lastModifiedTime:x,customCss:a,colorNamespace:l,colorScheme:d,onSave:p,triggerNode:(0,C.tZ)("span",null,(0,c.t)("Save as")),canOverwrite:f})),!o&&(0,C.tZ)(St.v.Item,{key:Bn,onClick:this.handleMenuClick},(0,c.t)("Download as image")),m&&(0,C.tZ)(St.v.SubMenu,{key:"share-dashboard",disabled:b,title:(0,c.t)("Share")},(0,C.tZ)(Rt,{url:E,copyMenuItemTitle:(0,c.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,c.t)("Share permalink by email"),emailSubject:D,emailBody:_,addSuccessToast:w,addDangerToast:k,dashboardId:t})),!o&&v&&(0,C.tZ)(St.v.Item,{key:Gn,onClick:this.handleMenuClick},(0,c.t)("Embed dashboard")),(0,C.tZ)(St.v.Divider,null),o?null:this.state.showReportSubMenu?(0,C.tZ)(s.Fragment,null,(0,C.tZ)(St.v.SubMenu,{title:(0,c.t)("Manage email report")},(0,C.tZ)(Wt.Z,{dashboardId:n.id,setShowReportSubMenu:this.setShowReportSubMenu,showReportSubMenu:this.state.showReportSubMenu,setIsDropdownVisible:R,isDropdownVisible:T,useTextMenu:!0})),(0,C.tZ)(St.v.Divider,null)):(0,C.tZ)(St.v,null,(0,C.tZ)(Wt.Z,{dashboardId:n.id,setShowReportSubMenu:this.setShowReportSubMenu,setIsDropdownVisible:R,isDropdownVisible:T,useTextMenu:!0})),o&&Z!==Q.Qi.CONVERTED&&(0,C.tZ)(St.v.Item,{key:"set-filter-mapping"},(0,C.tZ)($n,{className:"m-r-5",triggerNode:(0,c.t)("Set filter mapping")})),(0,C.tZ)(St.v.Item,{key:"autorefresh-modal"},(0,C.tZ)(zt,{addSuccessToast:this.props.addSuccessToast,refreshFrequency:r,refreshLimit:y,refreshWarning:S,onChange:this.changeRefreshInterval,editMode:o,triggerNode:(0,C.tZ)("span",null,(0,c.t)("Set auto-refresh interval"))})))}}Yn.propTypes=Ln,Yn.defaultProps=Vn;const Jn=Yn;var Qn=n(37921);const Xn={dashboardId:d().number.isRequired,isPublished:d().bool.isRequired,savePublished:d().func.isRequired,canEdit:d().bool.isRequired,canSave:d().bool.isRequired},er=(0,c.t)("This dashboard is not published, it will not show up in the list of dashboards. Click here to publish this dashboard."),tr=(0,c.t)("This dashboard is not published which means it will not show up in the list of dashboards. Favorite it to see it there or access it by using the URL directly."),nr=(0,c.t)("This dashboard is published. Click to make it a draft.");class rr extends s.Component{componentDidMount(){this.togglePublished=this.togglePublished.bind(this)}togglePublished(){this.props.savePublished(this.props.dashboardId,!this.props.isPublished)}render(){return this.props.isPublished?this.props.canEdit&&this.props.canSave?(0,C.tZ)(ne.u,{id:"published-dashboard-tooltip",placement:"bottom",title:nr},(0,C.tZ)(Qn.Z,{onClick:()=>{this.togglePublished()}},(0,c.t)("Published"))):null:this.props.canEdit&&this.props.canSave?(0,C.tZ)(ne.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:er},(0,C.tZ)(Qn.Z,{onClick:()=>{this.togglePublished()}},(0,c.t)("Draft"))):(0,C.tZ)(ne.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:tr},(0,C.tZ)(Qn.Z,null,(0,c.t)("Draft")))}}rr.propTypes=Xn;const ir={onUndo:d().func.isRequired,onRedo:d().func.isRequired};class or extends s.PureComponent{constructor(e){super(e),this.handleKeydown=this.handleKeydown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}handleKeydown(e){if(e.ctrlKey||e.metaKey){const t="z"===e.key||90===e.keyCode,n="y"===e.key||89===e.keyCode,r=document&&document.querySelector(".dashboard-markdown--editing"),i=document&&document.querySelector(".editable-title--editing");r||i||!t&&!n||(e.preventDefault(),(t?this.props.onUndo:this.props.onRedo)())}}render(){return null}}or.propTypes=ir;const ar=or;var sr=n(20818),lr=n(5558);const dr=e=>{e&&clearInterval(e)};var cr=n(52564),ur=n(22102),hr=n(9882),pr=n(74069),fr=n(14114);const mr=(0,ft.I)(),gr=e=>e.split(/(?:\s|,)+/).filter((e=>e)),vr=y.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
`,br=e=>{var t;let{dashboardId:n,onHide:r}=e;const{addInfoToast:i,addDangerToast:o}=(0,fr.e1)(),[a,l]=(0,s.useState)(!0),[d,u]=(0,s.useState)(!1),[h,f]=(0,s.useState)(null),[m,g]=(0,s.useState)(""),v=`/api/v1/dashboard/${n}/embedded`,b=!h||gr(m).join()!==h.allowed_domains.join(),y=(0,s.useCallback)((()=>{u(!0),(0,ur.Z)({method:"POST",endpoint:v})({allowed_domains:gr(m)}).then((e=>{let{result:t}=e;f(t),g(t.allowed_domains.join(", ")),i((0,c.t)("Changes saved."))}),(e=>{console.error(e),o((0,c.t)((0,c.t)("Sorry, something went wrong. The changes could not be saved.")))})).finally((()=>{u(!1)}))}),[v,m]),S=(0,s.useCallback)((()=>{pr.Z.confirm({title:(0,c.t)("Disable embedding?"),content:(0,c.t)("This will remove your current embed configuration."),okType:"danger",onOk:()=>{u(!0),(0,ur.Z)({method:"DELETE",endpoint:v})({}).then((()=>{f(null),g(""),i((0,c.t)("Embedding deactivated.")),r()}),(e=>{console.error(e),o((0,c.t)("Sorry, something went wrong. Embedding could not be deactivated."))})).finally((()=>{u(!1)}))}})}),[v]);if((0,s.useEffect)((()=>{l(!1),(0,ur.Z)({method:"GET",endpoint:v})({}).catch((e=>{if(404===e.status)return{result:null};throw e})).then((e=>{let{result:t}=e;l(!0),f(t),g(t?t.allowed_domains.join(", "):"")}))}),[n]),!a)return(0,C.tZ)(p.Z,null);const x=mr.get("embedded.documentation.configuration_details"),w=mr.get("embedded.documentation.description"),k=null!=(t=mr.get("embedded.documentation.url"))?t:"https://www.npmjs.com/package/@superset-ui/embedded-sdk";return(0,C.tZ)(s.Fragment,null,h?x?(0,C.tZ)(x,{embeddedId:h.uuid}):(0,C.tZ)("p",null,(0,c.t)("This dashboard is ready to embed. In your application, pass the following id to the SDK:"),(0,C.tZ)("br",null),(0,C.tZ)("code",null,h.uuid)):(0,C.tZ)("p",null,(0,c.t)("Configure this dashboard to embed it into an external web application.")),(0,C.tZ)("p",null,(0,c.t)("For further instructions, consult the")," ",(0,C.tZ)("a",{href:k,target:"_blank",rel:"noreferrer"},w?w():(0,c.t)("Superset Embedded SDK documentation."))),(0,C.tZ)("h3",null,"Settings"),(0,C.tZ)(Pt.xJ,null,(0,C.tZ)("label",{htmlFor:"allowed-domains"},(0,c.t)("Allowed Domains (comma separated)")," ",(0,C.tZ)(hr.V,{tooltip:(0,c.t)("A list of domain names that can embed this dashboard. Leaving this field empty will allow embedding from any domain.")})),(0,C.tZ)(W.II,{name:"allowed-domains",value:m,placeholder:"superset.example.com",onChange:e=>g(e.target.value)})),(0,C.tZ)(vr,null,h?(0,C.tZ)(s.Fragment,null,(0,C.tZ)(H.Z,{onClick:S,buttonStyle:"secondary",loading:d},(0,c.t)("Deactivate")),(0,C.tZ)(H.Z,{onClick:y,buttonStyle:"primary",disabled:!b,loading:d},(0,c.t)("Save changes"))):(0,C.tZ)(H.Z,{onClick:y,buttonStyle:"primary",loading:d},(0,c.t)("Enable embedding"))))},yr=e=>{const{show:t,onHide:n}=e;return(0,C.tZ)(pr.Z,{show:t,onHide:n,title:(0,c.t)("Embed"),hideFooter:!0},(0,C.tZ)(br,e))},Cr=(0,ft._)(),Sr={addSuccessToast:d().func.isRequired,addDangerToast:d().func.isRequired,addWarningToast:d().func.isRequired,user:lr.UserWithPermissionsAndRoles,dashboardInfo:d().object.isRequired,dashboardTitle:d().string.isRequired,dataMask:d().object.isRequired,charts:d().objectOf(J.$6).isRequired,layout:d().object.isRequired,expandedSlices:d().object.isRequired,customCss:d().string.isRequired,colorNamespace:d().string,colorScheme:d().string,setColorSchemeAndUnsavedChanges:d().func.isRequired,isStarred:d().bool.isRequired,isPublished:d().bool.isRequired,isLoading:d().bool.isRequired,onSave:d().func.isRequired,onChange:d().func.isRequired,fetchFaveStar:d().func.isRequired,fetchCharts:d().func.isRequired,saveFaveStar:d().func.isRequired,savePublished:d().func.isRequired,updateDashboardTitle:d().func.isRequired,editMode:d().bool.isRequired,setEditMode:d().func.isRequired,showBuilderPane:d().func.isRequired,updateCss:d().func.isRequired,logEvent:d().func.isRequired,hasUnsavedChanges:d().bool.isRequired,maxUndoHistoryExceeded:d().bool.isRequired,lastModifiedTime:d().number.isRequired,onRefresh:d().func.isRequired,onUndo:d().func.isRequired,onRedo:d().func.isRequired,undoLength:d().number.isRequired,redoLength:d().number.isRequired,setMaxUndoHistoryExceeded:d().func.isRequired,maxUndoHistoryToast:d().func.isRequired,refreshFrequency:d().number.isRequired,shouldPersistRefreshFrequency:d().bool.isRequired,setRefreshFrequency:d().func.isRequired,dashboardInfoChanged:d().func.isRequired,dashboardTitleChanged:d().func.isRequired},xr=e=>C.iv`
  border-bottom: 1px solid ${e.colors.grayscale.light2};
`,wr=e=>C.iv`
  color: ${e.colors.primary.dark2};
`,kr=e=>C.iv`
  display: flex;
  align-items: center;

  .action-schedule-report {
    margin-left: ${2*e.gridUnit}px;
  }

  .undoRedo {
    display: flex;
    margin-right: ${2*e.gridUnit}px;
  }
`,Zr=(0,y.iK)(B.C0)`
  padding: 0;
  &:hover {
    background: transparent;
  }
`,Rr=e=>C.iv`
  color: ${e.colors.grayscale.light1};
  &:hover {
    color: ${e.colors.grayscale.base};
  }
`,Tr=e=>C.iv`
  color: ${e.colors.grayscale.base};
`,Fr=e=>C.iv`
  color: ${e.colors.grayscale.light2};
`,Dr=e=>C.iv`
  min-width: ${17*e.gridUnit}px;
  height: ${8*e.gridUnit}px;
`,_r=e=>C.iv`
  min-width: ${22*e.gridUnit}px;
  height: ${8*e.gridUnit}px;
`;class Er extends s.PureComponent{static discardChanges(){const e=new URL(window.location.href);e.searchParams.delete("edit"),window.location.assign(e)}constructor(e){super(e),this.showEmbedModal=()=>{this.setState({showingEmbedModal:!0})},this.hideEmbedModal=()=>{this.setState({showingEmbedModal:!1})},this.state={didNotifyMaxUndoHistoryToast:!1,emphasizeUndo:!1,emphasizeRedo:!1,showingPropertiesModal:!1,isDropdownVisible:!1},this.handleChangeText=this.handleChangeText.bind(this),this.handleCtrlZ=this.handleCtrlZ.bind(this),this.handleCtrlY=this.handleCtrlY.bind(this),this.toggleEditMode=this.toggleEditMode.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.startPeriodicRender=this.startPeriodicRender.bind(this),this.overwriteDashboard=this.overwriteDashboard.bind(this),this.showPropertiesModal=this.showPropertiesModal.bind(this),this.hidePropertiesModal=this.hidePropertiesModal.bind(this),this.setIsDropdownVisible=this.setIsDropdownVisible.bind(this)}componentDidMount(){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}componentDidUpdate(e){if(this.props.refreshFrequency!==e.refreshFrequency){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}}UNSAFE_componentWillReceiveProps(e){Y.Q9-e.undoLength<=0&&!this.state.didNotifyMaxUndoHistoryToast&&(this.setState((()=>({didNotifyMaxUndoHistoryToast:!0}))),this.props.maxUndoHistoryToast()),e.undoLength>Y.Q9&&!this.props.maxUndoHistoryExceeded&&this.props.setMaxUndoHistoryExceeded()}componentWillUnmount(){dr(this.refreshTimer),this.props.setRefreshFrequency(0),clearTimeout(this.ctrlYTimeout),clearTimeout(this.ctrlZTimeout)}handleChangeText(e){const{updateDashboardTitle:t,onChange:n}=this.props;e&&this.props.dashboardTitle!==e&&(t(e),n())}setIsDropdownVisible(e){this.setState({isDropdownVisible:e})}handleCtrlY(){this.props.onRedo(),this.setState({emphasizeRedo:!0},(()=>{this.ctrlYTimeout&&clearTimeout(this.ctrlYTimeout),this.ctrlYTimeout=setTimeout((()=>{this.setState({emphasizeRedo:!1})}),100)}))}handleCtrlZ(){this.props.onUndo(),this.setState({emphasizeUndo:!0},(()=>{this.ctrlZTimeout&&clearTimeout(this.ctrlZTimeout),this.ctrlZTimeout=setTimeout((()=>{this.setState({emphasizeUndo:!1})}),100)}))}forceRefresh(){if(!this.props.isLoading){const e=Object.keys(this.props.charts);return this.props.logEvent(vt.H3,{force:!0,interval:0,chartCount:e.length}),this.props.onRefresh(e,!0,0,this.props.dashboardInfo.id)}return!1}startPeriodicRender(e){let t;if(e){const n=Nt.find((t=>t.value===e/1e3));t=n?n.label:pt().duration(e,"millisecond").humanize()}this.refreshTimer=function(e){let{interval:t=0,periodicRender:n,refreshTimer:r}=e;return dr(r),t>0?setInterval(n,t):0}({interval:e,periodicRender:()=>{const{fetchCharts:n,logEvent:r,charts:i,dashboardInfo:o}=this.props,{metadata:a}=o,s=a.timed_refresh_immune_slices||[],l=Object.values(i).filter((e=>-1===s.indexOf(e.id))).map((e=>e.id));return r(vt.S,{interval:e,chartCount:l.length}),this.props.addWarningToast((0,c.t)("This dashboard is currently auto refreshing; the next auto refresh will be in %s.",t)),"fetch"===o.common.conf.DASHBOARD_AUTO_REFRESH_MODE?n(l,!1,.2*e,o.id):n(l,!0,.2*e,o.id)},refreshTimer:this.refreshTimer})}toggleEditMode(){this.props.logEvent(vt.vH,{edit_mode:!this.props.editMode}),this.props.setEditMode(!this.props.editMode)}overwriteDashboard(){var e,t,n;const{dashboardTitle:r,layout:i,colorScheme:o,colorNamespace:a,customCss:s,dashboardInfo:l,refreshFrequency:d,shouldPersistRefreshFrequency:u,lastModifiedTime:h,slug:p}=this.props,f=u?d:null==(e=l.metadata)?void 0:e.refresh_frequency,m=(null==l||null==(t=l.metadata)?void 0:t.color_scheme)||o,g=(null==l||null==(n=l.metadata)?void 0:n.color_namespace)||a,v=(0,mt.Z)().getColorMap(g,m),b={certified_by:l.certified_by,certification_details:l.certification_details,css:s,dashboard_title:r,last_modified_time:h,owners:l.owners,roles:l.roles,slug:p,metadata:{...null==l?void 0:l.metadata,color_namespace:g,color_scheme:m,positions:i,refresh_frequency:f,shared_label_colors:v}},y=(0,yt.o)(i).length,C=l.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT||Y.Bu;y>=C?this.props.addDangerToast((0,c.t)("Your dashboard is too large. Please reduce its size before saving it.")):(y>=.9*C&&this.props.addWarningToast("Your dashboard is near the size limit."),this.props.onSave(b,l.id,Y.TN))}showPropertiesModal(){this.setState({showingPropertiesModal:!0})}hidePropertiesModal(){this.setState({showingPropertiesModal:!1})}render(){var e,t,n,r;const{dashboardTitle:i,layout:o,expandedSlices:a,customCss:s,colorNamespace:l,dataMask:d,setColorSchemeAndUnsavedChanges:h,colorScheme:p,onUndo:f,onRedo:m,undoLength:g,redoLength:v,onChange:b,onSave:y,updateCss:S,editMode:x,isPublished:w,user:k,dashboardInfo:Z,hasUnsavedChanges:R,isLoading:T,refreshFrequency:F,shouldPersistRefreshFrequency:D,setRefreshFrequency:_,lastModifiedTime:E,filterboxMigrationState:I}=this.props,M=Z.dash_edit_perm&&I!==Q.Qi.REVIEWING&&!Z.is_managed_externally,O=Z.dash_share_perm,P=Z.dash_save_perm&&I!==Q.Qi.REVIEWING,N=(0,gt.cr)(u.T.EMBEDDED_SUPERSET)&&(0,bt.R)("can_set_embedded","Dashboard",k.roles),j=null==(e=Z.common)||null==(t=e.conf)?void 0:t.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT,q=null==(n=Z.common)||null==(r=n.conf)?void 0:r.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE,$=Cr.get("dashboard.nav.right");return(0,C.tZ)("div",{css:xr,"data-test-id":Z.id,className:"dashboard-header-container"},(0,C.tZ)(cr.u,{editableTitleProps:{title:i,canEdit:M&&x,onSave:this.handleChangeText,placeholder:(0,c.t)("Add the name of the dashboard"),label:(0,c.t)("Dashboard title"),showTooltip:!1},certificatiedBadgeProps:{certifiedBy:Z.certified_by,details:Z.certification_details},faveStarProps:{itemId:Z.id,fetchFaveStar:this.props.fetchFaveStar,saveFaveStar:this.props.saveFaveStar,isStarred:this.props.isStarred,showTooltip:!0},titlePanelAdditionalItems:(0,C.tZ)(rr,{dashboardId:Z.id,isPublished:w,savePublished:this.props.savePublished,canEdit:M,canSave:P}),rightPanelAdditionalItems:(0,C.tZ)("div",{className:"button-container"},P&&(0,C.tZ)("div",{className:"button-container"},x&&(0,C.tZ)("div",{css:kr},(0,C.tZ)("div",{className:"undoRedo"},(0,C.tZ)(ne.u,{id:"dashboard-undo-tooltip",title:(0,c.t)("Undo the action")},(0,C.tZ)(Zr,{type:"text",disabled:g<1},(0,C.tZ)(G.Z.Undo,{css:[Rr,this.state.emphasizeUndo&&Tr,g<1&&Fr,"",""],onClick:g&&f,iconSize:"xl"}))),(0,C.tZ)(ne.u,{id:"dashboard-redo-tooltip",title:(0,c.t)("Redo the action")},(0,C.tZ)(Zr,{type:"text",disabled:v<1},(0,C.tZ)(G.Z.Redo,{css:[Rr,this.state.emphasizeRedo&&Tr,v<1&&Fr,"",""],onClick:v&&m,iconSize:"xl"})))),(0,C.tZ)(H.Z,{css:_r,buttonSize:"small",onClick:this.constructor.discardChanges,buttonStyle:"default","aria-label":(0,c.t)("Discard")},(0,c.t)("Discard")),(0,C.tZ)(H.Z,{css:Dr,buttonSize:"small",disabled:!R,buttonStyle:"primary",onClick:this.overwriteDashboard,"aria-label":(0,c.t)("Save")},(0,c.t)("Save")))),x?(0,C.tZ)(ar,{onUndo:this.handleCtrlZ,onRedo:this.handleCtrlY}):(0,C.tZ)("div",{css:kr},$&&(0,C.tZ)($,null),M&&(0,C.tZ)(H.Z,{buttonStyle:"secondary",onClick:this.toggleEditMode,className:"action-button",css:wr,"aria-label":(0,c.t)("Edit dashboard")},(0,c.t)("Edit dashboard")))),menuDropdownProps:{getPopupContainer:e=>e.closest(".header-with-actions"),visible:this.state.isDropdownVisible,onVisibleChange:this.setIsDropdownVisible},additionalActionsMenu:(0,C.tZ)(Jn,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:Z.id,dashboardTitle:i,dashboardInfo:Z,dataMask:d,layout:o,expandedSlices:a,customCss:s,colorNamespace:l,colorScheme:p,onSave:y,onChange:b,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:F,shouldPersistRefreshFrequency:D,setRefreshFrequency:_,updateCss:S,editMode:x,hasUnsavedChanges:R,userCanEdit:M,userCanShare:O,userCanSave:P,userCanCurate:N,isLoading:T,showPropertiesModal:this.showPropertiesModal,manageEmbedded:this.showEmbedModal,refreshLimit:j,refreshWarning:q,lastModifiedTime:E,filterboxMigrationState:I,isDropdownVisible:this.state.isDropdownVisible,setIsDropdownVisible:this.setIsDropdownVisible}),showFaveStar:(null==k?void 0:k.userId)&&(null==Z?void 0:Z.id),showTitlePanelItems:!x}),this.state.showingPropertiesModal&&(0,C.tZ)(sr.Z,{dashboardId:Z.id,dashboardInfo:Z,dashboardTitle:i,show:this.state.showingPropertiesModal,onHide:this.hidePropertiesModal,colorScheme:this.props.colorScheme,onSubmit:e=>{const{dashboardInfoChanged:t,dashboardTitleChanged:n}=this.props;t({slug:e.slug,metadata:JSON.parse(e.jsonMetadata||"{}"),certified_by:e.certifiedBy,certification_details:e.certificationDetails,owners:e.owners,roles:e.roles}),h(e.colorScheme),n(e.title)},onlyApply:!0}),N&&(0,C.tZ)(yr,{show:this.state.showingEmbedModal,onHide:this.hideEmbedModal,dashboardId:Z.id}),(0,C.tZ)(C.xB,{styles:C.iv`
            .ant-menu-vertical {
              border-right: none;
            }
          `}))}}Er.propTypes=Sr,Er.defaultProps={colorNamespace:void 0,colorScheme:void 0};const Ir=Er;function Mr(e){return Object.values(e).some((e=>e.chartUpdateStartTime>(e.chartUpdateEndTime||0)))}var Or=n(41295),Pr=n(40701),Nr=n(72570),jr=n(97381),qr=n(61358);const $r=(0,i.$j)((function(e){let{dashboardLayout:t,dashboardState:n,reports:r,dashboardInfo:i,charts:o,dataMask:a,user:s}=e;return{dashboardInfo:i,undoLength:t.past.length,redoLength:t.future.length,layout:t.present,dashboardTitle:((t.present[Y.M2]||{}).meta||{}).text,expandedSlices:n.expandedSlices,refreshFrequency:n.refreshFrequency,shouldPersistRefreshFrequency:!!n.shouldPersistRefreshFrequency,customCss:n.css,colorNamespace:n.colorNamespace,colorScheme:n.colorScheme,charts:o,dataMask:a,user:s,isStarred:!!n.isStarred,isPublished:!!n.isPublished,isLoading:Mr(o),hasUnsavedChanges:!!n.hasUnsavedChanges,maxUndoHistoryExceeded:!!n.maxUndoHistoryExceeded,lastModifiedTime:Math.max(n.lastModifiedTime,i.last_modified_time),editMode:!!n.editMode,slug:i.slug,metadata:i.metadata,reports:r,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,r.DE)({addSuccessToast:Nr.ws,addDangerToast:Nr.Gb,addWarningToast:Nr.Dz,onUndo:Pr.Ou,onRedo:Pr.az,setEditMode:Gt.Mb,showBuilderPane:Gt.O8,setColorSchemeAndUnsavedChanges:Gt.ps,fetchFaveStar:Gt.Lb,saveFaveStar:Gt.TN,savePublished:Gt.dr,fetchCharts:Gt.Mn,updateDashboardTitle:Pr.A7,updateCss:Gt.Sn,onChange:Gt.z2,onSave:Gt.M8,setMaxUndoHistoryExceeded:Gt.uN,maxUndoHistoryToast:Gt.Qt,logEvent:jr.logEvent,setRefreshFrequency:Gt.fE,onRefresh:Gt.Yy,dashboardInfoChanged:Or.a8,dashboardTitleChanged:Pr.Ww,updateDataMask:ut.eG,fetchUISpecificReport:qr.Aw},e)}))(Ir),zr=y.iK.div`
  display: flex;
  align-items: center;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  &:hover {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }
`,Ar=y.iK.span`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,Ur=e=>{let{icon:t,label:n,onClick:r}=e;return(0,C.tZ)(zr,{tabIndex:0,role:"button",onClick:e=>{e.preventDefault(),r(e)}},t,n&&(0,C.tZ)(Ar,null,n))};var Lr,Vr=n(52256),Kr=n(91914),Wr=n(18446),Br=n.n(Wr),Hr=n(5977),Gr=n(12515),Yr=n(74435),Jr=n(99543),Qr=n(40219),Xr=n(29147),ei=n(38270),ti=n(73727),ni=n(11064),ri=n(16355),ii=n(88694),oi=n(32873),ai=n(65013);!function(e){e[e.all=0]="all",e[e.specific=1]="specific"}(Lr||(Lr={}));const si=(e,t)=>{var n,r;let{type:i,meta:o}=e;return!(i!==f.gn&&i!==f.dW&&i!==f.U0||t&&"filter_box"===(null==(n=t[null==o?void 0:o.chartId])||null==(r=n.form_data)?void 0:r.viz_type))},li=(e,t,n,r,i,o,s)=>{let l=t;if(si(e,r)&&e.type!==f.U0&&a()(i).call(i,e.id)){var d;const n=s(e.meta.sliceNameOverride||e.meta.sliceName||e.meta.text||e.meta.defaultText||e.id.toString(),a()(o).call(o,null==(d=e.meta)?void 0:d.chartId),(0,c.t)("This chart might be incompatible with the filter (datasets don't match)")),r={key:e.id,title:n,children:[]};t.children.push(r),l=r}e.children.forEach((e=>li(n[e],l,n,r,i,o,s)))},di=(e,t,n,r)=>{n.forEach((n=>{var i,o;di(e,t,((e,t)=>{var n;return[...(null==(n=e[t])?void 0:n.children)||[],...Object.values(e).filter((n=>n.parents&&n.parents[n.parents.length-1]===t&&!si(e[n.parents[n.parents.length-1]]))).map((e=>{let{id:t}=e;return t}))]})(t,n),r),(null==(i=t[n])?void 0:i.type)!==f.dW||a()(r).call(r,null==(o=t[n])?void 0:o.meta.chartId)||e.push(n)}))},ci=function(e,t){return void 0===t&&(t=[]),{rootPath:[Y._4],excluded:e?[e,...t]:t}},ui=(e,t)=>!e||e.rootPath[0]===Y._4&&!e.excluded.filter((e=>e!==t)).length,hi=(e,t,n)=>{let r=(0,C.tZ)("span",null,e);return t&&(r=(0,C.tZ)(s.Fragment,null,r," ",(0,C.tZ)(ne.u,{title:n},(0,C.tZ)(G.Z.Info,{iconSize:"m"})))),r},pi=e=>{let{formScope:t,initialScope:n,forceUpdate:r,updateFormValues:o,chartId:l,initiallyExcludedCharts:d=[]}=e;const[u,h]=(0,s.useState)([Y._4]),{treeData:p,layout:m}=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=e=>e);const r=(0,i.v9)((e=>{let{dashboardLayout:{present:t}}=e;return t})),o=(0,i.v9)((e=>{let{charts:t}=e;return t})),a={children:[],key:Y._4,type:f.U0,title:(0,c.t)("All panels")},l=(0,s.useMemo)((()=>Object.values(r).reduce(((t,n)=>{const{id:r,parents:i=[],type:o,meta:a}=n;return o===f.dW&&e!==(null==a?void 0:a.chartId)?[...new Set([...t,...i,r])]:t}),[])),[r,e]);return(0,s.useMemo)((()=>{li(r[Y._4],a,r,o,l,t,n)}),[r,a,o,t,n]),{treeData:[a],layout:r}}(l,d,hi),[g,v]=(0,s.useState)(!0),b=(0,s.useMemo)((()=>((e,t)=>{const n=[];return di(n,t,[...e.rootPath],[...e.excluded]),[...new Set(n)]})({...t||n},m)),[t,n,m]);return(0,C.tZ)(B.mp,{checkable:!0,selectable:!1,onExpand:e=>{h(e),v(!1)},expandedKeys:u,autoExpandParent:g,onCheck:e=>{r();const t=((e,t)=>{if(!e.length)return{rootPath:[],excluded:[]};const n=e.filter((e=>{var n;return(null==(n=t[e])?void 0:n.type)===f.dW})).map((e=>{var n;return[Y._4,...(null==(n=t[e])?void 0:n.parents)||[]].filter((e=>si(t[e])))}));n.sort(((e,t)=>e.length-t.length));const r=n.map((e=>e[n[0].length-1])),i=[];return Object.entries(t).forEach((t=>{var n;let[o,s]=t;const l=s.parents||[];s.type===f.dW&&null!=(n=[Y._4,...l])&&n.find((t=>((t,n)=>a()(r).call(r,t)&&!a()(e).call(e,n))(t,o)))&&i.push(s.meta.chartId)})),{rootPath:[...new Set(r)],excluded:i}})(e,m);void 0!==l&&(t.excluded=[...new Set([...t.excluded,l])]),o({scope:t})},checkedKeys:b,treeData:p})},fi=y.iK.div`
  display: flex;
  flex-direction: column;
  & > * {
    margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
  padding: 0px ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,mi=(0,y.iK)(B.qz.Item)`
  margin-bottom: 0;
`,gi=e=>{let{pathToFormValue:t=[],formScopingType:n,formFilterScope:r,forceUpdate:i,filterScope:o,updateFormValues:a,chartId:l,initiallyExcludedCharts:d}=e;const[u]=(0,s.useState)(o||ci(l,d)),[h]=(0,s.useState)(ui(u,l)?Lr.all:Lr.specific),[p,f]=(0,s.useState)(!!o),m=(0,s.useCallback)((e=>{a(e),f(!0)}),[a]),g=(0,s.useCallback)((()=>{if(o||p)return;const e=ci(l,d);a({scope:e,scoping:ui(e,l)?Lr.all:Lr.specific})}),[l,o,p,d,a]);return(0,ai.d)(g),(0,C.tZ)(fi,null,(0,C.tZ)(mi,{name:[...t,"scoping"],initialValue:h},(0,C.tZ)(At.Y.Group,{onChange:e=>{let{target:{value:t}}=e;if(t===Lr.all){const e=ci(l);a({scope:e})}f(!0),i()}},(0,C.tZ)(At.Y,{value:Lr.all},(0,c.t)("Apply to all panels")),(0,C.tZ)(At.Y,{value:Lr.specific},(0,c.t)("Apply to specific panels")))),(0,C.tZ)(B.ZT.Text,{type:"secondary"},(null!=n?n:h)===Lr.specific?(0,c.t)("Only selected panels will be affected by this filter"):(0,c.t)("All panels with this column will be affected by this filter")),(null!=n?n:h)===Lr.specific&&(0,C.tZ)(pi,{updateFormValues:m,initialScope:u,formScope:r,forceUpdate:i,chartId:l,initiallyExcludedCharts:d}),(0,C.tZ)(mi,{name:[...t,"scope"],hidden:!0,initialValue:u}))};var vi=n(10752),bi=n.n(vi),yi=n(88889),Ci=n(55786);const Si="filters",xi={filter_time:[yi.Z.TEMPORAL],filter_timegrain:[yi.Z.TEMPORAL],filter_timecolumn:[yi.Z.TEMPORAL],filter_select:[yi.Z.BOOLEAN,yi.Z.STRING,yi.Z.NUMERIC,yi.Z.TEMPORAL],filter_range:[yi.Z.NUMERIC]},wi=()=>{const[,e]=s.useState({});return s.useCallback((()=>e({})),[])},ki=(e,t,n)=>{const r=e.getFieldValue(Si)||{};e.setFields([{name:Si,value:{...r,[t]:{...r[t],...n}}}])},Zi=e=>({value:e.id,label:e.table_name}),Ri=e=>{const t=(0,Ci.Z)(null==e?void 0:e.column_types);return 0===t.length||a()(t).call(t,yi.Z.TEMPORAL)},Ti=(e,t)=>{var n;return!t.type_generic||!(e in xi)||(null==(n=xi[e])?void 0:a()(n).call(n,t.type_generic))},Fi=e=>{let{form:t,scope:n,chartId:r}=e;const i=wi(),o=t.getFieldValue("scope"),a=t.getFieldValue("scoping");return(0,C.tZ)(gi,{updateFormValues:e=>{((e,t)=>{e.setFieldsValue({...t})})(t,{...e})},filterScope:n,chartId:r,formFilterScope:o,forceUpdate:i,formScopingType:a})};var Di=n(89734),_i=n.n(Di),Ei=n(44908),Ii=n.n(Ei),Mi=n(68122),Oi=n(53350),Pi=n(10916);const Ni=[];function ji(){return(0,i.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.native_filter_configuration)||Ni}))}function qi(){return(0,i.v9)((e=>{var t;return null==(t=e.dashboardLayout)?void 0:t.present}))}function $i(){const e=qi();return(0,s.useMemo)((()=>Object.values(e).some((e=>e.type===f.gn))),[e])}var zi=n(27034),Ai=n(22068);const Ui="FILTER",Li=y.iK.div`
  ${e=>{let{isDragging:t,theme:n}=e;return`\n    opacity: ${t?.3:1};\n    cursor: ${t?"grabbing":"pointer"};\n    width: 100%;\n    display: flex;\n    padding:  ${n.gridUnit}px;\n  `}}
`,Vi=(0,y.iK)(G.Z.Drag,{shouldForwardProp:e=>"isDragging"!==e})`
  ${e=>{let{isDragging:t,theme:n}=e;return`\n    font-size: ${n.typography.sizes.m}px;\n    margin-top: 15px;\n    cursor: ${t?"grabbing":"grab"};\n    padding-left: ${n.gridUnit}px;\n  `}}
`;var Ki={name:"82a6rk",styles:"flex:1"};const Wi=e=>{let{index:t,onRearrange:n,filterIds:r,children:i}=e;const o=(0,s.useRef)(null),[{isDragging:a},l]=(0,zi.c)({item:{filterIds:r,type:Ui,index:t},collect:e=>({isDragging:e.isDragging()})}),[,d]=(0,Ai.L)({accept:Ui,hover:(e,r)=>{var i;if(!o.current)return;const a=e.index,s=t;if(a===s)return;const l=null==(i=o.current)?void 0:i.getBoundingClientRect(),d=(l.bottom-l.top)/2,c=r.getClientOffset().y-l.top;a<s&&c<d||a>s&&c>d||(n(a,s),e.index=s)}});return l(d(o)),(0,C.tZ)(Li,{ref:o,isDragging:a},(0,C.tZ)(Vi,{isDragging:a,alt:"Move icon",className:"dragIcon",viewBox:"4 4 16 16"}),(0,C.tZ)("div",{css:Ki},i))},Bi=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n      display: flex;\n      align-items: center;\n      padding: ${2*t.gridUnit}px;\n      width: 100%;\n      border-radius: ${t.borderRadius}px;\n      &.active {\n        color: ${t.colors.grayscale.dark1};\n        border-radius: ${t.borderRadius}px;\n        background-color: ${t.colors.secondary.light4};\n        span, .anticon {\n          color: ${t.colors.grayscale.dark1};\n        }\n      }\n      &:hover {\n        color: ${t.colors.primary.light1};\n        span, .anticon {\n          color: ${t.colors.primary.light1};\n        }\n      }\n      &.errored div, &.errored .warning {\n        color: ${t.colors.error.base};\n      }\n  `}}
`,Hi=(0,y.iK)(G.Z.Trash)`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
`,Gi=(0,y.iK)(G.Z.Warning)`
  color: ${e=>{let{theme:t}=e;return t.colors.error.base}};
  &.anticon {
    margin-left: auto;
  }
`,Yi=y.iK.div`
  height: 100%;
  overflow-y: auto;
`;var Ji={name:"7whenc",styles:"display:flex;width:100%"},Qi={name:"1vr7vmn",styles:"align-items:center;display:flex"},Xi={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"},eo={name:"an0ls6",styles:"align-self:flex-start;margin-left:auto"};const to=(0,s.forwardRef)(((e,t)=>{let{getFilterTitle:n,onChange:r,onRemove:i,restoreFilter:o,onRearrange:s,currentFilterId:l,removedFilters:d,filters:u,erroredFilters:h=[]}=e;return(0,C.tZ)(Yi,{ref:t},(()=>{const e=[];return u.forEach(((t,u)=>{e.push((0,C.tZ)(Wi,{key:u,onRearrange:s,index:u,filterIds:[t]},(e=>{const t=!!d[e],s=a()(h).call(h,e),u=l===e,p=[];return s&&p.push("errored"),u&&p.push("active"),(0,C.tZ)(Bi,{role:"tab",key:`filter-title-tab-${e}`,onClick:()=>r(e),className:p.join(" ")},(0,C.tZ)("div",{css:Ji},(0,C.tZ)("div",{css:Qi},t?(0,c.t)("(Removed)"):n(e)),!d[e]&&s&&(0,C.tZ)(Gi,{className:"warning"}),t&&(0,C.tZ)("span",{css:Xi,role:"button",tabIndex:0,onClick:t=>{t.preventDefault(),o(e)}},(0,c.t)("Undo?"))),(0,C.tZ)("div",{css:eo},t?null:(0,C.tZ)(Hi,{onClick:t=>{t.stopPropagation(),i(e)},alt:"RemoveFilter"})))})(t)))})),e})())})),no=to,ro=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n  cursor: pointer;\n  margin: ${4*t.gridUnit}px;\n  color: ${t.colors.primary.base};\n  &:hover {\n    color: ${t.colors.primary.dark1};\n  }\n`}}
`,io=y.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,oo=[{label:"Filter",type:Pi.BE.NATIVE_FILTER},{label:"Divider",type:Pi.BE.DIVIDER}],ao=e=>{let{getFilterTitle:t,onChange:n,onAdd:r,onRemove:i,onRearrange:o,restoreFilter:a,currentFilterId:l,filters:d,removedFilters:u,erroredFilters:h}=e;const p=(0,s.useRef)(null),f=(0,y.Fg)(),m=(0,C.tZ)(St.$,{mode:"horizontal"},oo.map((e=>(0,C.tZ)(St.$.Item,{onClick:()=>{return t=e.type,r(t),void setTimeout((()=>{var e;const t=document.getElementById("native-filters-tabs");if(t){const e=t.getElementsByClassName("ant-tabs-nav-list")[0];e.scrollTop=e.scrollHeight}null==p||null==(e=p.current)||null==e.scroll||e.scroll({top:p.current.scrollHeight,behavior:"smooth"})}),0);var t}},e.label))));return(0,C.tZ)(io,null,(0,C.tZ)(B.Gj,{overlay:m,arrow:!0,placement:"topLeft",trigger:["hover"]},(0,C.tZ)(ro,null,(0,C.tZ)("div",{className:"fa fa-plus"})," ",(0,C.tZ)("span",null,(0,c.t)("Add filters and dividers")))),(0,C.tZ)("div",{css:(0,C.iv)({height:"100%",overflowY:"auto",marginLeft:3*f.gridUnit},"","")},(0,C.tZ)(no,{ref:p,filters:d,currentFilterId:l,removedFilters:u,getFilterTitle:t,erroredFilters:h,onChange:n,onRemove:i,onRearrange:o,restoreFilter:a})))},so=y.iK.div`
  display: flex;
  height: 100%;
`,lo=y.iK.div`
  flex-grow: 3;
  margin-left: ${e=>{let{theme:t}=e;return-1*t.gridUnit-1}};
`,co=y.iK.div`
  width: 270px;
  border-right: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
`,uo=e=>{let{getFilterTitle:t,onChange:n,onRemove:r,onRearrange:i,restoreFilter:o,onAdd:a,erroredFilters:s,children:l,currentFilterId:d,filters:c,removedFilters:u}=e;const h=c.filter((e=>e===d))[0];return(0,C.tZ)(so,null,(0,C.tZ)(co,null,(0,C.tZ)(ao,{currentFilterId:d,filters:c,removedFilters:u,erroredFilters:s,getFilterTitle:t,onChange:n,onAdd:e=>a(e),onRearrange:i,onRemove:e=>r(e),restoreFilter:o})),(0,C.tZ)(lo,null,c.map((e=>(0,C.tZ)("div",{key:e,style:{height:"100%",overflowY:"auto",display:e===h?"":"none"}},l(e))))))};var ho=n(43700);const po=y.iK.div`
  display: flex;
  flex-direction: row;
  background-color: ${e=>{let{level:t,theme:n}=e;return n.colors[t].light2}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}}px;
  border: 1px solid ${e=>{let{level:t,theme:n}=e;return n.colors[t].base}};
  color: ${e=>{let{level:t,theme:n}=e;return n.colors[t].dark2}};
  padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  width: 100%;
`,fo=y.iK.div`
  display: flex;
  flex-direction: column;
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,mo=y.iK.span`
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
`;function go(e){let{body:t,level:n="error",title:r}=e;const i=(0,y.Fg)().colors[n].base;return(0,C.tZ)(po,{level:n,role:"alert"},"error"===n?(0,C.tZ)(G.Z.ErrorSolid,{iconColor:i}):(0,C.tZ)(G.Z.WarningSolid,{iconColor:i}),(0,C.tZ)(fo,null,(0,C.tZ)(mo,null,r),(0,C.tZ)("p",null,t)))}var vo=n(73375),bo=n(46566),yo=n(77997);const Co=function(e,t,n){return void 0===n&&(n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return JSON.stringify([...t])}),function(){const r=n(...arguments);if(t.has(r))return t.get(r);const i=e(...arguments);return t.set(r,i),i}};var So=n(78676),xo=n(1510);const wo=y.iK.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: ${e=>{let{theme:t}=e;return 10*t.gridUnit}}px;
  padding-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit+2}}px;

  .checkbox {
    margin-bottom: ${e=>{let{theme:t,checked:n}=e;return n?t.gridUnit:0}}px;
  }

  & > div {
    margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }
`,ko=y.iK.div`
  margin-left: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
`,Zo=e=>{const{checked:t,disabled:n,title:r,tooltip:i,children:o,onChange:a=(()=>{}),initialValue:l=!1}=e,[d,c]=(0,s.useState)(l);return(0,s.useEffect)((()=>{void 0!==t&&c(t)}),[t]),(0,C.tZ)(wo,{checked:d},(0,C.tZ)(B.r4,{className:"checkbox",checked:d,disabled:n,onChange:e=>{const n=e.target.checked;void 0===t&&c(n),a(n)}},(0,C.tZ)(s.Fragment,null,r," ",i&&(0,C.tZ)(hr.V,{placement:"top",tooltip:i}))),d&&(0,C.tZ)(ko,null,o))};var Ro=n(28615),To=n(98286);const Fo=new Map,Do=Co(Ct.Z.get,Fo,(e=>{let{endpoint:t}=e;return t||""}));function _o(e){var t;let{allowClear:n=!1,filterValues:r=(()=>!0),form:i,formField:o="column",filterId:l,datasetId:d,value:u,onChange:h,mode:p}=e;const[f,m]=(0,s.useState)(),{addDangerToast:g}=(0,fr.e1)(),v=(0,s.useCallback)((()=>{i.setFields([{name:["filters",l,o],touched:!1,value:null}])}),[i,l,o]),b=(0,s.useMemo)((()=>(0,Ci.Z)(f).filter(r).map((e=>e.column_name)).map((e=>({label:e,value:e})))),[f,r]),y=null==(t=i.getFieldValue("filters"))?void 0:t[l].filterType,S=(0,s.useMemo)((()=>null==f?void 0:f.find((e=>e.column_name===u))),[f,u]);return(0,s.useEffect)((()=>{S&&!Ti(y,S)&&v()}),[S,y,v]),(0,Ro.S)(d,(e=>{null!=e&&v(),null!=d&&Do({endpoint:`/api/v1/dataset/${d}`}).then((e=>{let{json:{result:t}}=e;const n=Array.isArray(u)?u:[u];t.columns.some((e=>null==n?void 0:a()(n).call(n,e.column_name)))||v(),m(t.columns)}),(async e=>{const{error:t,message:n}=await(0,To.O)(e);let r=n||t||(0,c.t)("An error has occurred");"Forbidden"===n&&(r=(0,c.t)("You do not have permission to edit this dashboard")),g(r)}))})),(0,C.tZ)(B.Ph,{mode:p,value:"multiple"===p?u||[]:u,ariaLabel:(0,c.t)("Column select"),onChange:h,options:b,placeholder:(0,c.t)("Select a column"),notFoundContent:(0,c.t)("No compatible columns found"),showSearch:!0,allowClear:n})}var Eo=n(15926),Io=n.n(Eo);const Mo=new Map,Oo=Co(Ct.Z.get,Mo,(e=>{let{endpoint:t}=e;return t||""})),Po=e=>{let{onChange:t,value:n}=e;const r=(0,s.useCallback)((e=>{let{error:t,message:n}=e,r=n||t||(0,c.t)("An error has occurred");return"Forbidden"===n&&(r=(0,c.t)("You do not have permission to edit this dashboard")),r}),[]);return(0,C.tZ)(B.qb,{ariaLabel:(0,c.t)("Dataset"),value:n,options:async(e,t,n)=>{const i="table_name",o=Io().encode({filters:[{col:i,opr:"ct",value:e}],page:t,page_size:n,order_column:i,order_direction:"asc"});return Oo({endpoint:`/api/v1/dataset/?q=${o}`}).then((e=>({data:e.json.result.map(Zi),totalCount:e.json.count}))).catch((async e=>{const t=r(await(0,To.O)(e));throw new Error(t)}))},onChange:t})},No=e=>(0,s.useMemo)((()=>(0,C.tZ)(Po,e)),[]);var jo=n(88274);const qo=e=>{var t,n,r;let{hasDefaultValue:i,filterId:o,hasDataset:a,form:s,setDataMask:l,formData:d,enableNoResults:u}=e;const h=(s.getFieldValue("filters")||{})[o],f=null==h?void 0:h.defaultValueQueriesData,m=a&&null===f,g=null==(t=h.defaultDataMask)||null==(n=t.filterState)?void 0:n.value,v=i&&null==g;return m?(0,C.tZ)(p.Z,{position:"inline-centered"}):(0,C.tZ)(jo.Z,{height:32,width:"filter_time"===(null==h?void 0:h.filterType)?350:250,appSection:ri.Tr.FILTER_CONFIG_MODAL,behaviors:[ri.cg.NATIVE_FILTER],formData:d,queriesData:a?null==h?void 0:h.defaultValueQueriesData:[{data:[{}]}],chartType:null==h?void 0:h.filterType,hooks:{setDataMask:l},enableNoResults:u,filterState:{...null==(r=h.defaultDataMask)?void 0:r.filterState,validateMessage:v&&(0,c.t)("Value is required"),validateStatus:v&&"error"}})};var $o=n(37687);const zo=(0,y.iK)(Pt.xJ)`
  margin-bottom: 0;
`;const Ao=y.iK.div`
  display: flex;
  flex-direction: column;
  height: 400px; // arbitrary
  text-align: center;
  justify-content: center;
  align-items: center;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,Uo=e=>{let{onClick:t}=e;return(0,C.tZ)(Ao,null,(0,C.tZ)("p",null,(0,c.t)("You have removed this filter.")),(0,C.tZ)("div",null,(0,C.tZ)(H.Z,{buttonStyle:"primary",onClick:t},(0,c.t)("Restore Filter"))))},Lo=y.iK.div`
  display: flex;
  flex-direction: column;
`,Vo=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: inline-flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    color: ${t.colors.primary.base};\n    &:hover {\n      color: ${t.colors.primary.dark1};\n    }\n  `}}
`,Ko=(0,y.iK)(G.Z.Trash)`
  ${e=>{let{theme:t}=e;return`\n    cursor: pointer;\n    margin-left: ${2*t.gridUnit}px;\n    color: ${t.colors.grayscale.base};\n    &:hover {\n      color: ${t.colors.grayscale.dark1};\n    }\n  `}}
`,Wo=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    width: 220px;\n    flex-direction: row;\n    align-items: center;\n    margin-bottom: ${t.gridUnit}px;\n  `}}
`,Bo=y.iK.div`
  text-transform: uppercase;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,Ho=e=>{let{availableFilters:t,selection:n,onChange:r,onDelete:i}=e,o=t.find((e=>e.value===n)),a=t;return o||(o={label:(0,c.t)("(deleted or invalid type)"),value:n},a=[o,...a]),(0,C.tZ)(Wo,null,(0,C.tZ)(B.Ph,{ariaLabel:(0,c.t)("Limit type"),labelInValue:!0,options:a,onChange:e=>r(n,e.value),value:o}),(0,C.tZ)(Ko,{iconSize:"xl",onClick:()=>i(n)}))},Go=e=>{let{availableFilters:t=[],dependencies:n=[],onDependenciesChange:r}=e;const[i,o]=(0,s.useState)(n),l=e=>{o(e),r(e)},d=(e,t)=>{const n=i.findIndex((t=>t===e)),r=[...i];r[n]=t,l(r)},u=e=>{const t=[...i];t.splice(i.indexOf(e),1),l(t)};return 0===t.length?(0,C.tZ)("span",null,(0,c.t)("No available filters.")):(0,C.tZ)(s.Fragment,null,i.map((e=>(0,C.tZ)(Ho,{key:e,selection:e,availableFilters:t.filter((t=>t.value===e||!a()(i).call(i,t.value))),onChange:d,onDelete:u}))),t.length>i.length&&(0,C.tZ)(Vo,{onClick:()=>{const e=t.find((e=>!a()(i).call(i,e.value)));if(e){const t=[...i];t.push(e.value),l(t)}}},(0,C.tZ)(G.Z.PlusSmall,null),(0,c.t)("Add filter")))},Yo=e=>{let{availableFilters:t=[],dependencies:n=[],onDependenciesChange:r,getDependencySuggestion:i}=e;const o=t.length>0,a=n.length>0;return(0,C.tZ)(Lo,null,(0,C.tZ)(Zo,{title:(0,c.t)("Values are dependent on other filters"),initialValue:a,onChange:e=>{const t=[];e&&!a&&o&&t.push(i()),r(t)},tooltip:(0,c.t)("Values selected in other filters will affect the filter options to only show relevant values")},a&&(0,C.tZ)(Bo,null,(0,c.t)("Values dependent on")),(0,C.tZ)(Go,{availableFilters:t,dependencies:n,onDependenciesChange:r,getDependencySuggestion:i})))},Jo=(0,y.iK)(x.ZP.TabPane)`
  padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px 0px;
`,Qo=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*t.gridUnit}px;\n  `}}
`,Xo=y.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  padding: 0px ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,ea=["enableEmptyFilter","defaultToFirstItem","multiSelect","searchAllOptions","inverseSelection"],ta=(0,y.iK)(Pt.xJ)`
  width: 49%;
  margin-bottom: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${e=>{let{theme:t}=e;return 10*t.gridUnit}}px;
  }
`,na=(0,y.iK)(Pt.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  & .ant-form-item-control-input {
    min-height: ${e=>{let{theme:t}=e;return 10*t.gridUnit}}px;
  }
`,ra=(0,y.iK)(Pt.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,ia=y.iK.span`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  text-transform: uppercase;
`,oa=(0,y.iK)(Pt.xJ)`
  margin-bottom: 0;
`,aa=y.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
`,sa=(0,y.iK)(G.Z.Refresh)`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
`,la=(0,y.iK)(ho.Z)`
  border-left: 0;
  border-top: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  border-radius: 0;

  .ant-collapse-header {
    border-bottom: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    border-top: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    margin-top: -1px;
    border-radius: 0;
  }

  .ant-collapse-content {
    border: 0;
  }

  .ant-collapse-content-box {
    padding-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }

  &.ant-collapse > .ant-collapse-item {
    border: 0;
    border-radius: 0;
  }
`,da=(0,y.iK)(x.ZP)`
  .ant-tabs-nav {
    position: sticky;
    top: 0;
    background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
    z-index: 1;
  }

  .ant-tabs-nav-list {
    padding: 0;
  }

  .ant-form-item-label {
    padding-bottom: 0;
  }
`,ca=y.iK.span`
  color: ${e=>{let{theme:t}=e;return t.colors.error.base}};
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  margin-left: ${e=>{let{theme:t}=e;return t.gridUnit-1}}px;
  &:before {
    content: '*';
  }
`,ua={configuration:{key:"configuration",name:(0,c.t)("Settings")},scoping:{key:"scoping",name:(0,c.t)("Scoping")}},ha={configuration:{key:"configuration",name:(0,c.t)("Filter Configuration")},settings:{key:"settings",name:(0,c.t)("Filter Settings")}},pa=["filter_select","filter_range"],fa={[(0,c.t)("Select filter")]:(0,c.t)("Value"),[(0,c.t)("Range filter")]:(0,c.t)("Numerical range"),[(0,c.t)("Time filter")]:(0,c.t)("Time range"),[(0,c.t)("Time column")]:(0,c.t)("Time column"),[(0,c.t)("Time grain")]:(0,c.t)("Time grain"),[(0,c.t)("Group By")]:(0,c.t)("Group by")},ma=new Map,ga=Co(Ct.Z.get,ma,(e=>{let{endpoint:t}=e;return t||""})),va=(e,t)=>{var n,r,o,l,d,h,f,m,g,v,b,y,S,x,w,k,Z,R,T,F,D,_,E,I;let{filterId:M,filterToEdit:O,removedFilters:P,form:N,getAvailableFilters:j,activeFilterPanelKeys:q,restoreFilter:$,handleActiveFilterPanelChange:z,setErroredFilters:A,validateDependencies:U,getDependencySuggestion:L}=e;const V=!!P[M],[K,H]=(0,s.useState)(""),[G,Y]=(0,s.useState)([]),[J,Q]=(0,s.useState)(ua.configuration.key),[X,te]=(0,s.useState)(null),re=wi(),[ie,oe]=(0,s.useState)(),ae=(0,s.useMemo)((()=>({})),[]),se=N.getFieldValue("filters"),le=null==se?void 0:se[M],de=le||X||ae,ce=(null==de?void 0:de.dependencies)||(null==O?void 0:O.cascadeParentIds),ue=(0,ni.Z)().items,he=Object.entries(ue).filter((e=>{var t;let[,{value:n}]=e;return null==(t=n.behaviors)?void 0:a()(t).call(t,ri.cg.NATIVE_FILTER)})).map((e=>{let[t]=e;return t})),pe=(0,i.v9)((e=>{let{datasources:t}=e;return t})),fe=(0,i.v9)((e=>{let{charts:t}=e;return t})),me=(0,s.useMemo)((()=>Object.values(pe).some((e=>Ri(e)))),[pe]),ge=(0,s.useMemo)((()=>{const e=Object.values(pe).find((e=>{var t;return e.id===(null==de||null==(t=de.dataset)?void 0:t.value)}));return!e||Ri(e)}),[null==de||null==(n=de.dataset)?void 0:n.value,pe]),ve=!(null==(r=ue[null==de?void 0:de.filterType])||null==(o=r.value)||!o.datasourceCount),be=null!=(l=null!=(d=null==de||null==(h=de.dataset)?void 0:h.value)?d:null==O||null==(f=O.targets[0])?void 0:f.datasetId)?l:((e,t)=>{var n;const r=new Map;let i="",o=0;return Object.values(t).forEach((e=>{const{form_data:t}=e;if(t){const{datasource:e}=t,n=(r.get(e)||0)+1;r.set(e,n),n>o&&(o=n,i=e)}})),null==(n=e[i])?void 0:n.id})(pe,fe),{controlItems:ye={},mainControlItems:Ce={}}=de?function(e){var t;let{datasetId:n,disabled:r,forceUpdate:i,form:o,filterId:a,filterType:l,filterToEdit:d,formFilter:u,removed:h}=e;const p=null!=(void 0===(f=(0,$o.Z)().get(l))&&(f={}),t=null!=(m=null==(g=bi()(f.controlPanelSections))?void 0:g.reduce(((e,t)=>{let{controlSetRows:n=[]}=t;return[...e,...bi()(n)]}),[]))?m:[])?t:[];var f,m,g;const v={},b={};return p.filter((e=>"groupby"===(null==e?void 0:e.name))).forEach((e=>{var t,r,l,p,f,m,g,v,y;const S=null!=(t=null==d||null==(r=d.controlValues)?void 0:r[e.name])?t:null==e||null==(l=e.config)?void 0:l.default,x=null==d||null==(p=d.targets[0])||null==(f=p.column)?void 0:f.name,w=(0,C.tZ)(s.Fragment,null,(0,C.tZ)(zo,{name:["filters",a,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(m=e.config)?void 0:m.requiredFirst)&&(null==d?void 0:d.requiredFirst)}),(0,C.tZ)(ta,{name:["filters",a,"column"],initialValue:x,label:(0,C.tZ)(ia,null,(null==(g=e.config)?void 0:g.label)||(0,c.t)("Column")),rules:[{required:(null==(v=e.config)?void 0:v.required)&&!h,message:(0,c.t)("Column is required")}]},(0,C.tZ)(_o,{mode:(null==(y=e.config)?void 0:y.multiple)&&"multiple",form:o,filterId:a,datasetId:n,filterValues:e=>Ti((null==u?void 0:u.filterType)||"",e),onChange:()=>{ki(o,a,{defaultDataMask:null}),i()}})));b[e.name]={element:w,checked:S}})),p.filter((e=>{var t;return(null==e||null==(t=e.config)?void 0:t.renderTrigger)&&"sortAscending"!==e.name&&"enableSingleValue"!==e.name})).forEach((e=>{var t,n,l,h;const p=null!=(t=null==d||null==(n=d.controlValues)?void 0:n[e.name])?t:null==e||null==(l=e.config)?void 0:l.default,f=(0,C.tZ)(s.Fragment,null,(0,C.tZ)(zo,{name:["filters",a,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(h=e.config)?void 0:h.requiredFirst)&&(null==d?void 0:d.requiredFirst)}),(0,C.tZ)(ne.u,{key:e.name,placement:"left",title:e.config.affectsDataMask&&r&&(0,c.t)('Populate "Default value" to enable this control')},(0,C.tZ)(na,{key:e.name,name:["filters",a,"controlValues",e.name],initialValue:p,valuePropName:"checked",colon:!1},(0,C.tZ)(B.r4,{disabled:e.config.affectsDataMask&&r,onChange:t=>{let{target:{checked:n}}=t;e.config.requiredFirst&&ki(o,a,{requiredFirst:{...null==u?void 0:u.requiredFirst,[e.name]:n}}),e.config.resetConfig&&ki(o,a,{defaultDataMask:null}),i()}},e.config.label," ",e.config.description&&(0,C.tZ)(hr.V,{placement:"top",label:e.config.name,tooltip:e.config.description})))));v[e.name]={element:f,checked:p}})),{controlItems:v,mainControlItems:b}}({datasetId:be,disabled:!1,forceUpdate:re,form:N,filterId:M,filterType:null==de?void 0:de.filterType,filterToEdit:O,formFilter:de,removed:V}):{},Se=!!Ce.groupby,xe=!(null==(g=(null!=(m=ue[null==de?void 0:de.filterType])?m:{}).value)||!g.enableNoResults),we=Se&&!!G.length,ke=!ve||be&&((null==de?void 0:de.column)||!Se),Ze=a()(pa).call(pa,null==de?void 0:de.filterType),Re=a()(Ea).call(Ea,null==de?void 0:de.filterType),Te=null==(v=null==de?void 0:de.isDataDirty)||v,Fe=e=>{ki(N,M,e),H(""),re()};let De={};ce&&ce.length>0&&se&&ce.forEach((e=>{var t,n;const r=null==(t=se[e])||null==(n=t.defaultDataMask)?void 0:n.extraFormData;De=(0,xo.on)(De,r)}));const _e=JSON.stringify(De),Ee=(0,s.useCallback)((function(e){var t,n;if(void 0===e&&(e=!1),!ve||null==de||null==(t=de.dataset)||!t.value)return void re();const r=(0,xo.zi)({datasetId:null==de||null==(n=de.dataset)?void 0:n.value,groupby:null==de?void 0:de.column,...de});r.extra_form_data=De,Fe({defaultValueQueriesData:null,isDataDirty:!1}),(0,Vr.getChartDataRequest)({formData:r,force:e,requestParams:{dashboardId:0}}).then((e=>{let{response:t,json:n}=e;if((0,gt.cr)(u.T.GLOBAL_ASYNC_QUERIES)){const e="result"in n?n.result[0]:n;if(200===t.status)Fe({defaultValueQueriesData:[e]});else{if(202!==t.status)throw new Error(`Received unexpected response status (${t.status}) while fetching chart data`);(0,yo.YJ)(e).then((e=>{Fe({defaultValueQueriesData:e})})).catch((e=>{H(e.message||e.error||(0,c.t)("Check configuration"))}))}}else Fe({defaultValueQueriesData:n.result})})).catch((e=>{e.json().then((t=>{(e=>{ki(N,M,{defaultValueQueriesData:null}),H(e),re()})(t.message||e.statusText||(0,c.t)("Check configuration"))}))}))}),[M,re,N,de,ve,_e]);(0,s.useEffect)((()=>Ee()),[_e]);const Ie=(0,xo.zi)({datasetId:be,groupby:Se?null==de?void 0:de.column:void 0,...de});Ie.extra_form_data=De;const[Me,Oe,Pe,Ne]=((e,t)=>{var n,r;const i=!(null==e||null==(n=e.controlValues)||!n.enableEmptyFilter),o=!(null==e||null==(r=e.controlValues)||!r.defaultToFirstItem),[a,l]=(0,s.useState)(!1),[d,u]=(0,s.useState)(i),[h,p]=(0,s.useState)(""),f=function(e){void 0===e&&(e=!1);const t=i&&!o;u(t),l(!!t||e)};return(0,s.useEffect)((()=>{var t,n;f(!o&&!(null==e||null==(t=e.defaultDataMask)||null==(n=t.filterState)||!n.value))}),[o,i]),(0,s.useEffect)((()=>{var e,n;f(!o&&!(null==t||null==(e=t.defaultDataMask)||null==(n=e.filterState)||!n.value))}),[]),(0,s.useEffect)((()=>{let e="";o?e=(0,c.t)('Default value set automatically when "Select first filter value by default" is checked'):d?e=(0,c.t)('Default value must be set when "Filter value is required" is checked'):a&&(e=(0,c.t)('Default value must be set when "Filter has default value" is checked')),p(e)}),[a,d,o]),[a,d,h,f]})(de,O),je=!be||ie||(null==de||null==(b=de.dataset)?void 0:b.label),qe=(0,s.useCallback)((()=>{N.setFields([{name:"changed",value:!0}])}),[N]),$e=(0,s.useCallback)((e=>{ki(N,M,e),qe()}),[M,N,qe]),ze=!!(null!=de&&de.adhoc_filters||null!=de&&de.time_range||null!=O&&null!=(y=O.adhoc_filters)&&y.length||null!=O&&O.time_range),Ae=void 0!==(null==de||null==(S=de.controlValues)?void 0:S.enableSingleValue)||void 0!==(null==O||null==(x=O.controlValues)?void 0:x.enableSingleValue);let Ue=null==O||null==(w=O.controlValues)?void 0:w.enableSingleValue;void 0!==(null==de||null==(k=de.controlValues)?void 0:k.enableSingleMaxValue)&&({enableSingleValue:Ue}=de.controlValues);const Le="boolean"==typeof(null==de||null==(Z=de.controlValues)?void 0:Z.sortAscending)||"boolean"==typeof(null==O||null==(R=O.controlValues)?void 0:R.sortAscending);let Ve=null==O||null==(T=O.controlValues)?void 0:T.sortAscending;"boolean"==typeof(null==de||null==(F=de.controlValues)?void 0:F.sortAscending)&&(Ve=de.controlValues.sortAscending);const Ke=!ve||!Te&&ke||!Ce.groupby,We=e=>{var t;const n=null==(t=N.getFieldValue("filters"))?void 0:t[M].controlValues;ki(N,M,{controlValues:{...n,sortAscending:e}}),re()},Be=e=>{var t;const n=null==(t=N.getFieldValue("filters"))?void 0:t[M].controlValues;ki(N,M,{controlValues:{...n,enableSingleValue:e}}),re()},He=()=>setTimeout((()=>N.validateFields([["filters",M,"adhoc_filters"],["filters",M,"time_range"]])),0),Ge=(null==de?void 0:de.time_range)&&"No filter"!==de.time_range,Ye=(null==de||null==(D=de.adhoc_filters)?void 0:D.length)>0,Je=null==de||null==(_=de.controlValues)?void 0:_.defaultToFirstItem,Qe=(null==de?void 0:de.filterType)===(null==O?void 0:O.filterType)?null==O?void 0:O.defaultDataMask:null,Xe=()=>Ge||Ye?Promise.resolve():Promise.reject(new Error((0,c.t)("Pre-filter is required"))),et=j(M),tt=et.length>0;(0,s.useEffect)((()=>{be&&ga({endpoint:`/api/v1/dataset/${be}`}).then((e=>{var t,n,r;Y(null==(t=e.json)||null==(n=t.result)?void 0:n.metrics);const i=null==(r=e.json)?void 0:r.result;i.type=i.datasource_type,i.filter_select=!0,oe(i)})).catch((e=>{(0,Nr.Gb)(e.message)}))}),[be]),(0,s.useImperativeHandle)(t,(()=>({changeTab(e){Q(e)}}))),((e,t)=>{var n;const r=wi(),i=(e.getFieldValue("filters")||{})[t];(0,s.useEffect)((()=>{ki(e,t,{isDataDirty:!0,defaultValueQueriesData:null}),r()}),[e,null==i?void 0:i.filterType,null==i?void 0:i.column,null==i||null==(n=i.dataset)?void 0:n.value,JSON.stringify(null==i?void 0:i.adhoc_filters),null==i?void 0:i.time_range,r,t])})(N,M),(0,s.useEffect)((()=>{ve&&ke&&Me&&Te&&Ee()}),[ve,ke,Me,Te,Ee,je]);const nt=(0,s.useMemo)((()=>{var e;const t=[];return void 0===(null==de||null==(e=de.dataset)?void 0:e.value)?[]:(Object.values(fe).forEach((e=>{var n,r,i;const o=null==(n=e.form_data)?void 0:n.datasource;void 0!==o&&(null==(r=pe[o])?void 0:r.id)!==(null==de||null==(i=de.dataset)?void 0:i.value)&&t.push(e.id)})),t)}),[JSON.stringify(fe),null==de||null==(E=de.dataset)?void 0:E.value,JSON.stringify(pe)]);return(0,s.useEffect)((()=>{V&&te(le)}),[V]),(0,s.useEffect)((()=>{X&&!V&&(ki(N,M,X),te(null))}),[le,M,N,V,X]),V?(0,C.tZ)(Uo,{onClick:()=>$(M)}):(0,C.tZ)(da,{activeKey:J,onChange:e=>Q(e),centered:!0},(0,C.tZ)(Jo,{tab:ua.configuration.name,key:ua.configuration.key,forceRender:!0},(0,C.tZ)(Qo,null,(0,C.tZ)(ta,{name:["filters",M,"type"],hidden:!0,initialValue:Pi.BE.NATIVE_FILTER},(0,C.tZ)(W.II,null)),(0,C.tZ)(ta,{name:["filters",M,"name"],label:(0,C.tZ)(ia,null,(0,c.t)("Filter name")),initialValue:null==O?void 0:O.name,rules:[{required:!V,message:(0,c.t)("Name is required")}]},(0,C.tZ)(W.II,_a("name-input"))),(0,C.tZ)(ta,ee()({name:["filters",M,"filterType"],rules:[{required:!V,message:(0,c.t)("Name is required")}],initialValue:(null==O?void 0:O.filterType)||"filter_select",label:(0,C.tZ)(ia,null,(0,c.t)("Filter Type"))},_a("filter-type")),(0,C.tZ)(B.Ph,{ariaLabel:(0,c.t)("Filter type"),options:he.map((e=>{var t,n,r;const i=null==(t=ue[e])?void 0:t.value.name,o=i?fa[i]:void 0,s=1===(null==(n=xi[e])?void 0:n.length)&&(null==(r=xi[e])?void 0:a()(r).call(r,yi.Z.TEMPORAL))&&!me;return{value:e,label:o||i,customLabel:s?(0,C.tZ)(ne.u,{title:(0,c.t)("Datasets do not contain a temporal column")},o||i):void 0,disabled:s}})),onChange:e=>{ki(N,M,{filterType:e,defaultDataMask:null,column:null}),re()}}))),ve&&(0,C.tZ)(Xo,null,je?(0,C.tZ)(ta,ee()({name:["filters",M,"dataset"],label:(0,C.tZ)(ia,null,(0,c.t)("Dataset")),initialValue:ie?{label:ie.table_name,value:ie.id}:void 0,rules:[{required:!V,message:(0,c.t)("Dataset is required")}]},_a("datasource-input")),(0,C.tZ)(No,{onChange:e=>{e.value!==be&&ki(N,M,{dataset:e,defaultDataMask:null,column:null}),re()}})):(0,C.tZ)(ta,{label:(0,C.tZ)(ia,null,(0,c.t)("Dataset"))},(0,C.tZ)(p.Z,{position:"inline-centered"})),ve&&Object.keys(Ce).map((e=>Ce[e].element))),(0,C.tZ)(la,{activeKey:q,onChange:e=>{z(e)},expandIconPosition:"right",key:`native-filter-config-${M}`},"filter_time"!==(null==de?void 0:de.filterType)&&(0,C.tZ)(ho.Z.Panel,{forceRender:!0,header:ha.configuration.name,key:`${M}-${ha.configuration.key}`},Re&&tt&&(0,C.tZ)(na,{name:["filters",M,"dependencies"],initialValue:ce},(0,C.tZ)(Yo,{availableFilters:et,dependencies:ce,onDependenciesChange:e=>{ki(N,M,{dependencies:e}),re(),U(),qe()},getDependencySuggestion:()=>L(M)})),ve&&Ze&&(0,C.tZ)(oa,{name:["filters",M,"preFilter"]},(0,C.tZ)(Zo,{initialValue:ze,title:(0,c.t)("Pre-filter available values"),onChange:e=>{qe(),e&&He()}},(0,C.tZ)(ra,{name:["filters",M,"adhoc_filters"],initialValue:null==O?void 0:O.adhoc_filters,required:!0,rules:[{validator:Xe}]},(0,C.tZ)(bo.Z,{columns:(null==ie||null==(I=ie.columns)?void 0:I.filter((e=>e.filterable)))||[],savedMetrics:(null==ie?void 0:ie.metrics)||[],datasource:ie,onChange:e=>{ki(N,M,{adhoc_filters:e}),re(),He()},label:(0,C.tZ)("span",null,(0,C.tZ)(ia,null,(0,c.t)("Pre-filter")),!Ge&&(0,C.tZ)(ca,null))})),ge&&(0,C.tZ)(na,{name:["filters",M,"time_range"],label:(0,C.tZ)(ia,null,(0,c.t)("Time range")),initialValue:(null==O?void 0:O.time_range)||"No filter",required:!Ye,rules:[{validator:Xe}]},(0,C.tZ)(vo.Z,{name:"time_range",onChange:e=>{ki(N,M,{time_range:e}),re(),He()}})),Ge&&(0,C.tZ)(na,{name:["filters",M,"granularity_sqla"],label:(0,C.tZ)(s.Fragment,null,(0,C.tZ)(ia,null,(0,c.t)("Time column"))," ",(0,C.tZ)(hr.V,{placement:"top",tooltip:(0,c.t)("Optional time column if time range should apply to another column than the default time column")})),initialValue:null==O?void 0:O.granularity_sqla},(0,C.tZ)(_o,{allowClear:!0,form:N,formField:"granularity_sqla",filterId:M,filterValues:e=>!!e.is_dttm,datasetId:be,onChange:e=>{ki(N,M,{granularity_sqla:e}),re()}})))),"filter_range"!==(null==de?void 0:de.filterType)?(0,C.tZ)(oa,{name:["filters",M,"sortFilter"]},(0,C.tZ)(Zo,{initialValue:Le,title:(0,c.t)("Sort filter values"),onChange:e=>{We(e||void 0),qe()}},(0,C.tZ)(na,{name:["filters",M,"controlValues","sortAscending"],initialValue:Ve,label:(0,C.tZ)(ia,null,(0,c.t)("Sort type"))},(0,C.tZ)(At.Y.Group,{onChange:e=>{We(e.target.value)}},(0,C.tZ)(At.Y,{value:!0},(0,c.t)("Sort ascending")),(0,C.tZ)(At.Y,{value:!1},(0,c.t)("Sort descending")))),we&&(0,C.tZ)(ra,{name:["filters",M,"sortMetric"],initialValue:null==O?void 0:O.sortMetric,label:(0,C.tZ)(s.Fragment,null,(0,C.tZ)(ia,null,(0,c.t)("Sort Metric"))," ",(0,C.tZ)(hr.V,{placement:"top",tooltip:(0,c.t)("If a metric is specified, sorting will be done based on the metric value")}))},(0,C.tZ)(B.Ph,{allowClear:!0,ariaLabel:(0,c.t)("Sort metric"),name:"sortMetric",options:G.map((e=>{var t;return{value:e.metric_name,label:null!=(t=e.verbose_name)?t:e.metric_name}})),onChange:e=>{void 0!==e&&(ki(N,M,{sortMetric:e}),re())}})))):(0,C.tZ)(oa,{name:["filters",M,"rangeFilter"]},(0,C.tZ)(Zo,{initialValue:Ae,title:(0,c.t)("Single Value"),onChange:e=>{Be(e?So.c.Exact:void 0),qe()}},(0,C.tZ)(na,{name:["filters",M,"controlValues","enableSingleValue"],initialValue:Ue,label:(0,C.tZ)(ia,null,(0,c.t)("Single value type"))},(0,C.tZ)(At.Y.Group,{onChange:e=>Be(e.target.value)},(0,C.tZ)(At.Y,{value:So.c.Minimum},(0,c.t)("Minimum")),(0,C.tZ)(At.Y,{value:So.c.Exact},(0,c.t)("Exact")),(0,C.tZ)(At.Y,{value:So.c.Maximum},(0,c.t)("Maximum"))))))),(0,C.tZ)(ho.Z.Panel,{forceRender:!0,header:ha.settings.name,key:`${M}-${ha.settings.key}`},(0,C.tZ)(ta,{name:["filters",M,"description"],initialValue:null==O?void 0:O.description,label:(0,C.tZ)(ia,null,(0,c.t)("Description"))},(0,C.tZ)(W.Kx,null)),(0,C.tZ)(oa,{name:["filters",M,"defaultValueQueriesData"],hidden:!0,initialValue:null}),(0,C.tZ)(oa,{name:["filters",M,"defaultValue"]},(0,C.tZ)(Zo,{checked:Me,disabled:Oe||Je,initialValue:Me,title:(0,c.t)("Filter has default value"),tooltip:Pe,onChange:e=>{Ne(e),e||ki(N,M,{defaultDataMask:null}),qe()}},!V&&(0,C.tZ)(ra,{name:["filters",M,"defaultDataMask"],initialValue:Qe,label:(0,C.tZ)(ia,null,(0,c.t)("Default Value")),required:Me,rules:[{validator:()=>{var e,t;if(null!=de&&null!=(e=de.defaultDataMask)&&null!=(t=e.filterState)&&t.value){const e=N.getFieldsError();return A((t=>t.length&&!e.find((e=>e.errors.length>0))?[]:t)),Promise.resolve()}return A((e=>a()(e).call(e,M)?e:[...e,M])),Promise.reject(new Error((0,c.t)("Default value is required")))}}]},K?(0,C.tZ)(go,{title:(0,c.t)("Cannot load filter"),body:K,level:"error"}):Ke?(0,C.tZ)(aa,null,(0,C.tZ)(qo,{setDataMask:e=>{var t,n;Br()(null==Qe||null==(t=Qe.filterState)?void 0:t.value,null==e||null==(n=e.filterState)?void 0:n.value)||qe(),ki(N,M,{defaultDataMask:e}),N.validateFields([["filters",M,"defaultDataMask"]]),re()},hasDefaultValue:Me,filterId:M,hasDataset:ve,form:N,formData:Ie,enableNoResults:xe}),ve&&be&&(0,C.tZ)(ne.u,{title:(0,c.t)("Refresh the default values")},(0,C.tZ)(sa,{onClick:()=>Ee(!0)}))):(0,c.t)('Fill all required fields to enable "Default Value"')))),Object.keys(ye).sort(((e,t)=>ea.indexOf(e)-ea.indexOf(t))).map((e=>ye[e].element))))),(0,C.tZ)(Jo,{tab:ua.scoping.name,key:ua.scoping.key,forceRender:!0},(0,C.tZ)(gi,{updateFormValues:$e,pathToFormValue:["filters",M],forceUpdate:re,filterScope:null==O?void 0:O.scope,formFilterScope:null==de?void 0:de.scope,formScopingType:null==de?void 0:de.scoping,initiallyExcludedCharts:nt})))},ba=(0,s.forwardRef)(va);var ya={name:"ihui0v",styles:"text-align:left;& .ant-alert-action{align-self:center;}"},Ca={name:"zjik7",styles:"display:flex"};function Sa(e){let{title:t,onConfirm:n,onDismiss:r,children:i}=e;return(0,C.tZ)(Ot.Z,{closable:!1,type:"warning",key:"alert",message:t,css:ya,description:i,action:(0,C.tZ)("div",{css:Ca},(0,C.tZ)(H.Z,{key:"cancel",buttonSize:"small",buttonStyle:"secondary",onClick:r},(0,c.t)("Keep editing")),(0,C.tZ)(H.Z,{key:"submit",buttonSize:"small",buttonStyle:"primary",onClick:n},(0,c.t)("Yes, cancel")))})}const xa=e=>{let{canSave:t=!0,onCancel:n,handleSave:r,onDismiss:i,onConfirmCancel:o,saveAlertVisible:a}=e;return a?(0,C.tZ)(Sa,{key:"cancel-confirm",title:(0,c.t)("There are unsaved changes."),onConfirm:o,onDismiss:i},(0,c.t)("Are you sure you want to cancel?")):(0,C.tZ)(s.Fragment,null,(0,C.tZ)(H.Z,{key:"cancel",buttonStyle:"secondary",onClick:n},(0,c.t)("Cancel")),(0,C.tZ)(H.Z,{disabled:!t,key:"submit",buttonStyle:"primary",onClick:r},(0,c.t)("Save")))};var wa=n(60812),ka=n(92242);const Za=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    padding: ${4*t.gridUnit}px;\n  `}}
`,Ra=e=>{let{componentId:t,divider:n}=e;return(0,C.tZ)(Za,null,(0,C.tZ)(Pt.xJ,{initialValue:n?n.title:"",label:(0,c.t)("Title"),name:["filters",t,"title"],rules:[{required:!0,message:(0,c.t)("Title is required"),whitespace:!0}]},(0,C.tZ)(W.II,null)),(0,C.tZ)(Pt.xJ,{initialValue:n?n.description:"",label:(0,c.t)("Description"),name:["filters",t,"description"]},(0,C.tZ)(W.Kx,{rows:4})),(0,C.tZ)(Pt.xJ,{hidden:!0,name:["filters",t,"type"],initialValue:Pi.BE.DIVIDER}))},Ta=(0,y.iK)(pr.o)`
  min-width: 700px;
  .ant-modal-body {
    padding: 0px;
  }
`,Fa=y.iK.div`
  display: flex;
  height: 700px;
  flex-direction: row;
  .filters-list {
    width: ${e=>{let{theme:t}=e;return 50*t.gridUnit}}px;
    overflow: auto;
  }
`,Da=(0,y.iK)(B.qz)`
  width: 100%;
`,_a=(0,Oi.Q)("filters-config-modal"),Ea=["filter_select"];function Ia(e){let{isOpen:t,initialFilterId:n,createNewOnOpen:r,onSave:i,onCancel:o}=e;const[l]=B.qz.useForm(),d=(0,s.useRef)(),u=ji(),h=function(){const e=ji();return(0,s.useMemo)((()=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})),[e])}(),[p,f]=(0,s.useState)([]),[m,g]=(0,s.useState)({}),[v,b]=(0,s.useState)(!1),y=(0,s.useMemo)((()=>Ii()([...(0,ka.QN)(u),...p]).filter((e=>{var t;return!m[e]||(null==(t=m[e])?void 0:t.isPending)}))),[u,p,m]),x=null!=n?n:y[0],[w,k]=(0,s.useState)(x),[R,T]=(0,s.useState)([]),[F,D]=(0,s.useState)({filters:{}}),_=p.filter((e=>!m[e])),E=e=>{const t=m[e];null!=t&&t.isPending&&clearTimeout(t.timerId),g((t=>({...t,[e]:null})))},I=()=>Object.keys(h),[M,O]=(0,s.useState)(I()),P=e=>[`${e}-${ha.configuration.key}`,`${e}-${ha.settings.key}`],[N,j]=(0,s.useState)(P(x)),q=(0,s.useCallback)((e=>{const t=(0,ka.W6)(e);f([...p,t]),k(t),b(!1),O([...M,t]),j(P(t))}),[p,M,k,O,f]);((e,t,n)=>{const r=(0,wa.D)(e);(0,s.useEffect)((()=>{n&&e&&!r&&t(Pi.BE.NATIVE_FILTER)}),[n,e,r,t])})(t,q,r),((e,t,n,r)=>{(0,s.useEffect)((()=>{const i=e[t];if(i&&!i.isPending){const i=n.flat().find((n=>!e[n]&&n!==t));i&&r(i)}}),[t,e,n,r])})(m,w,M,k);const $=(0,ka.EJ)(g,O,b),z=function(e){void 0===e&&(e=!1),f([]),k(x),g({}),b(!1),D({filters:{}}),T([]),y.length>0&&j(P(y[0])),e||O(I()),l.resetFields(["filters"]),l.setFieldsValue({changed:!1})},A=(0,s.useCallback)((e=>{const t=F.filters[e],n=h[e];return t&&"name"in t&&t.name||t&&"title"in t&&t.title||n&&"name"in n&&n.name||n&&"title"in n&&n.title||(0,c.t)("[untitled]")}),[h,F.filters]),U=(0,s.useCallback)((e=>{var t;if(m[e])return!1;const n=(null==(t=l.getFieldValue("filters"))?void 0:t[e])||h[e];return n&&"filterType"in n&&a()(Ea).call(Ea,n.filterType)}),[h,l,m]),L=(0,s.useCallback)((e=>y.filter((t=>t!==e)).filter((e=>U(e))).map((e=>({label:A(e),value:e})))),[U,y,A]),V=(0,s.useCallback)((()=>{const e=l.getFieldsError(),t=[];e.forEach((e=>{const n=e.name[1];e.errors.length>0&&!a()(t).call(t,n)&&t.push(n)})),!t.length&&R.length>0?T([]):t.length>0&&!Br()(_i()(R),_i()(t))&&T(t)}),[l,R]),K=async()=>{const e=await(0,ka.G$)(l,w,k);V(),e?((e=>{Object.keys(h).forEach((e=>{const t=h[e];if(!("cascadeParentIds"in t))return;const{cascadeParentIds:n}=t;n&&(t.cascadeParentIds=n.filter((e=>U(e))))}));const t=null==e?void 0:e.filters;t&&Object.keys(t).forEach((e=>{const n=t[e];if(!("dependencies"in n))return;const{dependencies:r}=n;r&&(n.dependencies=r.filter((e=>U(e))))}))})(e),(0,ka.GA)(h,M,m,i,e)(),z(!0)):d.current.changeTab("configuration")},W=()=>{z(),o()},H=()=>{const e=l.getFieldValue("changed"),t=I(),n=M.length!==t.length||M.some(((e,n)=>e!==t[n]));_.length>0||l.isFieldsTouched()||e||n?b(!0):W()},G=(0,s.useCallback)((()=>{const e=new Map,t=l.getFieldValue("filters");return t&&Object.keys(t).forEach((n=>{const r=t[n],i=h[n];let o=[];r&&"dependencies"in r?o=[...r.dependencies]:i&&i.cascadeParentIds&&(o=[...i.cascadeParentIds]),e.set(n,o)})),e}),[h,l]),Y=()=>{const e=G();y.filter((e=>!m[e])).forEach((t=>{const n={name:["filters",t,"dependencies"],errors:(0,ka.uh)(e,t)?[(0,c.t)("Cyclic dependency detected")]:[]};l.setFields([n])})),V()},J=e=>{const t=G(),n=M.filter((t=>t!==e&&U(t))),r=n.find((n=>{const r=t.get(e)||[];return r.push(n),!(0,ka.uh)(t,e)||(r.pop(),!1)}));return r||n[0]},Q=(0,s.useMemo)((()=>Z()(((e,t)=>{const n=e.filters&&Object.values(e.filters).some((e=>e.name&&null!==e.name)),r=e.filters&&Object.values(e.filters).some((e=>e.title&&null!==e.title));(n||r)&&D(t),b(!1),V()}),Mi.M)),[V]);return(0,s.useEffect)((()=>{T((e=>e.filter((e=>!m[e]))))}),[m]),(0,C.tZ)(Ta,{visible:t,maskClosable:!1,title:(0,c.t)("Add and edit filters"),width:"50%",destroyOnClose:!0,onCancel:H,onOk:K,centered:!0,footer:(0,C.tZ)(xa,{onDismiss:()=>b(!1),onCancel:H,handleSave:K,canSave:!R.length,saveAlertVisible:v,onConfirmCancel:W})},(0,C.tZ)(S.Z,null,(0,C.tZ)(Fa,null,(0,C.tZ)(Da,{form:l,onValuesChange:Q,layout:"vertical"},(0,C.tZ)(uo,{erroredFilters:R,onRemove:$,onAdd:q,onChange:e=>{k(e),j(P(e))},getFilterTitle:A,currentFilterId:w,removedFilters:m,restoreFilter:E,onRearrange:(e,t)=>{const n=[...M],r=n.splice(e,1)[0];n.splice(t,0,r),O(n)},filters:M},(e=>(e=>e.startsWith(ka.Ky)?(0,C.tZ)(Ra,{componentId:e,divider:h[e]}):(0,C.tZ)(ba,{ref:d,form:l,filterId:e,filterToEdit:h[e],removedFilters:m,restoreFilter:E,getAvailableFilters:L,key:e,activeFilterPanelKeys:N,handleActiveFilterPanelChange:e=>j(e),isActive:w===e,setErroredFilters:T,validateDependencies:Y,getDependencySuggestion:J}))(e)))))))}const Ma=e=>{var t,n;let{isOpen:r,chartId:o,onClose:a}=e;const l=(0,i.I0)(),[d]=B.qz.useForm(),u=(0,i.v9)((e=>{var t;let{dashboardInfo:n}=e;return null==n||null==(t=n.metadata)?void 0:t.chart_configuration})),h=(0,i.v9)((e=>e.charts)),p=(0,i.v9)((e=>e.dashboardLayout.present)),f=null==u||null==(t=u[o])||null==(n=t.crossFilters)?void 0:n.scope,m=()=>{const e=(0,oi.Q)(d.getFieldValue("scope"),h,p);l((0,Or.Aw)({...u,[o]:{id:o,crossFilters:{scope:d.getFieldValue("scope"),chartsInScope:e}}})),a()};return(0,C.tZ)(pr.o,{visible:r,maskClosable:!1,title:(0,c.t)("Cross Filter Scoping"),width:"55%",destroyOnClose:!0,onCancel:a,onOk:m,centered:!0,footer:(0,C.tZ)(s.Fragment,null,(0,C.tZ)(H.Z,{key:"cancel",buttonStyle:"secondary",onClick:a},(0,c.t)("Cancel")),(0,C.tZ)(H.Z,{key:"submit",buttonStyle:"primary",onClick:m},(0,c.t)("Save")))},(0,C.tZ)(Da,{preserve:!1,form:d,layout:"vertical"},(0,C.tZ)(Fi,{form:d,scope:f,chartId:o})))};var Oa=n(54076);const Pa=e=>{if((0,u.c)(u.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB))return e?(0,c.t)("Click to edit %s in a new tab",e):(0,c.t)("Click to edit chart.");const t="MacOS"===(0,Oa.fV)(),n=e?(0,c.t)("Click to edit %s.",e):(0,c.t)("Click to edit chart."),r=(0,c.t)("Use %s to open in a new tab.",t?"⌘ + click":"ctrl + click");return(0,C.tZ)(s.Fragment,null,(0,C.tZ)("div",null,n),(0,C.tZ)("div",null,r))};var Na=n(15423),ja=n(95345),qa=n(49378);const $a="cross_filter_scoping",za="download_as_image",Aa="explore_chart",Ua="export_csv",La="export_full_csv",Va="force_refresh",Ka="fullscreen",Wa="toggle_chart_description",Ba=y.iK.div`
  padding: ${e=>{let{theme:t}=e;return t.gridUnit/4}}px
    ${e=>{let{theme:t}=e;return 1.5*t.gridUnit}}px;

  .dot {
    display: block;
  }

  &:hover {
    cursor: pointer;
  }
`,Ha=y.iK.div`
  height: auto;
  margin: ${e=>{let{theme:t}=e;return t.gridUnit}}px 0;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  line-height: 21px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
`,Ga=()=>(0,C.tZ)(Ba,null,(0,C.tZ)("span",{className:"dot"}),(0,C.tZ)("span",{className:"dot"}),(0,C.tZ)("span",{className:"dot"})),Ya=C.iv`
  &&.anticon > .anticon:first-child {
    margin-right: 0;
    vertical-align: 0;
  }
`,Ja=e=>{let{exploreUrl:t,triggerNode:n,modalTitle:r,modalBody:i}=e;const[o,a]=(0,s.useState)(!1),l=(0,s.useCallback)((()=>a(!0)),[]),d=(0,s.useCallback)((()=>a(!1)),[]),u=(0,Hr.k6)(),h=(0,y.Fg)();return(0,C.tZ)(s.Fragment,null,(0,C.tZ)("span",{onClick:l,role:"button",tabIndex:0},n),(0,C.tZ)(pr.Z,{css:C.iv`
            .ant-modal-body {
              display: flex;
              flex-direction: column;
            }
          `,show:o,onHide:d,title:r,footer:(0,C.tZ)(s.Fragment,null,(0,C.tZ)(H.Z,{buttonStyle:"secondary",buttonSize:"small",onClick:()=>u.push(t)},(0,c.t)("Edit chart")),(0,C.tZ)(H.Z,{buttonStyle:"primary",buttonSize:"small",onClick:d},(0,c.t)("Close"))),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*h.gridUnit,minWidth:128*h.gridUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnClose:!0},i))};class Qa extends s.PureComponent{constructor(e){super(e),this.toggleControls=this.toggleControls.bind(this),this.refreshChart=this.refreshChart.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.state={showControls:!1,showCrossFilterScopingModal:!1}}refreshChart(){this.props.updatedDttm&&this.props.forceRefresh(this.props.slice.slice_id,this.props.dashboardId)}toggleControls(){this.setState((e=>({showControls:!e.showControls})))}handleMenuClick(e){let{key:t,domEvent:n}=e;switch(t){case Va:this.refreshChart(),this.props.addSuccessToast((0,c.t)("Data refreshed"));break;case $a:this.setState({showCrossFilterScopingModal:!0});break;case Wa:this.props.toggleExpandSlice&&this.props.toggleExpandSlice(this.props.slice.slice_id);break;case Aa:this.props.logExploreChart&&this.props.logExploreChart(this.props.slice.slice_id);break;case Ua:this.props.exportCSV&&this.props.exportCSV(this.props.slice.slice_id);break;case Ka:this.props.handleToggleFullSize();break;case La:this.props.exportFullCSV&&this.props.exportFullCSV(this.props.slice.slice_id);break;case za:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,zn.Z)((r=this.props.slice.slice_id,`.dashboard-chart-id-${r}`),this.props.slice.slice_name,!0)(n).then((()=>{e.style.visibility="visible"}));break}}var r}render(){var e;const{componentId:t,dashboardId:n,slice:r,isFullSize:i,cachedDttm:o=[],updatedDttm:l=null,addSuccessToast:d=(()=>{}),addDangerToast:h=(()=>{}),supersetCanShare:p=!1,isCached:f=[]}=this.props,m=(0,ni.Z)().items,g="table"===r.viz_type,v=Object.entries(m).filter((e=>{var t;let[,{value:n}]=e;return null==(t=n.behaviors)?void 0:a()(t).call(t,ri.cg.INTERACTIVE_CHART)})).find((e=>{let[t]=e;return t===r.viz_type})),b=null==(e=r.form_data)?void 0:e.emit_filter,y=(o||[]).map((e=>pt().utc(e).fromNow())),S=l?pt().utc(l).fromNow():"",x=[...new Set(f.map((e=>e?(0,c.t)("Cached %s",y):S?(0,c.t)("Fetched %s",S):""))||"")],w=x.map(((e,t)=>(0,C.tZ)("div",{key:`tooltip-${t}`},x.length>1?(0,c.t)("Query %s: %s",t+1,e):e))),k=i?(0,c.t)("Exit fullscreen"):(0,c.t)("Enter fullscreen"),Z=(0,C.tZ)(St.v,{onClick:this.handleMenuClick,selectable:!1},(0,C.tZ)(St.v.Item,{key:Va,disabled:"loading"===this.props.chartStatus,style:{height:"auto",lineHeight:"initial"}},(0,c.t)("Force refresh"),(0,C.tZ)(Ha,null,w)),(0,C.tZ)(St.v.Item,{key:Ka},k),(0,C.tZ)(St.v.Divider,null),r.description&&(0,C.tZ)(St.v.Item,{key:Wa},this.props.isDescriptionExpanded?(0,c.t)("Hide chart description"):(0,c.t)("Show chart description")),this.props.supersetCanExplore&&(0,C.tZ)(St.v.Item,{key:Aa},(0,C.tZ)(ti.rU,{to:this.props.exploreUrl},(0,C.tZ)(ne.u,{title:Pa(this.props.slice.slice_name)},(0,c.t)("Edit chart")))),this.props.supersetCanExplore&&(0,C.tZ)(St.v.Item,{key:"view_query"},(0,C.tZ)(Tt.Z,{triggerNode:(0,C.tZ)("span",null,(0,c.t)("View query")),modalTitle:(0,c.t)("View query"),modalBody:(0,C.tZ)(Na.Z,{latestQueryFormData:this.props.formData}),draggable:!0,resizable:!0,responsive:!0})),this.props.supersetCanExplore&&(0,C.tZ)(St.v.Item,{key:"view_results"},(0,C.tZ)(Ja,{exploreUrl:this.props.exploreUrl,triggerNode:(0,C.tZ)("span",null,(0,c.t)("View as table")),modalTitle:(0,c.t)("Chart Data: %s",r.slice_name),modalBody:(0,C.tZ)(ja.Tg,{queryFormData:this.props.formData,queryForce:!1,dataSize:20,isRequest:!0,isVisible:!0})})),(0,gt.cr)(u.T.DRILL_TO_DETAIL)&&this.props.supersetCanExplore&&(0,C.tZ)(St.v.Item,{key:"drill_to_detail"},(0,C.tZ)(Ja,{exploreUrl:this.props.exploreUrl,triggerNode:(0,C.tZ)("span",null,(0,c.t)("Drill to detail")),modalTitle:(0,c.t)("Drill to detail: %s",r.slice_name),modalBody:(0,C.tZ)(qa.Z,{formData:this.props.formData})})),(r.description||this.props.supersetCanExplore)&&(0,C.tZ)(St.v.Divider,null),(0,gt.cr)(u.T.DASHBOARD_CROSS_FILTERS)&&v&&b&&(0,C.tZ)(s.Fragment,null,(0,C.tZ)(St.v.Item,{key:$a},(0,c.t)("Cross-filter scoping")),(0,C.tZ)(St.v.Divider,null)),p&&(0,C.tZ)(St.v.SubMenu,{title:(0,c.t)("Share")},(0,C.tZ)(Rt,{dashboardId:n,dashboardComponentId:t,copyMenuItemTitle:(0,c.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,c.t)("Share chart by email"),emailSubject:(0,c.t)("Superset chart"),emailBody:(0,c.t)("Check out this chart: "),addSuccessToast:d,addDangerToast:h})),"filter_box"!==this.props.slice.viz_type&&this.props.supersetCanCSV&&(0,C.tZ)(St.v.SubMenu,{title:(0,c.t)("Download")},(0,C.tZ)(St.v.Item,{key:Ua,icon:(0,C.tZ)(G.Z.FileOutlined,{css:Ya})},(0,c.t)("Export to .CSV")),"filter_box"!==this.props.slice.viz_type&&(0,gt.cr)(u.T.ALLOW_FULL_CSV_EXPORT)&&this.props.supersetCanCSV&&g&&(0,C.tZ)(St.v.Item,{key:La,icon:(0,C.tZ)(G.Z.FileOutlined,{css:Ya})},(0,c.t)("Export to full .CSV")),(0,C.tZ)(St.v.Item,{key:za,icon:(0,C.tZ)(G.Z.FileImageOutlined,{css:Ya})},(0,c.t)("Download as image"))));return(0,C.tZ)(s.Fragment,null,(0,C.tZ)(Ma,{chartId:r.slice_id,isOpen:this.state.showCrossFilterScopingModal,onClose:()=>this.setState({showCrossFilterScopingModal:!1})}),i&&(0,C.tZ)(G.Z.FullscreenExitOutlined,{style:{fontSize:22},onClick:()=>{this.props.handleToggleFullSize()}}),(0,C.tZ)(ii.$,{overlay:Z,trigger:["click"],placement:"bottomRight"},(0,C.tZ)("span",{id:`slice_${r.slice_id}-controls`,role:"button","aria-label":"More Options"},(0,C.tZ)(Ga,null))))}}const Xa=(0,Hr.EN)(Qa);var es=n(87185),ts=n.n(es);const ns={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var rs=n(27029),is=function(e,t){return s.createElement(rs.Z,Object.assign({},e,{ref:t,icon:ns}))};is.displayName="CheckCircleFilled";const os=s.forwardRef(is),as={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var ss=function(e,t){return s.createElement(rs.Z,Object.assign({},e,{ref:t,icon:as}))};ss.displayName="ExclamationCircleFilled";const ls=s.forwardRef(ss),ds={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"};var cs=function(e,t){return s.createElement(rs.Z,Object.assign({},e,{ref:t,icon:ds}))};cs.displayName="MinusCircleFilled";const us=s.forwardRef(cs);var hs=n(76697);const ps=y.iK.div`
  ${e=>{let{theme:t}=e;return C.iv`
    display: inline-block;
    color: ${t.colors.grayscale.light5};
    background: ${t.colors.grayscale.base};
    border-radius: 1em;
    vertical-align: text-top;
    padding: ${t.gridUnit}px ${2*t.gridUnit}px;
    font-size: ${t.typography.sizes.m}px;
    font-weight: ${t.typography.weights.bold};
    min-width: 1em;
    min-height: 1em;
    line-height: 1em;
    vertical-align: middle;
    white-space: nowrap;

    svg {
      position: relative;
      top: -2px;
      color: ${t.colors.grayscale.light5};
      width: 1em;
      height: 1em;
      display: inline-block;
      vertical-align: middle;
    }

    &:hover {
      cursor: pointer;
      background: ${t.colors.grayscale.dark1};
    }

    &.has-cross-filters {
      background: ${t.colors.primary.base};
      &:hover {
        background: ${t.colors.primary.dark1};
      }
    }

    &.has-incompatible-filters {
      color: ${t.colors.grayscale.dark2};
      background: ${t.colors.alert.base};
      &:hover {
        background: ${t.colors.alert.dark1};
      }
      svg {
        color: ${t.colors.grayscale.dark2};
      }
    }

    &.filters-inactive {
      color: ${t.colors.grayscale.light5};
      background: ${t.colors.grayscale.light1};
      padding: ${t.gridUnit}px;
      text-align: center;
      height: 22px;
      width: 22px;

      &:hover {
        background: ${t.colors.grayscale.base};
      }
    }
  `}}
`,fs=y.iK.span`
  position: relative;
  margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  font-weight: ${e=>{let{bold:t,theme:n}=e;return t?n.typography.weights.bold:"auto"}};
  color: ${e=>{let{color:t,theme:n}=e;return t||n.colors.grayscale.light5}};
  display: flex;
  align-items: center;
  & > * {
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,ms=y.iK.i`
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -${e=>{let{theme:t}=e;return 5*t.gridUnit}}px;
`,gs=y.iK.button`
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  text-align: left;
  padding: 0;
  border: none;
  background: none;
  outline: none;
  width: 100%;

  &::-moz-focus-inner {
    border: 0;
  }

  & i svg {
    color: transparent;
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }

  &:hover i svg {
    color: inherit;
  }
`,vs=y.iK.div`
  margin: 0 -${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,bs=y.iK.div`
  padding-left: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  margin: -${e=>{let{theme:t}=e;return 3*t.gridUnit}}px 0;
`,ys=y.iK.div`
  min-width: 200px;
  max-width: 300px;
  overflow-x: hidden;
`,Cs=y.iK.div`
  max-width: 100%;
  flex-grow: 1;
  overflow: auto;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
`,Ss=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n  padding-top: ${3*t.gridUnit}px;\n  max-width: 100%;\n  flex-grow: 1;\n  overflow: auto;\n  color: ${t.colors.grayscale.light5};\n  `}}
`;var xs=n(76570);n(14670);const ws=(0,c.t)("Please apply filter changes"),ks=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,c.t)("Unknown value"),Zs=e=>{let{filterSetFilterValues:t,dataMaskSelected:n}=e;return t.find((e=>{let{dataMask:t={}}=e;const r=Object.entries(n);return r.every((e=>{var n;let[i,o]=e;const a=(0,Jr.JB)(o.filterState,null==t||null==(n=t[i])?void 0:n.filterState,{ignoreUndefined:!0,ignoreNull:!0}),s=r.length===Object.keys(null!=t?t:{}).length;return a&&s}))}))},Rs=e=>{let{indicator:{column:t,name:n,value:r,path:i=[]},onClick:o=(()=>{}),text:a}=e;const l=ks(r);return(0,C.tZ)(s.Fragment,null,(0,C.tZ)(gs,{onClick:()=>o([...i,`LABEL-${t}`])},(0,C.tZ)(fs,{bold:!0},(0,C.tZ)(ms,null,(0,C.tZ)(xs.Z,null)),n,l?": ":""),(0,C.tZ)(Cs,null,l)),a&&(0,C.tZ)(Ss,null,a))},Ts=e=>{let{appliedCrossFilterIndicators:t=[],appliedIndicators:n=[],incompatibleIndicators:r=[],unsetIndicators:o=[],onHighlightFilterSource:a,children:l}=e;const[d,u]=(0,s.useState)(!1),h=(0,y.Fg)(),p=(0,i.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs}));(0,s.useEffect)((()=>{d&&window.addEventListener("resize",(()=>u(!1)),{once:!0})}),[d]),(0,s.useEffect)((()=>{u(!1)}),[p]);const f=()=>{const e=[];return t.length&&e.push("appliedCrossFilters"),n.length&&e.push("applied"),r.length&&e.push("incompatible"),e.length?e:["unset"]},[m,g]=(0,s.useState)((()=>[...f()])),v=e=>`${e.column} - ${e.name}`,b=(0,C.tZ)(ys,null,(0,C.tZ)(C.xB,{styles:(0,C.iv)(".filterStatusPopover{.ant-popover-inner{background-color:",h.colors.grayscale.dark2,"cc;.ant-popover-inner-content{padding-top:0;padding-bottom:0;}}&.ant-popover-placement-bottom,&.ant-popover-placement-bottomLeft,&.ant-popover-placement-bottomRight{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",h.colors.grayscale.dark2,"cc;border-left-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-top,&.ant-popover-placement-topLeft,&.ant-popover-placement-topRight{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",h.colors.grayscale.dark2,"cc;border-right-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-left,&.ant-popover-placement-leftTop,&.ant-popover-placement-leftBottom{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",h.colors.grayscale.dark2,"cc;border-right-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-right,&.ant-popover-placement-rightTop,&.ant-popover-placement-rightBottom{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",h.colors.grayscale.dark2,"cc;border-left-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover{color:",h.colors.grayscale.light4,";z-index:99;}}","")}),(0,C.tZ)(vs,null,(0,C.tZ)(ho.Z,{ghost:!0,light:!0,activeKey:m,onChange:function(e){g("string"==typeof e?[e]:e)}},t.length?(0,C.tZ)(ho.Z.Panel,{key:"appliedCrossFilters",header:(0,C.tZ)(fs,{bold:!0,color:h.colors.primary.light1},(0,C.tZ)(G.Z.CursorTarget,{css:(0,C.iv)({fill:h.colors.primary.light1},"",""),iconSize:"xl"}),(0,c.t)("Applied Cross Filters (%d)",t.length))},(0,C.tZ)(bs,{css:(0,C.iv)({paddingBottom:3*h.gridUnit},"","")},t.map((e=>(0,C.tZ)(Rs,{key:v(e),indicator:e,onClick:a}))))):null,n.length?(0,C.tZ)(ho.Z.Panel,{key:"applied",header:(0,C.tZ)(fs,{bold:!0,color:h.colors.success.base},(0,C.tZ)(os,null)," ",(0,c.t)("Applied Filters (%d)",n.length))},(0,C.tZ)(bs,{css:(0,C.iv)({paddingBottom:3*h.gridUnit},"","")},n.map((e=>(0,C.tZ)(Rs,{key:v(e),indicator:e,onClick:a}))))):null,r.length?(0,C.tZ)(ho.Z.Panel,{key:"incompatible",header:(0,C.tZ)(fs,{bold:!0,color:h.colors.alert.base},(0,C.tZ)(ls,null)," ",(0,c.t)("Incompatible Filters (%d)",r.length))},(0,C.tZ)(bs,{css:(0,C.iv)({paddingBottom:3*h.gridUnit},"","")},r.map((e=>(0,C.tZ)(Rs,{key:v(e),indicator:e,onClick:a}))))):null,o.length?(0,C.tZ)(ho.Z.Panel,{key:"unset",header:(0,C.tZ)(fs,{bold:!0,color:h.colors.grayscale.light1},(0,C.tZ)(us,null)," ",(0,c.t)("Unset Filters (%d)",o.length)),disabled:!o.length},(0,C.tZ)(bs,{css:(0,C.iv)({paddingBottom:3*h.gridUnit},"","")},o.map((e=>(0,C.tZ)(Rs,{key:v(e),indicator:e,onClick:a}))))):null)));return(0,C.tZ)(hs.ZP,{overlayClassName:"filterStatusPopover",content:b,visible:d,onVisibleChange:function(e){u(e),e&&g(f())},placement:"bottomRight",trigger:"click"},l)};var Fs;!function(e){e.Unset="UNSET",e.Applied="APPLIED",e.Incompatible="INCOMPATIBLE",e.CrossFilterApplied="CROSS_FILTER_APPLIED"}(Fs||(Fs={}));const Ds=new Set(Object.values(Q.i2)),_s=e=>null!=e&&e.label?e.label:null!=e&&e.value?(0,Ci.Z)(null==e?void 0:e.value).join(", "):null,Es=(e,t,n)=>{const r=t.columns[e],i=Array.isArray(r)?r:[r];if(null==r||t.isDateFilter&&r===Q.vM||0===i.length)return[];if(t.isDateFilter&&Ds.has(e)){const t=((e===Q.i2.time_grain_sqla?n.time_grain_sqla:n.granularity)||[]).reduce(((e,t)=>{let[n,r]=t;return{...e,[n]:r}}),{});return i.map((e=>t[e]||e))}return i},Is=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.applied_filters)||[]).map((e=>e.column)))},Ms=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)||[]).map((e=>e.column)))},Os={},Ps={},Ns={},js={},qs={},$s=[],zs=e=>{var t,n,r;let{chartId:o}=e;const l=(0,i.I0)(),d=(0,i.v9)((e=>e.datasources)),c=(0,i.v9)((e=>e.dashboardFilters)),h=(0,i.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),p=(0,i.v9)((e=>e.dashboardInfo)),f=(0,i.v9)((e=>e.charts)),m=(0,i.v9)((e=>e.dashboardLayout.present)),g=(0,i.v9)((e=>e.dataMask)),[b,y]=(0,s.useState)($s),[S,x]=(0,s.useState)($s),w=(0,s.useCallback)((e=>{l((0,Gt.E2)(e))}),[l]),k=f[o],Z=(0,wa.D)(k),R=null==Z?void 0:Z.chartStatus,T=(0,wa.D)(c),F=(0,wa.D)(d),D=(null==k?void 0:k.chartStatus)&&a()(t=["rendered","success"]).call(t,k.chartStatus);(0,s.useEffect)((()=>{if(!D&&S.length>0)x($s);else if("success"!==R){var e,t,n,r,i,s,l,u;(null==k||null==(e=k.queriesResponse)||null==(t=e[0])?void 0:t.rejected_filters)===(null==Z||null==(n=Z.queriesResponse)||null==(r=n[0])?void 0:r.rejected_filters)&&(null==k||null==(i=k.queriesResponse)||null==(s=i[0])?void 0:s.applied_filters)===(null==Z||null==(l=Z.queriesResponse)||null==(u=l[0])?void 0:u.applied_filters)&&c===T&&d===F||x(((e,t,n,r)=>{const i=Is(r),o=Ms(r),s=Object.values(t).filter((t=>t.chartId!==e)),l=Object.entries(n).filter((e=>{let[t]=e;return s.find((e=>e.datasourceId===t))})).map((e=>{let[,t]=e;return t})),d=Ps[e];if(Os[e]&&(0,Jr.JB)(null==d?void 0:d.appliedColumns,i)&&(0,Jr.JB)(null==d?void 0:d.rejectedColumns,o)&&(0,Jr.JB)(null==d?void 0:d.matchingFilters,s)&&(0,Jr.JB)(null==d?void 0:d.matchingDatasources,l))return Os[e];const c=s.reduce(((t,r)=>t.concat(((e,t,n,r,i)=>{const o=(e,t)=>r.has(e)&&t.columns[e]?Fs.Applied:i.has(e)?Fs.Incompatible:Fs.Unset;return Object.keys(t.columns).filter((n=>{var r;return a()(r=(0,bn.up)({filterScope:t.scopes[n]})).call(r,e)})).map((e=>({column:e,name:t.labels[e]||e,value:Es(e,t,n),status:o(e,t),path:t.directPathToFilter})))})(e,r,n[r.datasourceId]||{},i,o))),[]);return c.sort(((e,t)=>e.name.localeCompare(t.name))),Os[e]=c,Ps[e]={appliedColumns:i,rejectedColumns:o,matchingFilters:s,matchingDatasources:l},c})(o,c,d,k))}}),[k,o,c,S.length,d,null==Z?void 0:Z.queriesResponse,R,T,F,D]);const _=(0,wa.D)(h),E=(0,wa.D)(m),I=(0,wa.D)(g),M=(0,wa.D)(null==(n=p.metadata)?void 0:n.chart_configuration);(0,s.useEffect)((()=>{if(!D&&b.length>0)y($s);else if("success"!==R){var e,t,n,r,i,s,l,d,c,f;(null==k||null==(e=k.queriesResponse)||null==(t=e[0])?void 0:t.rejected_filters)===(null==Z||null==(n=Z.queriesResponse)||null==(r=n[0])?void 0:r.rejected_filters)&&(null==k||null==(i=k.queriesResponse)||null==(s=i[0])?void 0:s.applied_filters)===(null==Z||null==(l=Z.queriesResponse)||null==(d=l[0])?void 0:d.applied_filters)&&h===_&&m===E&&g===I&&M===(null==(c=p.metadata)?void 0:c.chart_configuration)||y(function(e,t,n,r,i,o){void 0===o&&(o=qs);const s=Is(r),l=Ms(r),d=js[n];if(Ns[n]&&(0,Jr.JB)(null==d?void 0:d.appliedColumns,s)&&(0,Jr.JB)(null==d?void 0:d.rejectedColumns,l)&&(null==d?void 0:d.nativeFilters)===e&&(null==d?void 0:d.dashboardLayout)===i&&(null==d?void 0:d.chartConfiguration)===o&&(null==d?void 0:d.dataMask)===t)return Ns[n];const c=e=>{let{label:t,column:n,type:r=Pi.gT.NativeFilters}=e;const i=null!==t;return r===Pi.gT.CrossFilters&&i?Fs.CrossFilterApplied:!n&&i?Fs.Applied:n&&l.has(n)?Fs.Incompatible:n&&s.has(n)&&i?Fs.Applied:Fs.Unset};let h=[];(0,u.c)(u.T.DASHBOARD_NATIVE_FILTERS)&&(h=e&&Object.values(e).filter((e=>{var t;return e.type===Pi.BE.NATIVE_FILTER&&(null==(t=e.chartsInScope)?void 0:a()(t).call(t,n))})).map((e=>{var n,r,i,o;const a=null==(n=e.targets)||null==(r=n[0])||null==(i=r.column)?void 0:i.name,s=null==(o=t[e.id])?void 0:o.filterState,l=_s(s);return{column:a,name:e.name,path:[e.id],status:c({label:l,column:a}),value:l}})));let p=[];if((0,u.c)(u.T.DASHBOARD_CROSS_FILTERS)){const e=Object.values(i);p=Object.values(o).filter((e=>{var t,r;return null==(t=e.crossFilters)||null==(r=t.chartsInScope)?void 0:a()(r).call(r,n)})).map((n=>{var r,i,o;const a=null==(r=t[n.id])?void 0:r.filterState,s=_s(a),l=null==a?void 0:a.filters,d=l&&Object.keys(l)[0],u=e.find((e=>{var t;return(null==e||null==(t=e.meta)?void 0:t.chartId)===n.id}));return{column:d,name:null==u||null==(i=u.meta)?void 0:i.sliceName,path:[...null!=(o=null==u?void 0:u.parents)?o:[],null==u?void 0:u.id],status:c({label:s,type:Pi.gT.CrossFilters}),value:s}})).filter((e=>e.status===Fs.CrossFilterApplied))}const f=p.concat(h);return Ns[n]=f,js[n]={nativeFilters:e,dashboardLayout:i,chartConfiguration:o,dataMask:t,appliedColumns:s,rejectedColumns:l},f}(h,g,o,k,m,null==(f=p.metadata)?void 0:f.chart_configuration))}}),[k,o,null==(r=p.metadata)?void 0:r.chart_configuration,g,h,b.length,m,null==Z?void 0:Z.queriesResponse,M,R,E,I,_,D]);const O=(0,s.useMemo)((()=>ts()((e=>{const t=[Fs.Applied,Fs.Unset,Fs.Incompatible];return e.sort(((e,n)=>t.indexOf(e.status)-t.indexOf(n.status)))})([...S,...b]),((e,t)=>e.column===t.column&&e.name===t.name&&(e.status!==Fs.Applied||t.status!==Fs.Applied)))),[S,b]),P=(0,s.useMemo)((()=>O.filter((e=>e.status===Fs.CrossFilterApplied))),[O]),N=(0,s.useMemo)((()=>O.filter((e=>e.status===Fs.Applied))),[O]),j=(0,s.useMemo)((()=>O.filter((e=>e.status===Fs.Unset))),[O]),q=(0,s.useMemo)((()=>O.filter((e=>e.status===Fs.Incompatible))),[O]);if(!(P.length||N.length||q.length||j.length))return null;const $=!P.length&&!N.length&&!q.length;return(0,C.tZ)(Ts,{appliedCrossFilterIndicators:P,appliedIndicators:N,unsetIndicators:j,incompatibleIndicators:q,onHighlightFilterSource:w},(0,C.tZ)(ps,{className:v()("filter-counts",!!q.length&&"has-incompatible-filters",!!P.length&&"has-cross-filters",$&&"filters-inactive")},(0,C.tZ)(G.Z.Filter,{iconSize:"m"}),!$&&(0,C.tZ)("span",null,N.length+P.length),q.length?(0,C.tZ)(s.Fragment,null," ",(0,C.tZ)(G.Z.AlertSolid,null),(0,C.tZ)("span",null,q.length)):null))},As=s.memo(zs);var Us=n(37936);const Ls=(0,c.t)("Annotation layers are still loading."),Vs=(0,c.t)("One ore more annotation layers failed loading."),Ks=(0,y.iK)(G.Z.CursorTarget)`
  cursor: pointer;
  color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  height: 22px;
  width: 22px;
`,Ws=e=>{let{innerRef:t=null,forceRefresh:n=(()=>({})),updateSliceName:r=(()=>({})),toggleExpandSlice:o=(()=>({})),logExploreChart:a=(()=>({})),exportCSV:l=(()=>({})),editMode:d=!1,annotationQuery:u={},annotationError:h={},cachedDttm:p=null,updatedDttm:f=null,isCached:m=[],isExpanded:g=!1,sliceName:v="",supersetCanExplore:b=!1,supersetCanShare:y=!1,supersetCanCSV:S=!1,sliceCanEdit:x=!1,exportFullCSV:w,slice:k,componentId:Z,dashboardId:R,addSuccessToast:T,addDangerToast:F,handleToggleFullSize:D,isFullSize:_,chartStatus:E,formData:I,width:M,height:O}=e;const P=(0,i.I0)(),N=(0,Xr.fG)(),j=(0,s.useContext)(Us.DashboardPageIdContext),[q,$]=(0,s.useState)(null),z=(0,s.useRef)(null),A=(0,i.v9)((e=>{var t,n;return null==(t=e.dataMask[null==k?void 0:k.slice_id])||null==(n=t.filterState)?void 0:n.value})),U=(0,s.useMemo)((()=>({value:A,name:(0,c.t)("Emitted values")})),[A]),L=!d&&b;(0,s.useEffect)((()=>{const e=z.current;L?$(Pa(v)):e&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight)?$(null!=v?v:null):$(null)}),[v,M,O,L]);const V=`/explore/?dashboard_page_id=${j}&slice_id=${k.slice_id}`;return(0,C.tZ)("div",{className:"chart-header",ref:t},(0,C.tZ)("div",{className:"header-title",ref:z},(0,C.tZ)(ne.u,{title:q},(0,C.tZ)(ei.Z,{title:v||(d?"---":""),canEdit:d,emptyText:"",onSaveTitle:r,showTooltip:!1,url:L?V:void 0})),!!Object.values(u).length&&(0,C.tZ)(ne.u,{id:"annotations-loading-tooltip",placement:"top",title:Ls},(0,C.tZ)("i",{role:"img","aria-label":Ls,className:"fa fa-refresh warning"})),!!Object.values(h).length&&(0,C.tZ)(ne.u,{id:"annoation-errors-tooltip",placement:"top",title:Vs},(0,C.tZ)("i",{role:"img","aria-label":Vs,className:"fa fa-exclamation-circle danger"}))),(0,C.tZ)("div",{className:"header-controls"},!d&&(0,C.tZ)(s.Fragment,null,A&&(0,C.tZ)(ne.u,{placement:"top",title:(0,C.tZ)(Rs,{indicator:U,text:(0,c.t)("Click to clear emitted filters")})},(0,C.tZ)(Ks,{onClick:()=>P((0,ut.ze)(null==k?void 0:k.slice_id))})),!N.hideChartControls&&(0,C.tZ)(As,{chartId:k.slice_id}),!N.hideChartControls&&(0,C.tZ)(Xa,{slice:k,isCached:m,isExpanded:g,cachedDttm:p,updatedDttm:f,toggleExpandSlice:o,forceRefresh:n,logExploreChart:a,exportCSV:l,exportFullCSV:w,supersetCanExplore:b,supersetCanShare:y,supersetCanCSV:S,sliceCanEdit:x,componentId:Z,dashboardId:R,addSuccessToast:T,addDangerToast:F,handleToggleFullSize:D,isFullSize:_,isDescriptionExpanded:g,chartStatus:E,formData:I,exploreUrl:V}))))},Bs={height:d().number.isRequired};function Hs(e){let{height:t}=e;return(0,C.tZ)("div",{className:"missing-chart-container",style:{height:t+20}},(0,C.tZ)("div",{className:"missing-chart-body"},(0,c.t)("There is no chart definition associated with this component, could it have been deleted?"),(0,C.tZ)("br",null),(0,C.tZ)("br",null),(0,c.t)("Delete this container and save to remove this message.")))}Hs.propTypes=Bs;const Gs={id:d().number.isRequired,componentId:d().string.isRequired,dashboardId:d().number.isRequired,width:d().number.isRequired,height:d().number.isRequired,updateSliceName:d().func.isRequired,isComponentVisible:d().bool,handleToggleFullSize:d().func.isRequired,setControlValue:d().func,chart:J.$6.isRequired,formData:d().object.isRequired,labelColors:d().object,sharedLabelColors:d().object,datasource:d().object,slice:J.Rw.isRequired,sliceName:d().string.isRequired,timeout:d().number.isRequired,maxRows:d().number.isRequired,filterboxMigrationState:Q.Qi,filters:d().object.isRequired,refreshChart:d().func.isRequired,logEvent:d().func.isRequired,toggleExpandSlice:d().func.isRequired,changeFilter:d().func.isRequired,setFocusedFilterField:d().func.isRequired,unsetFocusedFilterField:d().func.isRequired,editMode:d().bool.isRequired,isExpanded:d().bool.isRequired,isCached:d().bool,supersetCanExplore:d().bool.isRequired,supersetCanShare:d().bool.isRequired,supersetCanCSV:d().bool.isRequired,sliceCanEdit:d().bool.isRequired,addSuccessToast:d().func.isRequired,addDangerToast:d().func.isRequired,ownState:d().object,filterState:d().object,postTransformProps:d().func,datasetsStatus:d().oneOf(["loading","error","complete"])},Ys=Object.keys(Gs).filter((e=>"width"!==e&&"height"!==e&&"isComponentVisible"!==e)),Js=new Set(["filter_box"]),Qs=y.iK.div`
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;

  &.is-deactivated {
    opacity: 0.5;
    background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
  }
`,Xs=y.iK.div`
  display: flex;
  flex-direction: column;
  max-height: 100%;
`;class el extends s.Component{constructor(e){super(e),this.logExploreChart=()=>{this.props.logEvent(vt.oK,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached})},this.onExploreChart=async e=>{const t=e.shiftKey||e.ctrlKey||e.metaKey;try{const e=window.localStorage.getItem("last_tab_id"),n=e?String(Number.parseInt(e,10)+1):void 0,r=await(0,Qr.nv)(this.props.datasource.id,this.props.datasource.type,this.props.formData,this.props.slice.slice_id,n),i=(0,Gr.y8)(null,{[xt.KD.formDataKey.name]:r,[xt.KD.sliceId.name]:this.props.slice.slice_id});(0,u.c)(u.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB)||t?window.open(i,"_blank","noreferrer"):this.props.history.push(i)}catch(e){kt.Z.error(e),this.props.addDangerToast((0,c.t)("An error occurred while opening Explore"))}},this.state={width:e.width,height:e.height,descriptionHeight:0},this.changeFilter=this.changeFilter.bind(this),this.handleFilterMenuOpen=this.handleFilterMenuOpen.bind(this),this.handleFilterMenuClose=this.handleFilterMenuClose.bind(this),this.exportCSV=this.exportCSV.bind(this),this.exportFullCSV=this.exportFullCSV.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.resize=this.resize.bind(this),this.setDescriptionRef=this.setDescriptionRef.bind(this),this.setHeaderRef=this.setHeaderRef.bind(this),this.getChartHeight=this.getChartHeight.bind(this),this.getDescriptionHeight=this.getDescriptionHeight.bind(this)}shouldComponentUpdate(e,t){var n,r,i,o,a;if(t.width!==this.state.width||t.height!==this.state.height||t.descriptionHeight!==this.state.descriptionHeight||!Br()(e.datasource,this.props.datasource))return!0;if((null==(n=this.props)||null==(r=n.chart)?void 0:r.chartStatus)!==(null==e||null==(i=e.chart)?void 0:i.chartStatus)&&"loading"===(null==(o=this.props)||null==(a=o.chart)?void 0:a.chartStatus))return!0;if(e.isComponentVisible){if(e.chart.triggerQuery)return!0;if(e.isFullSize!==this.props.isFullSize)return clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350),!1;e.width===this.props.width&&e.height===this.props.height||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350));for(let t=0;t<Ys.length;t+=1){const n=Ys[t];if(!(0,Jr.JB)(e[n],this.props[n]))return!0}}return this.props.cacheBusterProp!==e.cacheBusterProp}componentDidMount(){if(this.props.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}componentWillUnmount(){clearTimeout(this.resizeTimeout)}componentDidUpdate(e){if(this.props.isExpanded!==e.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}getDescriptionHeight(){return this.props.isExpanded&&this.descriptionRef?this.descriptionRef.offsetHeight:0}getChartHeight(){const e=this.getHeaderHeight();return Math.max(this.state.height-e-this.state.descriptionHeight,20)}getHeaderHeight(){if(this.headerRef){const e=getComputedStyle(this.headerRef).getPropertyValue("margin-bottom"),t=parseInt(e,10)||0;return this.headerRef.offsetHeight+t}return 22}setDescriptionRef(e){this.descriptionRef=e}setHeaderRef(e){this.headerRef=e}resize(){const{width:e,height:t}=this.props;this.setState((()=>({width:e,height:t})))}changeFilter(e){void 0===e&&(e={}),this.props.logEvent(vt.Qg,{id:this.props.chart.id,columns:Object.keys(e)}),this.props.changeFilter(this.props.chart.id,e)}handleFilterMenuOpen(e,t){this.props.setFocusedFilterField(e,t)}handleFilterMenuClose(e,t){this.props.unsetFocusedFilterField(e,t)}exportCSV(e){void 0===e&&(e=!1),this.props.logEvent(vt.PC,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),(0,Gr.pe)({formData:e?{...this.props.formData,row_limit:this.props.maxRows}:this.props.formData,resultType:"full",resultFormat:"csv",force:!0,ownState:this.props.ownState})}exportFullCSV(){this.exportCSV(!0)}forceRefresh(){return this.props.logEvent(vt.TD,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),this.props.refreshChart(this.props.chart.id,!0,this.props.dashboardId)}render(){var e;const{id:t,componentId:n,dashboardId:r,chart:i,slice:o,datasource:s,isExpanded:l,editMode:d,filters:c,formData:u,labelColors:h,sharedLabelColors:p,updateSliceName:f,sliceName:m,toggleExpandSlice:g,timeout:b,supersetCanExplore:y,supersetCanShare:S,supersetCanCSV:x,sliceCanEdit:w,addSuccessToast:k,addDangerToast:Z,ownState:R,filterState:T,handleToggleFullSize:F,isFullSize:D,setControlValue:_,filterboxMigrationState:E,postTransformProps:I,datasetsStatus:M}=this.props,{width:O}=this.state;if(!i||!o)return(0,C.tZ)(Hs,{height:this.getChartHeight()});const{queriesResponse:P,chartUpdateEndTime:N,chartStatus:j}=i,q="loading"===j,$="filter_box"===o.viz_type&&a()(e=[Q.Qi.REVIEWING,Q.Qi.CONVERTED]).call(e,E),z=(null==P?void 0:P.map((e=>{let{is_cached:t}=e;return t})))||[],A=(null==P?void 0:P.map((e=>{let{cached_dttm:t}=e;return t})))||[],U=Js.has(o.viz_type),L=(0,bn.Z3)(t)?function(e){let{activeFilters:t={},filterId:n}=e;return Object.entries(t).reduce(((e,t)=>{const[r,{values:i}]=t,{chartId:o,column:a}=(0,rn._)(r);return o===n?{...e,[a]:i}:e}),{})}({activeFilters:c,filterId:t}):{};return(0,C.tZ)(Xs,{className:"chart-slice","data-test-chart-id":t,"data-test-viz-type":o.viz_type,"data-test-chart-name":o.slice_name},(0,C.tZ)(Ws,{innerRef:this.setHeaderRef,slice:o,isExpanded:l,isCached:z,cachedDttm:A,updatedDttm:N,toggleExpandSlice:g,forceRefresh:this.forceRefresh,editMode:d,annotationQuery:i.annotationQuery,logExploreChart:this.logExploreChart,onExploreChart:this.onExploreChart,exportCSV:this.exportCSV,exportFullCSV:this.exportFullCSV,updateSliceName:f,sliceName:m,supersetCanExplore:y,supersetCanShare:S,supersetCanCSV:x,sliceCanEdit:w,componentId:n,dashboardId:r,filters:c,addSuccessToast:k,addDangerToast:Z,handleToggleFullSize:F,isFullSize:D,chartStatus:i.chartStatus,formData:u,width:O,height:this.getHeaderHeight()}),l&&o.description_markeddown&&(0,C.tZ)("div",{className:"slice_description bs-callout bs-callout-default",ref:this.setDescriptionRef,dangerouslySetInnerHTML:{__html:o.description_markeddown}}),(0,C.tZ)("div",{className:v()("dashboard-chart",U&&"dashboard-chart--overflowable")},(q||$)&&(0,C.tZ)(Qs,{className:v()($&&"is-deactivated"),style:{width:O,height:this.getChartHeight()}}),(0,C.tZ)(Yr.Z,{width:O,height:this.getChartHeight(),addFilter:this.changeFilter,onFilterMenuOpen:this.handleFilterMenuOpen,onFilterMenuClose:this.handleFilterMenuClose,annotationData:i.annotationData,chartAlert:i.chartAlert,chartId:t,chartStatus:j,datasource:s,dashboardId:r,initialValues:L,formData:u,labelColors:h,sharedLabelColors:p,ownState:R,filterState:T,queriesResponse:i.queriesResponse,timeout:b,triggerQuery:i.triggerQuery,vizType:o.viz_type,setControlValue:_,isDeactivatedViz:$,filterboxMigrationState:E,postTransformProps:I,datasetsStatus:M})))}}el.propTypes=Gs,el.defaultProps={isCached:!1,isComponentVisible:!0};const tl=(0,Hr.EN)(el);var nl=n(9531);const rl={},il=(0,i.$j)((function(e,t){var n,r,i,o,a;let{charts:s,dashboardInfo:l,dashboardState:d,dataMask:c,datasources:u,sliceEntities:h,nativeFilters:p,common:f}=e;const{id:m,extraControls:g,setControlValue:v}=t,b=s[m]||rl,y=b&&b.form_data&&u[b.form_data.datasource]||nl.tw,{colorScheme:C,colorNamespace:S,datasetsStatus:x}=d,w=(null==l||null==(n=l.metadata)?void 0:n.label_colors)||{},k=(null==l||null==(r=l.metadata)?void 0:r.shared_label_colors)||{},Z=(0,Kr.Z)({chart:b,chartConfiguration:null==(i=l.metadata)?void 0:i.chart_configuration,charts:s,filters:(0,bn._f)(m),colorScheme:C,colorNamespace:S,sliceId:m,nativeFilters:null==p?void 0:p.filters,allSliceIds:d.sliceIds,dataMask:c,extraControls:g,labelColors:w,sharedLabelColors:k});return Z.dashboardId=l.id,{chart:b,datasource:y,labelColors:w,sharedLabelColors:k,slice:h.slices[m],timeout:l.common.conf.SUPERSET_WEBSERVER_TIMEOUT,filters:(0,bn.De)()||rl,formData:Z,editMode:d.editMode,isExpanded:!!d.expandedSlices[m],supersetCanExplore:!!l.superset_can_explore,supersetCanShare:!!l.superset_can_share,supersetCanCSV:!!l.superset_can_csv,sliceCanEdit:!!l.slice_can_edit,ownState:null==(o=c[m])?void 0:o.ownState,filterState:null==(a=c[m])?void 0:a.filterState,maxRows:f.conf.SQL_MAX_ROW,setControlValue:v,filterboxMigrationState:d.filterboxMigrationState,datasetsStatus:x}}),(function(e){return(0,r.DE)({updateComponents:Pr.WZ,addSuccessToast:Nr.ws,addDangerToast:Nr.Gb,toggleExpandSlice:Gt.WL,changeFilter:Ht.M6,setFocusedFilterField:Gt.GH,unsetFocusedFilterField:Gt.oY,refreshChart:Vr.refreshChart,logEvent:jr.logEvent},e)}))(tl);var ol=n(13433);function al(e){let{dashboardId:t,anchorLinkId:n,placement:r="right",emailContent:o="",emailSubject:a=""}=e;const[l,d]=(0,s.useState)(""),{addDangerToast:u}=(0,fr.e1)(),{dataMask:h,activeTabs:p}=(0,i.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs}))),f=`mailto:?Subject=${a}%20&Body=${o}${l||""}`;return(0,C.tZ)(hs.ZP,{trigger:"click",placement:r,content:(0,C.tZ)("div",{id:"shorturl-popover",onClick:e=>{e.stopPropagation()}},(0,C.tZ)(ol.Z,{text:l,copyNode:(0,C.tZ)("i",{className:"fa fa-clipboard",title:(0,c.t)("Copy to clipboard")})}),"  ",(0,C.tZ)("a",{href:f},(0,C.tZ)("i",{className:"fa fa-envelope"})))},(0,C.tZ)("span",{className:"short-link-trigger btn btn-default btn-sm",tabIndex:0,role:"button",onClick:e=>{e.stopPropagation(),(async()=>{try{const e=await(0,Zt.Nm)({dashboardId:t,dataMask:h,activeTabs:p,anchor:n});d(e)}catch(e){e&&u((await(0,To.O)(e)).error||(0,c.t)("Something went wrong."))}})()}},(0,C.tZ)("i",{className:"short-link-trigger fa fa-link"})," "))}var sl=n(56967);function ll(e){let{id:t,dashboardId:n,placement:r="right",scrollIntoView:i=!1,showShortLinkButton:o=!0}=e;const a=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({block:"center",behavior:"smooth"})},l=(0,sl.Z)();return(0,s.useEffect)((()=>{l&&t===l&&a(t)}),[l,t]),(0,s.useEffect)((()=>{i&&a(t)}),[t,i]),(0,C.tZ)("span",{className:"anchor-link-container",id:t},o&&n&&(0,C.tZ)(al,{anchorLinkId:t,dashboardId:n,emailSubject:(0,c.t)("Superset chart"),emailContent:(0,c.t)("Check out this chart in dashboard:"),placement:r}))}const dl=e=>{let{onDelete:t}=e;return(0,C.tZ)(Ur,{onClick:t,icon:(0,C.tZ)(G.Z.Trash,{iconSize:"xl"})})},cl=y.iK.div`
  .hover-menu {
    opacity: 0;
    position: absolute;
    z-index: 10;
    font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.m}};
  }

  .hover-menu--left {
    width: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
    top: 50%;
    transform: translate(0, -50%);
    left: ${e=>{let{theme:t}=e;return-7*t.gridUnit}}px;
    padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .hover-menu--left > :nth-child(n):not(:only-child):not(:last-child) {
    margin-bottom: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
  }

  .hover-menu--top {
    height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
    top: ${e=>{let{theme:t}=e;return-6*t.gridUnit}}px;
    left: 50%;
    transform: translate(-50%);
    padding: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
  }
`;class ul extends s.PureComponent{render(){const{innerRef:e,position:t,children:n}=this.props;return(0,C.tZ)(cl,{className:"hover-menu-container"},(0,C.tZ)("div",{ref:e,className:v()("hover-menu","left"===t&&"hover-menu--left","top"===t&&"hover-menu--top")},n))}}ul.defaultProps={position:"left",innerRef:null,children:null};const hl={right:function(){return(0,C.tZ)("div",{className:"resize-handle resize-handle--right"})},bottom:function(){return(0,C.tZ)("div",{className:"resize-handle resize-handle--bottom"})},bottomRight:function(){return(0,C.tZ)("div",{className:"resize-handle resize-handle--bottom-right"})}},pl={top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},fl={widthAndHeight:pl,widthOnly:{...pl,bottomRight:!1,bottom:!1},heightOnly:{...pl,bottomRight:!1,right:!1},notAdjustable:{...pl,bottomRight:!1,bottom:!1,right:!1}},ml=Number.MAX_VALUE,gl={id:d().string.isRequired,children:d().node,adjustableWidth:d().bool,adjustableHeight:d().bool,gutterWidth:d().number,widthStep:d().number,heightStep:d().number,widthMultiple:d().number,heightMultiple:d().number,minWidthMultiple:d().number,maxWidthMultiple:d().number,minHeightMultiple:d().number,maxHeightMultiple:d().number,staticHeight:d().number,staticHeightMultiple:d().number,staticWidth:d().number,staticWidthMultiple:d().number,onResizeStop:d().func,onResize:d().func,onResizeStart:d().func,editMode:d().bool.isRequired},vl={children:null,adjustableWidth:!0,adjustableHeight:!0,gutterWidth:Y.es,widthStep:Y.cd,heightStep:Y.cd,widthMultiple:null,heightMultiple:null,minWidthMultiple:1,maxWidthMultiple:ml,minHeightMultiple:1,maxHeightMultiple:ml,staticHeight:null,staticHeightMultiple:null,staticWidth:null,staticWidthMultiple:null,onResizeStop:null,onResize:null,onResizeStart:null},bl=[Y.cd,Y.cd],yl={right:"resizable-container-handle--right",bottom:"resizable-container-handle--bottom"};class Cl extends s.PureComponent{constructor(e){super(e),this.state={isResizing:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this)}handleResizeStart(e,t,n){const{id:r,onResizeStart:i}=this.props;i&&i({id:r,direction:t,ref:n}),this.setState((()=>({isResizing:!0})))}handleResize(e,t,n){const{onResize:r,id:i}=this.props;r&&r({id:i,direction:t,ref:n})}handleResizeStop(e,t,n,r){const{id:i,onResizeStop:o,widthStep:a,heightStep:s,widthMultiple:l,heightMultiple:d,adjustableHeight:c,adjustableWidth:u,gutterWidth:h}=this.props;if(o){const e=l+Math.round(r.width/(a+h)),t=d+Math.round(r.height/s);o({id:i,widthMultiple:u?e:null,heightMultiple:c?t:null}),this.setState((()=>({isResizing:!1})))}}render(){const{children:e,adjustableWidth:t,adjustableHeight:n,widthStep:r,heightStep:i,widthMultiple:o,heightMultiple:a,staticHeight:s,staticHeightMultiple:l,staticWidth:d,staticWidthMultiple:c,minWidthMultiple:u,maxWidthMultiple:h,minHeightMultiple:p,maxHeightMultiple:f,gutterWidth:m,editMode:g}=this.props,y={width:t?(r+m)*o-m:c&&c*r||d||void 0,height:n?i*a:l&&l*i||s||void 0};let S=fl.notAdjustable;g&&t&&n?S=fl.widthAndHeight:g&&t?S=fl.widthOnly:g&&n&&(S=fl.heightOnly);const{isResizing:x}=this.state;return(0,C.tZ)(b.e,{enable:S,grid:bl,minWidth:t?u*(r+m)-m:void 0,minHeight:n?p*i:void 0,maxWidth:t?Math.max(y.width,Math.min(ml,h*(r+m)-m)):void 0,maxHeight:n?Math.max(y.height,Math.min(ml,f*i)):void 0,size:y,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,handleComponent:hl,className:v()("resizable-container",x&&"resizable-container--resizing"),handleClasses:yl},e)}}Cl.propTypes=gl,Cl.defaultProps=vl;const Sl=Cl,xl={id:d().string.isRequired,parentId:d().string.isRequired,dashboardId:d().number.isRequired,component:J.cP.isRequired,parentComponent:J.cP.isRequired,getComponentById:d().func.isRequired,index:d().number.isRequired,depth:d().number.isRequired,editMode:d().bool.isRequired,directPathToChild:d().arrayOf(d().string),directPathLastUpdated:d().number,focusedFilterScope:d().object,fullSizeChartId:d().oneOf([d().number,null]),availableColumnCount:d().number.isRequired,columnWidth:d().number.isRequired,onResizeStart:d().func.isRequired,onResize:d().func.isRequired,onResizeStop:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired,handleComponentDrop:d().func.isRequired,setFullSizeChartId:d().func.isRequired,postAddSliceFromDashboard:d().func},wl=s.forwardRef(((e,t)=>{var n;let{chartId:r,...o}=e;const s=(0,y.Fg)(),l=(0,i.v9)((e=>e.nativeFilters)),d=function(e,t){if(!e.focusedFilterField)return null;const{chartId:n,column:r}=e.focusedFilterField;return{chartId:n,scope:t[n].scopes[r]}}((0,i.v9)((e=>e.dashboardState)),(0,i.v9)((e=>e.dashboardFilters))),c=l.focusedFilterId;if(!d&&!c)return(0,C.tZ)("div",ee()({ref:t},o));const u={borderColor:s.colors.primary.light2,opacity:1,boxShadow:`0px 0px ${2*s.gridUnit}px ${s.colors.primary.base}`,pointerEvents:"auto"};var h,p;if(c){if(null!=(h=l.filters[c])&&null!=(p=h.chartsInScope)&&a()(p).call(p,r))return(0,C.tZ)("div",ee()({ref:t,style:u},o))}else if(r===d.chartId||a()(n=(0,bn.up)({filterScope:d.scope})).call(n,r))return(0,C.tZ)("div",ee()({ref:t,style:u},o));return(0,C.tZ)("div",ee()({ref:t,style:{opacity:.3,pointerEvents:"none"}},o))}));class kl extends s.Component{static renderInFocusCSS(e){return(0,C.tZ)("style",null,`label[for=${e}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n           }`)}static getDerivedStateFromProps(e,t){const{component:n,directPathToChild:r,directPathLastUpdated:i}=e,{label:o,chart:s}=function(e){const t={};if(e.length>0){const n=e.slice();for(;n.length;){const e=n.pop(),r=e.split("-")[0];if(t[r.toLowerCase()]=e,!a()(Y.Ep).call(Y.Ep,r))break}}return t}(r);return i!==t.directPathLastUpdated&&n.id===s?{outlinedComponentId:n.id,outlinedColumnName:o,directPathLastUpdated:i}:null}constructor(e){super(e),this.state={isFocused:!1,outlinedComponentId:null,outlinedColumnName:null,directPathLastUpdated:0,extraControls:{}},this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateSliceName=this.handleUpdateSliceName.bind(this),this.handleToggleFullSize=this.handleToggleFullSize.bind(this),this.handleExtraControl=this.handleExtraControl.bind(this),this.handlePostTransformProps=this.handlePostTransformProps.bind(this)}componentDidMount(){this.hideOutline({},this.state)}componentDidUpdate(e,t){this.hideOutline(t,this.state)}hideOutline(e,t){const{outlinedComponentId:n}=t,{outlinedComponentId:r}=e;n&&!r&&setTimeout((()=>{this.setState((()=>({outlinedComponentId:null,outlinedColumnName:null})))}),2e3)}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleUpdateSliceName(e){const{component:t,updateComponents:n}=this.props;n({[t.id]:{...t,meta:{...t.meta,sliceNameOverride:e}}})}handleToggleFullSize(){const{component:e,fullSizeChartId:t,setFullSizeChartId:n}=this.props,{chartId:r}=e.meta;n(t===r?null:r)}handleExtraControl(e,t){this.setState((n=>({extraControls:{...n.extraControls,[e]:t}})))}handlePostTransformProps(e){return this.props.postAddSliceFromDashboard(),e}render(){var e,t,n;const{isFocused:r,extraControls:i}=this.state,{component:o,parentComponent:a,index:s,depth:l,availableColumnCount:d,columnWidth:c,onResizeStart:u,onResize:h,onResizeStop:p,handleComponentDrop:m,editMode:g,isComponentVisible:b,dashboardId:y,fullSizeChartId:S,getComponentById:x=(()=>{})}=this.props,{chartId:w}=o.meta,k=S===w,Z=null==(e=x(null==(n=a.parents)?void 0:n.find((e=>e.startsWith(f.BA)))))||null==(t=e.meta)?void 0:t.width;let R=o.meta.width||Y.cx;a.type===f.BA?R=a.meta.width||Y.cx:Z&&R>Z&&(R=Z);let T=0,F=0;return k?(T=window.innerWidth-32,F=window.innerHeight-32):(T=Math.floor(R*c+(R-1)*Y.es-32),F=Math.floor(o.meta.height*Y.cd-32)),(0,C.tZ)(je,{component:o,parentComponent:a,orientation:a.type===f.Os?"column":"row",index:s,depth:l,onDrop:m,disableDragDrop:r,editMode:g},(e=>{let{dropIndicatorProps:t,dragSourceRef:n}=e;return(0,C.tZ)(Sl,{id:o.id,adjustableWidth:a.type===f.Os,adjustableHeight:!0,widthStep:c,widthMultiple:R,heightStep:Y.cd,heightMultiple:o.meta.height,minWidthMultiple:Y.cx,minHeightMultiple:Y.AA,maxWidthMultiple:d+R,onResizeStart:u,onResize:h,onResizeStop:p,editMode:g},(0,C.tZ)(wl,{chartId:w,ref:n,className:v()("dashboard-component","dashboard-component-chart-holder",`dashboard-chart-id-${w}`,this.state.outlinedComponentId?"fade-in":"fade-out",k&&"full-size")},!g&&(0,C.tZ)(ll,{id:o.id,scrollIntoView:this.state.outlinedComponentId===o.id}),!!this.state.outlinedComponentId&&kl.renderInFocusCSS(this.state.outlinedColumnName),(0,C.tZ)(il,{componentId:o.id,id:o.meta.chartId,dashboardId:y,width:T,height:F,sliceName:o.meta.sliceNameOverride||o.meta.sliceName||"",updateSliceName:this.handleUpdateSliceName,isComponentVisible:b,handleToggleFullSize:this.handleToggleFullSize,isFullSize:k,setControlValue:this.handleExtraControl,extraControls:i,postTransformProps:this.handlePostTransformProps}),g&&(0,C.tZ)(ul,{position:"top"},(0,C.tZ)("div",null,(0,C.tZ)(dl,{onDelete:this.handleDeleteComponent})))),t&&(0,C.tZ)("div",t))}))}}kl.propTypes=xl,kl.defaultProps={directPathToChild:[],directPathLastUpdated:0};const Zl=(0,i.$j)((function(e){return{directPathToChild:e.dashboardState.directPathToChild,directPathLastUpdated:e.dashboardState.directPathLastUpdated}}))(kl);var Rl=n(78186);const Tl=(0,y.iK)(St.v.Item)`
  &.ant-menu-item {
    height: auto;
    line-height: 1.4;

    padding-top: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    padding-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;

    margin-top: 0;
    margin-bottom: 0;

    &:not(:last-child) {
      margin-bottom: 0;
    }

    &:hover {
      background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
    }

    &.active {
      font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
      background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    }
  }

  &.ant-menu-item-selected {
    color: unset;
  }
`;var Fl={name:"s5xdrg",styles:"display:flex;align-items:center"};const Dl=e=>{const{value:t,options:n,onChange:r,renderButton:i=(e=>e.label),renderOption:o=(e=>(0,C.tZ)("div",{className:e.className},e.label))}=e,a=(0,y.Fg)(),s=n.find((e=>e.value===t));return(0,C.tZ)(B.Gj,{trigger:["click"],overlayStyle:{zIndex:a.zIndex.max},overlay:(0,C.tZ)(St.v,{onClick:e=>{let{key:t}=e;return r(t)}},n.map((e=>(0,C.tZ)(Tl,{id:"menu-item",key:e.value,className:v()("dropdown-item",{active:e.value===t})},o(e)))))},(0,C.tZ)("div",{role:"button",css:Fl},s&&i(s),(0,C.tZ)(G.Z.CaretDown,{iconColor:a.colors.grayscale.base,css:(0,C.iv)({marginTop:.5*a.gridUnit},"","")})))},_l=[{value:"edit",label:(0,c.t)("Edit")},{value:"preview",label:(0,c.t)("Preview")}];class El extends s.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,C.tZ)(Dl,{id:e,options:_l,value:t,onChange:n})}}class Il extends s.PureComponent{constructor(e){super(e),this.container=void 0,this.state={isFocused:e.isFocused},this.setRef=this.setRef.bind(this),this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.editMode&&e.isFocused&&!this.state.isFocused?(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState({isFocused:!0})):this.state.isFocused&&!e.editMode&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState({isFocused:!1}))}componentWillUnmount(){document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick)}setRef(e){this.container=e}handleClick(e){if(!this.props.editMode)return;const{onChangeFocus:t,shouldFocus:n,disableClick:r}=this.props,i=n(e,this.container);r||!i||this.state.isFocused?!i&&this.state.isFocused&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!1}))),t&&t(!1)):(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!0}))),t&&t(!0))}render(){var e;const{children:t,menuItems:n,editMode:r,style:i}=this.props,{isFocused:o}=this.state;return(0,C.tZ)("div",{ref:this.setRef,onClick:this.handleClick,role:"none",className:v()("with-popover-menu",r&&o&&"with-popover-menu--focused"),style:i},t,r&&o&&(null!=(e=null==n?void 0:n.length)?e:0)>0&&(0,C.tZ)("div",{className:"popover-menu"},n.map(((e,t)=>(0,C.tZ)("div",{className:"menu-item",key:`menu-item-${t}`},e)))))}}Il.defaultProps={children:null,disableClick:!1,onChangeFocus:null,menuItems:[],isFocused:!1,shouldFocus:(e,t)=>{var n;return(null==t?void 0:t.contains(e.target))||"menu-item"===e.target.id||"menu-item"===(null==(n=e.target.parentNode)?void 0:n.id)},style:null};const Ml={id:d().string.isRequired,parentId:d().string.isRequired,component:J.cP.isRequired,parentComponent:J.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,editMode:d().bool.isRequired,logEvent:d().func.isRequired,addDangerToast:d().func.isRequired,undoLength:d().number.isRequired,redoLength:d().number.isRequired,availableColumnCount:d().number.isRequired,columnWidth:d().number.isRequired,onResizeStart:d().func.isRequired,onResize:d().func.isRequired,onResizeStop:d().func.isRequired,deleteComponent:d().func.isRequired,handleComponentDrop:d().func.isRequired,updateComponents:d().func.isRequired},Ol="# ✨Markdown\n## ✨Markdown\n### ✨Markdown\n\n<br />\n\nClick here to edit [markdown](https://bit.ly/1dQOfRK)",Pl=(0,c.t)("This markdown component has an error.");class Nl extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1,markdownSource:e.component.meta.code,editor:null,editorMode:"preview",undoLength:e.undoLength,redoLength:e.redoLength},this.renderStartTime=vt.Yd.getTimestamp(),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeEditorMode=this.handleChangeEditorMode.bind(this),this.handleMarkdownChange=this.handleMarkdownChange.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleResizeStart=this.handleResizeStart.bind(this),this.setEditor=this.setEditor.bind(this)}componentDidMount(){this.props.logEvent(vt.aD,{viz_type:"markdown",start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:vt.Yd.getTimestamp()-this.renderStartTime})}static getDerivedStateFromProps(e,t){const{hasError:n,editorMode:r,markdownSource:i,undoLength:o,redoLength:a}=t,{component:s,undoLength:l,redoLength:d}=e;return l!==o||d!==a?{...t,undoLength:l,redoLength:d,markdownSource:s.meta.code,hasError:!1}:n||"preview"!==r||s.meta.code===i?t:{...t,markdownSource:s.meta.code}}static getDerivedStateFromError(){return{hasError:!0}}componentDidUpdate(e){!this.state.editor||e.component.meta.width===this.props.component.meta.width&&e.columnWidth===this.props.columnWidth||this.state.editor.resize(!0),this.props.editMode&&Ft.cE.preload()}componentDidCatch(){this.state.editor&&"preview"===this.state.editorMode&&this.props.addDangerToast((0,c.t)("This markdown component has an error. Please revert your recent changes."))}setEditor(e){e.getSession().setUseWrapMode(!0),this.setState({editor:e})}handleChangeFocus(e){const t=!!e,n=t?"edit":"preview";this.setState((()=>({isFocused:t}))),this.handleChangeEditorMode(n)}handleChangeEditorMode(e){const t={...this.state,editorMode:e};"preview"===e&&(this.updateMarkdownContent(),t.hasError=!1),this.setState(t)}updateMarkdownContent(){const{updateComponents:e,component:t}=this.props;t.meta.code!==this.state.markdownSource&&e({[t.id]:{...t,meta:{...t.meta,code:this.state.markdownSource}}})}handleMarkdownChange(e){this.setState({markdownSource:e})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleResizeStart(e){const{editorMode:t}=this.state,{editMode:n,onResizeStart:r}=this.props,i="edit"===t;r(e),n&&i&&this.updateMarkdownContent()}renderEditMode(){return(0,C.tZ)(Ft.cE,{onChange:this.handleMarkdownChange,width:"100%",height:"100%",showGutter:!1,editorProps:{$blockScrolling:!0},value:"string"==typeof this.state.markdownSource?this.state.markdownSource:Ol,readOnly:!1,onLoad:this.setEditor})}renderPreviewMode(){const{hasError:e}=this.state;return(0,C.tZ)(Rl.Z,{source:e?Pl:this.state.markdownSource||Ol})}render(){const{isFocused:e,editorMode:t}=this.state,{component:n,parentComponent:r,index:i,depth:o,availableColumnCount:a,columnWidth:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u}=this.props,h=r.type===f.BA?r.meta.width||Y.cx:n.meta.width||Y.cx,p="edit"===t;return(0,C.tZ)(je,{component:n,parentComponent:r,orientation:r.type===f.Os?"column":"row",index:i,depth:o,onDrop:c,disableDragDrop:e,editMode:u},(t=>{let{dropIndicatorProps:i,dragSourceRef:o}=t;return(0,C.tZ)(Il,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,C.tZ)(El,{id:`${n.id}-mode`,value:this.state.editorMode,onChange:this.handleChangeEditorMode})],editMode:u},(0,C.tZ)("div",{className:v()("dashboard-markdown",p&&"dashboard-markdown--editing"),id:n.id},(0,C.tZ)(Sl,{id:n.id,adjustableWidth:r.type===f.Os,adjustableHeight:!0,widthStep:s,widthMultiple:h,heightStep:Y.cd,heightMultiple:n.meta.height,minWidthMultiple:Y.cx,minHeightMultiple:Y.AA,maxWidthMultiple:a+h,onResizeStart:this.handleResizeStart,onResize:l,onResizeStop:d,editMode:!e&&u},(0,C.tZ)("div",{ref:o,className:"dashboard-component dashboard-component-chart-holder"},u&&(0,C.tZ)(ul,{position:"top"},(0,C.tZ)(dl,{onDelete:this.handleDeleteComponent})),u&&p?this.renderEditMode():this.renderPreviewMode()))),i&&(0,C.tZ)("div",i))}))}}Nl.propTypes=Ml,Nl.defaultProps={};const jl=(0,i.$j)((function(e){return{undoLength:e.dashboardLayout.past.length,redoLength:e.dashboardLayout.future.length}}))(Nl),ql=y.iK.div`
  ${e=>{let{theme:t,position:n}=e;return C.iv`
    height: ${5*t.gridUnit}px;
    overflow: hidden;
    cursor: move;
    ${"top"===n&&C.iv`
      transform: rotate(90deg);
    `}
    & path {
      fill: ${t.colors.grayscale.base};
    }
  `}}
`;function $l(e){let{position:t="left",innerRef:n=null}=e;return(0,C.tZ)(ql,{ref:n,position:t},(0,C.tZ)(G.Z.Drag,null))}var zl=n(713);function Al(e){return(0,C.tZ)("div",{className:v()("background-style-option",e.className)},`${e.label} background`)}function Ul(e){return(0,C.tZ)("div",{className:v()("background-style-option",e.className)},e.label)}class Ll extends s.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,C.tZ)(Dl,{id:e,options:zl.Z,value:t,onChange:n,renderButton:Al,renderOption:Ul})}}const Vl={id:d().string.isRequired,parentId:d().string.isRequired,component:J.cP.isRequired,parentComponent:J.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,editMode:d().bool.isRequired,availableColumnCount:d().number.isRequired,columnWidth:d().number.isRequired,minColumnWidth:d().number.isRequired,onResizeStart:d().func.isRequired,onResize:d().func.isRequired,onResizeStop:d().func.isRequired,deleteComponent:d().func.isRequired,handleComponentDrop:d().func.isRequired,updateComponents:d().func.isRequired};class Kl extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:r,columnWidth:i,minColumnWidth:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],m=zl.Z.find((t=>t.value===(e.meta.background||Y.HE)));return(0,C.tZ)(je,{component:e,parentComponent:t,orientation:"column",index:n,depth:a,onDrop:c,editMode:u},(t=>{let{dropIndicatorProps:n,dragSourceRef:c}=t;return(0,C.tZ)(Sl,{id:e.id,adjustableWidth:!0,adjustableHeight:!1,widthStep:i,widthMultiple:e.meta.width,minWidthMultiple:o,maxWidthMultiple:r+(e.meta.width||0),onResizeStart:s,onResize:l,onResizeStop:d,editMode:u},(0,C.tZ)(Il,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,C.tZ)(Ll,{id:`${e.id}-background`,value:e.meta.background,onChange:this.handleChangeBackground})],editMode:u},u&&(0,C.tZ)(ul,{innerRef:c,position:"top"},(0,C.tZ)($l,{position:"top"}),(0,C.tZ)(dl,{onDelete:this.handleDeleteComponent}),(0,C.tZ)(Ur,{onClick:this.handleChangeFocus,icon:(0,C.tZ)(G.Z.Cog,{iconSize:"xl"})})),(0,C.tZ)("div",{className:v()("grid-column",0===f.length&&"grid-column--empty",m.className)},f.map(((t,n)=>(0,C.tZ)(Zd,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:e.meta.width,columnWidth:i,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),n&&(0,C.tZ)("div",n))))}))}}Kl.propTypes=Vl,Kl.defaultProps={};const Wl=Kl,Bl={id:d().string.isRequired,parentId:d().string.isRequired,component:J.cP.isRequired,depth:d().number.isRequired,parentComponent:J.cP.isRequired,index:d().number.isRequired,editMode:d().bool.isRequired,handleComponentDrop:d().func.isRequired,deleteComponent:d().func.isRequired};class Hl extends s.PureComponent{constructor(e){super(e),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{component:e,depth:t,parentComponent:n,index:r,handleComponentDrop:i,editMode:o}=this.props;return(0,C.tZ)(je,{component:e,parentComponent:n,orientation:"row",index:r,depth:t,onDrop:i,editMode:o},(e=>{let{dropIndicatorProps:t,dragSourceRef:n}=e;return(0,C.tZ)("div",{ref:n},o&&(0,C.tZ)(ul,{position:"left"},(0,C.tZ)(dl,{onDelete:this.handleDeleteComponent})),(0,C.tZ)("div",{className:"dashboard-component dashboard-component-divider"}),t&&(0,C.tZ)("div",t))}))}}Hl.propTypes=Bl;const Gl=Hl;var Yl=n(79271);const Jl={id:d().string.isRequired,dashboardId:d().string.isRequired,parentId:d().string.isRequired,component:J.cP.isRequired,depth:d().number.isRequired,parentComponent:J.cP.isRequired,index:d().number.isRequired,editMode:d().bool.isRequired,handleComponentDrop:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired};class Ql extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeSize=this.handleUpdateMeta.bind(this,"headerSize"),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeText=this.handleUpdateMeta.bind(this,"text")}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{isFocused:e}=this.state,{dashboardId:t,component:n,depth:r,parentComponent:i,index:o,handleComponentDrop:a,editMode:s}=this.props,l=Yl.Z.find((e=>e.value===(n.meta.headerSize||Y.u_))),d=zl.Z.find((e=>e.value===(n.meta.background||Y.HE)));return(0,C.tZ)(je,{component:n,parentComponent:i,orientation:"row",index:o,depth:r,onDrop:a,disableDragDrop:e,editMode:s},(e=>{let{dropIndicatorProps:i,dragSourceRef:o}=e;return(0,C.tZ)("div",{ref:o},s&&r<=2&&(0,C.tZ)(ul,{position:"left"},(0,C.tZ)($l,{position:"left"})),(0,C.tZ)(Il,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,C.tZ)(Dl,{id:`${n.id}-header-style`,options:Yl.Z,value:n.meta.headerSize,onChange:this.handleChangeSize}),(0,C.tZ)(Ll,{id:`${n.id}-background`,value:n.meta.background,onChange:this.handleChangeBackground})],editMode:s},(0,C.tZ)("div",{className:v()("dashboard-component","dashboard-component-header",l.className,d.className)},s&&(0,C.tZ)(ul,{position:"top"},(0,C.tZ)(dl,{onDelete:this.handleDeleteComponent})),(0,C.tZ)(ei.Z,{title:n.meta.text,canEdit:s,onSaveTitle:this.handleChangeText,showTooltip:!1}),!s&&(0,C.tZ)(ll,{id:n.id,dashboardId:t}))),i&&(0,C.tZ)("div",i))}))}}Ql.propTypes=Jl,Ql.defaultProps={};const Xl=Ql,ed={id:d().string.isRequired,parentId:d().string.isRequired,component:J.cP.isRequired,parentComponent:J.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,editMode:d().bool.isRequired,availableColumnCount:d().number.isRequired,columnWidth:d().number.isRequired,occupiedColumnCount:d().number.isRequired,onResizeStart:d().func.isRequired,onResize:d().func.isRequired,onResizeStop:d().func.isRequired,handleComponentDrop:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired};class td extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,component:t,parentId:n}=this.props;e(t.id,n)}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:r,columnWidth:i,occupiedColumnCount:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],m=zl.Z.find((t=>t.value===(e.meta.background||Y.HE)));return(0,C.tZ)(je,{component:e,parentComponent:t,orientation:"row",index:n,depth:a,onDrop:c,editMode:u},(t=>{let{dropIndicatorProps:n,dragSourceRef:c}=t;return(0,C.tZ)(Il,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,C.tZ)(Ll,{id:`${e.id}-background`,value:m.value,onChange:this.handleChangeBackground})],editMode:u},u&&(0,C.tZ)(ul,{innerRef:c,position:"left"},(0,C.tZ)($l,{position:"left"}),(0,C.tZ)(dl,{onDelete:this.handleDeleteComponent}),(0,C.tZ)(Ur,{onClick:this.handleChangeFocus,icon:(0,C.tZ)(G.Z.Cog,{iconSize:"xl"})})),(0,C.tZ)("div",{className:v()("grid-row",0===f.length&&"grid-row--empty",m.className)},f.map(((t,n)=>(0,C.tZ)(Zd,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:r-o,columnWidth:i,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),n&&(0,C.tZ)("div",n)))}))}}td.propTypes=ed;const nd=td;var rd=n(94301);const id="RENDER_TAB",od="RENDER_TAB_CONTENT",ad={dashboardId:d().number.isRequired,id:d().string.isRequired,parentId:d().string.isRequired,component:J.cP.isRequired,parentComponent:J.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,renderType:d().oneOf([id,od]).isRequired,onDropOnTab:d().func,editMode:d().bool.isRequired,canEdit:d().bool.isRequired,availableColumnCount:d().number,columnWidth:d().number,onResizeStart:d().func,onResize:d().func,onResizeStop:d().func,handleComponentDrop:d().func.isRequired,updateComponents:d().func.isRequired,setDirectPathToChild:d().func.isRequired,setEditMode:d().func.isRequired},sd={availableColumnCount:0,columnWidth:0,onDropOnTab(){},onResizeStart(){},onResize(){},onResizeStop(){}},ld=y.iK.div`
  ${e=>{let{isHighlighted:t,theme:{gridUnit:n,colors:r}}=e;return`\n    padding: ${n}px ${2*n}px;\n    margin: ${-n}px ${-2*n}px;\n    transition: box-shadow 0.2s ease-in-out;\n    ${t&&`box-shadow: 0 0 ${n}px ${r.primary.light1};`}\n  `}}
`,dd=e=>e.dropIndicatorProps&&(0,C.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),cd=e=>e.dropIndicatorProps&&(0,C.tZ)("div",{className:"drop-indicator drop-indicator--top"});class ud extends s.PureComponent{constructor(e){super(e),this.handleChangeText=this.handleChangeText.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}handleChangeTab(e){let{pathToTabIndex:t}=e;this.props.setDirectPathToChild(t)}handleChangeText(e){const{updateComponents:t,component:n}=this.props;e&&e!==n.meta.text&&t({[n.id]:{...n,meta:{...n.meta,text:e}}})}handleDrop(e){this.props.handleComponentDrop(e),this.props.onDropOnTab(e)}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}renderTabContent(){const{component:e,parentComponent:t,depth:n,availableColumnCount:r,columnWidth:i,onResizeStart:o,onResize:a,onResizeStop:s,editMode:l,isComponentVisible:d,canEdit:u,setEditMode:h,dashboardId:p}=this.props,f=0===e.children.length;return(0,C.tZ)("div",{className:"dashboard-component-tabs-content"},l&&(0,C.tZ)(je,{component:e,parentComponent:t,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget"},cd),f&&(0,C.tZ)(rd.x3,{title:l?(0,c.t)("Drag and drop components to this tab"):(0,c.t)("There are no components added to this tab"),description:u&&(l?(0,C.tZ)("span",null,(0,c.t)("You can")," ",(0,C.tZ)("a",{href:`/chart/add?dashboard_id=${p}`,rel:"noopener noreferrer",target:"_blank"},(0,c.t)("create a new chart"))," ",(0,c.t)("or use existing ones from the panel on the right")):(0,C.tZ)("span",null,(0,c.t)("You can add the components in the")," ",(0,C.tZ)("span",{role:"button",tabIndex:0,onClick:()=>h(!0)},(0,c.t)("edit mode")))),image:"chart.svg"}),e.children.map(((t,l)=>(0,C.tZ)(Zd,{key:t,id:t,parentId:e.id,depth:n,index:l,onDrop:this.handleDrop,availableColumnCount:r,columnWidth:i,onResizeStart:o,onResize:a,onResizeStop:s,isComponentVisible:d,onChangeTab:this.handleChangeTab}))),l&&(0,C.tZ)(je,{component:e,parentComponent:t,orientation:"column",index:e.children.length,depth:n,onDrop:this.handleDrop,editMode:!0,className:"empty-droptarget"},dd))}renderTab(){const{component:e,parentComponent:t,index:n,depth:r,editMode:i,isFocused:o,isHighlighted:a}=this.props;return(0,C.tZ)(je,{component:e,parentComponent:t,orientation:"column",index:n,depth:r,onDrop:this.handleDrop,editMode:i},(t=>{let{dropIndicatorProps:r,dragSourceRef:s}=t;return(0,C.tZ)(ld,{isHighlighted:a,className:"dragdroppable-tab",ref:s},(0,C.tZ)(ei.Z,{title:e.meta.text,defaultTitle:e.meta.defaultText,placeholder:e.meta.placeholder,canEdit:i&&o,onSaveTitle:this.handleChangeText,showTooltip:!1,editing:i&&o}),!i&&(0,C.tZ)(ll,{id:e.id,dashboardId:this.props.dashboardId,placement:n>=5?"left":"right"}),r&&(0,C.tZ)("div",r))}))}render(){const{renderType:e}=this.props;return e===id?this.renderTab():this.renderTabContent()}}ud.propTypes=ad,ud.defaultProps=sd;const hd=(0,i.$j)((function(e){return{canEdit:e.dashboardInfo.dash_edit_perm}}),(function(e){return(0,r.DE)({setEditMode:Gt.Mb},e)}))(ud);function pd(e){let{currentComponent:t,directPathToChild:n=[]}=e;if(!t||0===n.length||-1===n.indexOf(t.id))return-1;const r=n.findIndex((e=>e===t.id)),i=n[r+1];return t.children.indexOf(i)>=0?t.children.findIndex((e=>e===i)):-1}function fd(e,t){const n=(e.parents||[]).slice();return n.push(e.id),n.push(e.children[t]),n}function md(e){if(void 0===e&&(e=[]),e.length>0){const t=e.slice();for(;t.length;){const e=t.pop(),n=e&&e.split("-")[0];if(!a()(Y.Ep).call(Y.Ep,n))return e}}return null}const gd={id:d().string.isRequired,parentId:d().string.isRequired,component:J.cP.isRequired,parentComponent:J.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,renderTabContent:d().bool,editMode:d().bool.isRequired,renderHoverMenu:d().bool,directPathToChild:d().arrayOf(d().string),activeTabs:d().arrayOf(d().string),filterboxMigrationState:Q.Qi,logEvent:d().func.isRequired,setActiveTabs:d().func,availableColumnCount:d().number,columnWidth:d().number,onResizeStart:d().func,onResize:d().func,onResizeStop:d().func,createComponent:d().func.isRequired,handleComponentDrop:d().func.isRequired,onChangeTab:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired},vd={renderTabContent:!0,renderHoverMenu:!0,availableColumnCount:0,columnWidth:0,activeTabs:[],directPathToChild:[],filterboxMigrationState:Q.Qi.NOOP,setActiveTabs(){},onResizeStart(){},onResize(){},onResizeStop(){}},bd=y.iK.div`
  width: 100%;
  background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};

  .dashboard-component-tabs-content {
    min-height: ${e=>{let{theme:t}=e;return 12*t.gridUnit}}px;
    margin-top: ${e=>{let{theme:t}=e;return t.gridUnit/4}}px;
    position: relative;
  }

  .ant-tabs {
    overflow: visible;

    .ant-tabs-nav-wrap {
      min-height: ${e=>{let{theme:t}=e;return 12.5*t.gridUnit}}px;
    }

    .ant-tabs-content-holder {
      overflow: visible;
    }
  }

  div .ant-tabs-tab-btn {
    text-transform: none;
  }
`;class yd extends s.PureComponent{constructor(e){var t;super(e),this.showDeleteConfirmModal=e=>{const{component:t,deleteComponent:n}=this.props;B.xT.confirm({title:(0,c.t)("Delete dashboard tab?"),content:(0,C.tZ)("span",null,"Deleting a tab will remove all content within it. You may still reverse this action with the ",(0,C.tZ)("b",null,"undo")," button (cmd + z) until you save your changes."),onOk:()=>{n(e,t.id);const r=t.children.indexOf(e);this.handleDeleteTab(r)},okType:"danger",okText:"DELETE",cancelText:"CANCEL",icon:null})},this.handleEdit=(e,t)=>{const{component:n,createComponent:r}=this.props;"add"===t?(null==e||null==e.stopPropagation||e.stopPropagation(),r({destination:{id:n.id,type:n.type,index:n.children.length},dragging:{id:Y.Xk,type:f.gn}})):"remove"===t&&this.showDeleteConfirmModal(e)};let n=Math.max(0,pd({currentComponent:e.component,directPathToChild:e.directPathToChild}));0===n&&null!=(t=e.activeTabs)&&t.length&&e.component.children.forEach(((t,r)=>{var i;0===n&&a()(i=e.activeTabs).call(i,t)&&(n=r)}));const{children:r}=e.component,i=r[n];this.state={tabIndex:n,activeKey:i},this.handleClickTab=this.handleClickTab.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleDeleteTab=this.handleDeleteTab.bind(this),this.handleDropOnTab=this.handleDropOnTab.bind(this),this.handleDrop=this.handleDrop.bind(this)}componentDidMount(){this.props.setActiveTabs(this.state.activeKey)}componentDidUpdate(e,t){t.activeKey===this.state.activeKey&&e.filterboxMigrationState===this.props.filterboxMigrationState||this.props.setActiveTabs(this.state.activeKey,t.activeKey)}UNSAFE_componentWillReceiveProps(e){const t=Math.max(0,e.component.children.length-1),n=this.props.component.children,r=e.component.children;if(this.state.tabIndex>t&&this.setState((()=>({tabIndex:t}))),e.isComponentVisible){const t=md(e.directPathToChild),i=md(this.props.directPathToChild);if(t!==i||t===i&&n!==r){const t=pd({currentComponent:e.component,directPathToChild:e.directPathToChild});t>-1&&t!==this.state.tabIndex&&this.setState((()=>({tabIndex:t,activeKey:r[t]})))}}}handleClickTab(e){const{component:t}=this.props,{children:n}=t;if(e!==this.state.tabIndex){const n=fd(t,e),r=n[n.length-1];this.props.logEvent(vt.Iq,{target_id:r,index:e}),this.props.onChangeTab({pathToTabIndex:n})}this.setState((()=>({activeKey:n[e]})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleDeleteTab(e){this.state.tabIndex===e&&this.handleClickTab(Math.max(0,e-1))}handleDropOnTab(e){const{component:t}=this.props,{destination:n}=e;if(n){const e=n.id===t.id?n.index:t.children.indexOf(n.id);e>-1&&setTimeout((()=>{this.handleClickTab(e)}),30)}}handleDrop(e){e.dragging.type!==f.yR&&this.props.handleComponentDrop(e)}render(){const{depth:e,component:t,parentComponent:n,index:r,availableColumnCount:i,columnWidth:o,onResizeStart:s,onResize:l,onResizeStop:d,renderTabContent:c,renderHoverMenu:u,isComponentVisible:h,editMode:p,nativeFilters:f}=this.props,{children:m}=t,{tabIndex:g,activeKey:v}=this.state;let b;return null!=f&&f.focusedFilterId&&(b=f.filters[f.focusedFilterId].tabsInScope),(0,C.tZ)(je,{component:t,parentComponent:n,orientation:"row",index:r,depth:e,onDrop:this.handleDrop,editMode:p},(r=>{let{dropIndicatorProps:f,dragSourceRef:y}=r;return(0,C.tZ)(bd,{className:"dashboard-component dashboard-component-tabs"},p&&u&&(0,C.tZ)(ul,{innerRef:y,position:"left"},(0,C.tZ)($l,{position:"left"}),(0,C.tZ)(dl,{onDelete:this.handleDeleteComponent})),(0,C.tZ)(x.cl,{id:t.id,activeKey:v,onChange:e=>{this.handleClickTab(m.indexOf(e))},onEdit:this.handleEdit,type:p?"editable-card":"card"},m.map(((n,r)=>{var u;return(0,C.tZ)(x.cl.TabPane,{key:n,tab:(0,C.tZ)(Zd,{id:n,parentId:t.id,depth:e,index:r,renderType:id,availableColumnCount:i,columnWidth:o,onDropOnTab:this.handleDropOnTab,isFocused:v===n,isHighlighted:v!==n&&(null==(u=b)?void 0:a()(u).call(u,n))})},c&&(0,C.tZ)(Zd,{id:n,parentId:t.id,depth:e,index:r,renderType:od,availableColumnCount:i,columnWidth:o,onResizeStart:s,onResize:l,onResizeStop:d,onDropOnTab:this.handleDropOnTab,isComponentVisible:g===r&&h}))}))),f&&n.id!==Y._4&&(0,C.tZ)("div",f))}))}}yd.propTypes=gd,yd.defaultProps=vd;const Cd=(0,i.$j)((function(e){return{nativeFilters:e.nativeFilters,activeTabs:e.dashboardState.activeTabs,directPathToChild:e.dashboardState.directPathToChild,filterboxMigrationState:e.dashboardState.filterboxMigrationState}}))(yd),Sd={[f.dW]:Zl,[f.xh]:jl,[f.BA]:Wl,[f.hE]:Gl,[f.Nc]:Xl,[f.Os]:nd,[f.gn]:hd,[f.yR]:Cd,[f.t]:e=>{let{component:t,parentComponent:n,index:r,depth:o,handleComponentDrop:a,editMode:l,columnWidth:d,availableColumnCount:u,onResizeStart:h,onResizeStop:p,onResize:m,deleteComponent:g,parentId:b,updateComponents:y,id:S}=e;const x=n.type===f.BA?n.meta.width||Y.cx:t.meta.width||Y.cx,w=()=>{g(S,b)},k=zl.Z.find((e=>e.value===(t.meta.background||Y.HE))),{Component:Z}=Qe.get(t.meta.componentKey),R=(0,i.v9)((e=>{let{nativeFilters:t,dataMask:n}=e;return{nativeFilters:t,dataMask:n}}));return(0,C.tZ)(je,{component:t,parentComponent:n,orientation:n.type===f.Os?"column":"row",index:r,depth:o,onDrop:a,editMode:l},(e=>{let{dropIndicatorProps:r,dragSourceRef:i}=e;return(0,C.tZ)(Il,{menuItems:[(0,C.tZ)(Ll,{id:`${t.id}-background`,value:t.meta.background,onChange:e=>{return"background",n=e,void y({[t.id]:{...t,meta:{...t.meta,background:n}}});var n}})],editMode:l},(0,C.tZ)("div",{className:v()("dashboard-component",`dashboard-${t.componentKey}`,null==k?void 0:k.className),id:t.id},(0,C.tZ)(Sl,{id:t.id,adjustableWidth:n.type===f.Os,widthStep:d,widthMultiple:x,heightStep:Y.cd,adjustableHeight:!1,heightMultiple:t.meta.height,minWidthMultiple:Y.cx,minHeightMultiple:Y.cx,maxWidthMultiple:u+x,onResizeStart:h,onResize:m,onResizeStop:p},(0,C.tZ)("div",{ref:i,className:"dashboard-component"},l&&(0,C.tZ)(ul,{position:"top"},(0,C.tZ)(dl,{onDelete:w})),(0,C.tZ)(s.Suspense,{fallback:(0,C.tZ)("div",null,(0,c.t)("Loading..."))},(0,C.tZ)(Z,{dashboardData:R}))))),r&&(0,C.tZ)("div",r))}))}};var xd=n(72673);const wd={id:d().string,parentId:d().string,depth:d().number,index:d().number,renderHoverMenu:d().bool,renderTabContent:d().bool,onChangeTab:d().func,component:J.cP.isRequired,parentComponent:J.cP.isRequired,createComponent:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired,handleComponentDrop:d().func.isRequired,logEvent:d().func.isRequired,directPathToChild:d().arrayOf(d().string),directPathLastUpdated:d().number,dashboardId:d().number.isRequired,isComponentVisible:d().bool};class kd extends s.PureComponent{render(){const{component:e}=this.props,t=e?Sd[e.type]:null;return t?(0,C.tZ)(t,this.props):null}}kd.propTypes=wd,kd.defaultProps={isComponentVisible:!0};const Zd=(0,i.$j)((function(e,t){let{dashboardLayout:n,dashboardState:r,dashboardInfo:i}=e;const o=n.present,{id:a,parentId:s}=t,l=o[a],d={component:l,getComponentById:e=>o[e],parentComponent:o[s],editMode:r.editMode,filters:(0,bn.De)(),dashboardId:i.id,fullSizeChartId:r.fullSizeChartId};if(l){const e=l.type;if(e===f.Os||e===f.BA){const{occupiedWidth:t,minimumWidth:n}=(0,xd.Z)({id:a,components:o});e===f.Os&&(d.occupiedColumnCount=t),e===f.BA&&(d.minColumnWidth=n)}}return d}),(function(e){return(0,r.DE)({addDangerToast:Nr.Gb,createComponent:Pr.LM,deleteComponent:Pr.v7,updateComponents:Pr.WZ,handleComponentDrop:Pr._p,setDirectPathToChild:Gt.E2,setFullSizeChartId:Gt.zL,setActiveTabs:Gt.$_,logEvent:jr.logEvent,postAddSliceFromDashboard:Gt.Cd},e)}))(kd);var Rd,Td=n(90057),Fd=n(8868),Dd=n(6954);!function(e){e.AllFilters="allFilters",e.FilterSets="filterSets"}(Rd||(Rd={}));const _d=e=>Object.values(e).reduce(((e,t)=>({...e,[t.id]:t.extraFormData})),{}),Ed=(e,t)=>{var n;const r=null==t?void 0:t.value;return(null==(n=e.controlValues)?void 0:n.enableEmptyFilter)&&null==r};var Id=n(52794),Md=n(24350),Od=n.n(Md),Pd=n(63105),Nd=n.n(Pd);const jd=()=>(0,i.v9)((e=>e.nativeFilters.filterSets||{})),qd=()=>{const e=(0,i.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.preselectNativeFilters})),t=(0,i.v9)((e=>e.nativeFilters.filters));return(0,s.useMemo)((()=>Object.entries(t).reduce(((t,n)=>{let[r,i]=n;return{...t,[r]:{...i,preselect:null==e?void 0:e[r]}}}),{})),[t,e])},$d=()=>{const e=(0,i.v9)((e=>e.dataMask));return(0,s.useMemo)((()=>Object.values(e).filter((e=>String(e.id).startsWith(ka.rW))).reduce(((e,t)=>({...e,[t.id]:t})),{})),[e])},zd=(e,t)=>{const n=jd(),r=Object.values(n),i=(0,s.useMemo)((()=>!!r.find((t=>{let{name:n}=t;return n===e}))),[r,e]);return t!==e&&i},Ad=y.iK.div`
  display: flex;
  & button {
    ${e=>{let{disabled:t}=e;return"pointer-events: "+(t?"none":"all")}};
    flex: 1;
  }
`,Ud=y.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
`,Ld=e=>{let{onCancel:t,editMode:n,onEdit:r,onCreate:i,disabled:o,filterSetName:a}=e;const l=zd(a),d=!a||l||o;return(0,C.tZ)(s.Fragment,null,n?(0,C.tZ)(Ud,null,(0,C.tZ)(H.Z,{buttonStyle:"tertiary",buttonSize:"small",onClick:t},(0,c.t)("Cancel")),(0,C.tZ)(ne.u,{placement:"right",title:!a&&(0,c.t)("Please filter set name")||l&&(0,c.t)("Filter set with this name already exists")||o&&ws},(0,C.tZ)(Ad,{disabled:d},(0,C.tZ)(H.Z,ee()({disabled:d,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:i},wu("create-filter-set-button")),(0,c.t)("Create"))))):(0,C.tZ)(ne.u,{placement:"bottom",title:o&&ws},(0,C.tZ)(Ad,{disabled:o},(0,C.tZ)(H.Z,ee()({disabled:o,buttonStyle:"tertiary",buttonSize:"small",onClick:r},wu("new-filter-set-button")),(0,c.t)("Create new filter set")))))},Vd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};var Kd=function(e,t){return s.createElement(rs.Z,Object.assign({},e,{ref:t,icon:Vd}))};Kd.displayName="CheckOutlined";const Wd=s.forwardRef(Kd),Bd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"ellipsis",theme:"outlined"};var Hd=function(e,t){return s.createElement(rs.Z,Object.assign({},e,{ref:t,icon:Bd}))};Hd.displayName="EllipsisOutlined";const Gd=s.forwardRef(Hd),Yd=y.iK.div`
  display: flex;
  align-items: center;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
`,Jd=(0,y.iK)(B.Ol)`
  &.ant-collapse-ghost > .ant-collapse-item {
    & > .ant-collapse-content > .ant-collapse-content-box {
      padding: 0;
      padding-top: 0;
      padding-bottom: 0;
      font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
    }
    & > .ant-collapse-header {
      padding: 0;
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      justify-content: flex-end;
      max-width: max-content;
      & .ant-collapse-arrow {
        position: static;
        padding-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
      }
  }
`,Qd=y.iK.div`
  padding-top: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  padding-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,Xd=e=>{let{dataMask:t,filterSet:n}=e;const r=(0,y.Fg)(),i=qd(),o=Object.values(i).filter(Pi.kI);let s=null!=o?o:[];return null!=n&&n.nativeFilters&&(s=Object.values(null==n?void 0:n.nativeFilters).filter(Pi.kI)),(0,C.tZ)(Jd,{ghost:!0,expandIconPosition:"right",defaultActiveKey:n?void 0:["filters"],expandIcon:e=>{let{isActive:t}=e;const n=r.colors.grayscale.base,i=t?G.Z.CaretUpOutlined:G.Z.CaretDownOutlined;return(0,C.tZ)(i,{iconColor:n})}},(0,C.tZ)(B.Ol.Panel,ee()({},wu("collapse-filter-set-description"),{header:(0,C.tZ)(Yd,null,(0,C.tZ)(B.ZT.Text,{type:"secondary"},(0,c.t)("Filters (%d)",s.length))),key:"filters"}),s.map((e=>{var r,o,s,l,d,u;let{id:h,name:p}=e;const f=n&&!(0,Jr.JB)(null==(r=i[h])?void 0:r.controlValues,null==n||null==(o=n.nativeFilters)||null==(s=o[h])?void 0:s.controlValues,{ignoreUndefined:!0}),m=!a()(l=Object.keys(i)).call(l,h);return(0,C.tZ)(B._e,{title:m&&(0,c.t)("This filter doesn't exist in dashboard. It will not be applied.")||f&&(0,c.t)("Filter metadata changed in dashboard. It will not be applied."),placement:"bottomLeft",key:h},(0,C.tZ)(Qd,null,(0,C.tZ)(B.ZT.Text,{strong:!0,delete:m,mark:f},p,": "),(0,C.tZ)(B.ZT.Text,{delete:m,mark:f},ks(null==t||null==(d=t[h])||null==(u=d.filterState)?void 0:u.value)||(0,C.tZ)(B.ZT.Text,{type:"secondary"},(0,c.t)("None")))))}))))},ec=(0,y.iK)(H.Z)`
  padding: 0;
`,tc=y.iK.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,nc=y.iK.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  & > *,
  & > button.superset-button {
    ${e=>{let{theme:t}=e;return`margin-left: ${2*t.gridUnit}px`}};
  }
`,rc=e=>{var t,n;let{editMode:r,setFilterSetName:i,onDelete:o,onEdit:a,filterSetName:l,dataMaskSelected:d,filterSet:u,isApplied:h,onRebuild:p}=e;const f=(0,y.Fg)(),m=(0,C.tZ)(St.v,null,(0,C.tZ)(St.v.Item,{onClick:a},(0,c.t)("Edit")),(0,C.tZ)(St.v.Item,{onClick:p},(0,C.tZ)(ne.u,{placement:"right",title:(0,c.t)("Remove invalid filters")},(0,c.t)("Rebuild"))),(0,C.tZ)(St.v.Item,{onClick:o,danger:!0},(0,c.t)("Delete")));return(0,C.tZ)(s.Fragment,null,(0,C.tZ)(tc,null,(0,C.tZ)(B.ZT.Text,{strong:!0,editable:{editing:r,icon:(0,C.tZ)("span",null),onChange:i}},null!=(t=null==u?void 0:u.name)?t:l),(0,C.tZ)(nc,null,h&&(0,C.tZ)(Wd,{style:{color:f.colors.success.base}}),o&&(0,C.tZ)(B.Gj,{overlay:m,placement:"bottomRight",trigger:["click"]},(0,C.tZ)(ec,ee()({onClick:e=>{e.stopPropagation(),e.preventDefault()}},wu("filter-set-menu-button"),{buttonStyle:"link",buttonSize:"xsmall"}),(0,C.tZ)(Gd,null))))),(0,C.tZ)(Xd,{filterSet:u,dataMask:null!=(n=null==u?void 0:u.dataMask)?n:d}))},ic=y.iK.div`
  display: grid;
  align-items: center;
  justify-content: center;
  grid-template-columns: 1fr;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${e=>{let{theme:t}=e;return 27*t.gridUnit}}px;

  & button.superset-button {
    margin-left: 0;
  }
  & input {
    width: 100%;
  }
`,oc=y.iK.div`
  ${e=>{let{theme:t,"data-selected":n,onClick:r}=e;return`\n    display: grid;\n    align-items: center;\n    justify-content: center;\n    grid-template-columns: 1fr;\n    grid-gap: ${t.gridUnit}px;\n    border-bottom: 1px solid ${t.colors.grayscale.light2};\n    padding: ${2*t.gridUnit}px ${4*t.gridUnit}px;\n    cursor: ${r?"pointer":"auto"};\n    background: ${n?t.colors.primary.light5:"transparent"};\n  `}}
`,ac=(0,c.t)("New filter set"),sc=e=>{let{dataMaskSelected:t,onEditFilterSet:n,disabled:r,onFilterSelectionChange:o,tab:a}=e;const l=(0,i.I0)(),[d,c]=(0,s.useState)(ac),[u,h]=(0,s.useState)(!1),p=$d(),f=jd(),m=Object.values(f),g=qd(),v=Object.values(g),[b,y]=(0,s.useState)(null);(0,s.useEffect)((()=>{var e;if(a===Rd.AllFilters)return;if(!m.length)return void y(null);const n=Zs({dataMaskSelected:t,filterSetFilterValues:m});y(null!=(e=null==n?void 0:n.id)?e:null)}),[a,t,m]);const S=(e,t)=>{var n,r,i;return!v.find((t=>(null==t?void 0:t.id)===e))||!(0,Jr.JB)(null==(n=g[e])?void 0:n.controlValues,null==t||null==(r=t.nativeFilters)||null==(i=r[e])?void 0:i.controlValues,{ignoreUndefined:!0})},x=(e,t)=>{var n;const r=null==t?void 0:t.target;if(r){var i;const e=r.closest(`[data-anchor=${wu("filter-set-wrapper",!0)}]`);if(null!=e&&null!=(i=e.querySelector(".ant-collapse-header"))&&i.contains(r)||null!=r&&r.closest(".ant-dropdown"))return}if(y(e),!e)return;const a=f[e];(null!=(n=Object.values(null==a?void 0:a.dataMask))?n:[]).forEach((e=>{const{extraFormData:t,filterState:n,id:r}=e;S(r,a)||o({id:r},{extraFormData:t,filterState:n})}))};return(0,C.tZ)(ic,null,!b&&(0,C.tZ)(oc,null,(0,C.tZ)(rc,{dataMaskSelected:t,editMode:u,setFilterSetName:c,filterSetName:d}),(0,C.tZ)(Ld,{filterSetName:d.trim(),disabled:r,onCancel:()=>{h(!1),c(ac)},editMode:u,onEdit:()=>h(!0),onCreate:()=>{const e={name:d.trim(),nativeFilters:g,dataMask:Object.keys(g).reduce(((e,t)=>({...e,[t]:p[t]})),{})};l((0,Id.xQ)(e)),h(!1),c(ac)}})),m.map((e=>(0,C.tZ)(oc,ee()({},wu("filter-set-wrapper"),{"data-anchor":wu("filter-set-wrapper",!0),"data-selected":e.id===b,onClick:t=>x(e.id,t),key:e.id}),(0,C.tZ)(rc,{isApplied:e.id===b&&!r,onDelete:()=>{return t=e.id,l((0,Id.$l)(t)),void(t===b&&y(null));var t},onEdit:()=>{return t=e.id,x(t),void n(t);var t},onRebuild:()=>(e=>{var t;const n=f[e],r=Object.values(null!=(t=null==n?void 0:n.dataMask)?t:{}).filter((e=>{const{id:t}=e;return!S(t,n)})).reduce(((e,t)=>({...e,[t.id]:g[t.id]})),{}),i={...n,nativeFilters:r,dataMask:Object.keys(r).reduce(((e,t)=>{var r;return{...e,[t]:null==(r=n.dataMask)?void 0:r[t]}}),{})};l((0,Id.ql)(i))})(e.id),dataMaskSelected:t,filterSet:e})))))};var lc=n(81788);const dc={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};var cc=function(e,t){return s.createElement(rs.Z,Object.assign({},e,{ref:t,icon:dc}))};cc.displayName="WarningOutlined";const uc=s.forwardRef(cc),hc=y.iK.div`
  display: grid;
  grid-template-columns: 1fr;
  align-items: flex-start;
  justify-content: flex-start;
  grid-gap: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  background: ${e=>{let{theme:t}=e;return t.colors.primary.light4}};
  padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,pc=(0,y.iK)(B.ZT.Text)`
  color: ${e=>{let{theme:t}=e;return t.colors.primary.dark2}};
`,fc=(0,y.iK)(B.ZT.Text)`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  & .anticon {
    padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,mc=y.iK.div`
  display: flex;
  & button {
    ${e=>{let{disabled:t}=e;return"pointer-events: "+(t?"none":"all")}};
    flex: 1;
  }
`,gc=e=>{let{filterSetId:t,onCancel:n,dataMaskSelected:r,disabled:o}=e;const a=$d(),l=(0,i.I0)(),d=jd(),u=qd(),h=Object.values(d),[p,f]=(0,s.useState)(d[t].name),m=zd(p,d[t].name),g=(0,s.useMemo)((()=>Zs({dataMaskSelected:r,filterSetFilterValues:h})),[r,h]),v=g&&g.id!==t,b=o||v||m;return(0,C.tZ)(hc,null,(0,C.tZ)(pc,{strong:!0},(0,c.t)("Editing filter set:")),(0,C.tZ)(pc,{editable:{editing:!0,icon:(0,C.tZ)("span",null),onChange:f}},p),(0,C.tZ)(Ud,null,(0,C.tZ)(H.Z,{ghost:!0,buttonStyle:"tertiary",buttonSize:"small",onClick:n},(0,c.t)("Cancel")),(0,C.tZ)(B._e,{placement:"right",title:m&&(0,c.t)("Filter set with this name already exists")||v&&(0,c.t)("Filter set already exists")||o&&ws},(0,C.tZ)(mc,{disabled:b},(0,C.tZ)(H.Z,ee()({disabled:b,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:()=>{l((0,Id.ql)({id:t,name:p,nativeFilters:u,dataMask:{...a}})),n()}},wu("filter-set-edit-save")),(0,c.t)("Save"))))),v&&(0,C.tZ)(fc,{mark:!0},(0,C.tZ)(uc,null),(0,c.t)('This filter set is identical to: "%s"',null==g?void 0:g.name)))},vc=(0,y.iK)(H.Z)`
  padding: 0;
`,bc=e=>{let{createNewOnOpen:t,dashboardId:n,children:r}=e;const o=(0,i.I0)(),[a,l]=(0,s.useState)(!1);function d(){l(!1)}return(0,C.tZ)(s.Fragment,null,(0,C.tZ)(vc,ee()({},wu("create-filter"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>l(!0)}),r),(0,C.tZ)(Ia,{isOpen:a,onSave:async function(e){o(await(0,Id.RY)(e)),d()},onCancel:d,createNewOnOpen:t,key:`filters-for-${n}`}))},yc=y.iK.h4`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin: 0;
  padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;

  & > span {
    flex-grow: 1;
  }
`,Cc=(0,y.iK)(H.Z)`
  padding: 0;
`,Sc=y.iK.div`
  padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px
    ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,xc=y.iK.div`
  ${e=>{let{theme:t}=e;return C.iv`
    margin-top: ${2*t.gridUnit}px;

    & button > [role='img']:first-of-type {
      margin-right: ${t.gridUnit}px;
      line-height: 0;
    }

    span[role='img'] {
      padding-bottom: 1px;
    }

    .ant-btn > .anticon + span {
      margin-left: 0;
    }
  `}}
`,wc=e=>{let{toggleFiltersBar:t}=e;const n=(0,y.Fg)(),r=qd(),o=Object.values(r),a=(0,i.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),s=(0,i.v9)((e=>{let{dashboardInfo:t}=e;return t.id}));return(0,C.tZ)(Sc,null,(0,C.tZ)(yc,null,(0,C.tZ)("span",null,(0,c.t)("Filters")),(0,C.tZ)(Cc,ee()({},wu("collapse-button"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>t(!1)}),(0,C.tZ)(G.Z.Expand,{iconColor:n.colors.grayscale.base}))),a&&(0,C.tZ)(xc,null,(0,C.tZ)(bc,{dashboardId:s,createNewOnOpen:0===o.length},(0,C.tZ)(G.Z.PlusSmall,null)," ",(0,c.t)("Add/Edit Filters"))))};var kc,Zc=n(90731),Rc=(kc=function(e,t){return kc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},kc(e,t)},function(e,t){function n(){this.constructor=e}kc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Tc="html",Fc="svg",Dc=function(e){var t,n,r,i={};if(e===Tc)r=document.createElement("div");else{if(e!==Fc)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');r=document.createElementNS("http://www.w3.org/2000/svg","g")}var o={element:r,elementType:e,setPortalProps:function(e){i=e},getInitialPortalProps:function(){return i},mount:function(r,i){if(i!==n){if(o.unmount(),r!==t&&!function(e,t){if(t===Tc)return e instanceof HTMLElement;if(t===Fc)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(r,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+r.tagName+">.");r.replaceChild(o.element,i),t=r,n=i}},unmount:function(e){e&&e!==n||t&&n&&(t.replaceChild(n,o.element),t=void 0,n=void 0)}};return o},_c=function(e){function t(t){var n=e.call(this,t)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(e){n.setState({nodeProps:e})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return Rc(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,r=t.node;return Zc.createPortal(s.Children.map(n,(function(t){return s.isValidElement(t)?s.cloneElement(t,e.state.nodeProps):t})),r.element)},t}(s.PureComponent),Ec=function(e){function t(t){var n=e.call(this,t)||this;return n.placeholderNode=s.createRef(),n.passPropsThroughPortal(),n}return Rc(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return s.createElement("div",{ref:this.placeholderNode})},t}(s.PureComponent),Ic=Dc.bind(null,Tc),Mc=(Dc.bind(null,Fc),n(28368)),Oc=n.n(Mc);const Pc=Z()(((e,t)=>{e(t?(0,Id.$7)(t):(0,Id.Up)())}),300),Nc=y.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,jc=[{data:[{}]}],qc=[ri.cg.NATIVE_FILTER],$c=e=>{var t,n,r;let{dataMaskSelected:o,filter:a,directPathToChild:l,onFilterSelectionChange:d,inView:h=!0,showOverflow:f,parentRef:m,setFilterActive:g}=e;const{id:v,targets:b,filterType:y,adhoc_filters:S,time_range:x}=a,w=(0,ni.Z)().get(y),k=function(e,t){const n=(0,i.v9)((t=>{var n;return null==(n=t.nativeFilters.filters[e])?void 0:n.cascadeParentIds}));return(0,s.useMemo)((()=>{let e={};return(0,Ci.Z)(n).forEach((n=>{const r=null==t?void 0:t[n];e=(0,xo.on)(e,null==r?void 0:r.extraFormData)})),e}),[t,n])}(v,o),Z=(()=>{const e=(0,i.v9)((e=>e.dashboardState.isRefreshing)),t=(0,i.v9)((e=>e.dashboardState.isFiltersRefreshing));return!e&&t})(),[R,T]=(0,s.useState)([]),[F,D]=(0,s.useState)(""),[_,E]=(0,s.useState)({inView:!1}),[I,M]=(0,s.useState)({}),[O,P]=(0,s.useState)(h),N=(0,s.useRef)(null),[j]=b,{datasetId:q,column:$={}}=j,{name:z}=$,A=!!q,[U,L]=(0,s.useState)(A),[V,K]=(0,s.useState)(!1),W=(0,i.I0)(),B=(0,s.useCallback)((()=>{K(!1),L(!1),Z&&W((0,Gt.YC)())}),[W,Z]);(0,s.useEffect)((()=>{!O&&h&&P(!0)}),[h,O,P]),(0,s.useEffect)((()=>{var e;if(!O)return;const t=(0,xo.zi)({...a,datasetId:q,dependencies:k,groupby:z,adhoc_filters:S,time_range:x}),n=(null==(e=a.dataMask)?void 0:e.ownState)||{};if(!V&&(!Oc()(_,t,((e,t,n)=>"url_params"===n||void 0))||!Br()(I,n)||Z)){if(E(t),M(n),!A)return;K(!0),(0,Vr.getChartDataRequest)({formData:t,force:!1,requestParams:{dashboardId:0},ownState:n}).then((e=>{let{response:t,json:n}=e;if((0,gt.cr)(u.T.GLOBAL_ASYNC_QUERIES)){const e="result"in n?n.result[0]:n;if(200===t.status)T([e]),B();else{if(202!==t.status)throw new Error(`Received unexpected response status (${t.status}) while fetching chart data`);(0,yo.YJ)(e).then((e=>{T(e),B()})).catch((e=>{D(e.message||e.error||(0,c.t)("Check configuration")),B()}))}}else T(n.result),D(""),B()})).catch((e=>{D(e.statusText),B()}))}}),[O,k,q,z,B,JSON.stringify(a),A,V,Z]),(0,s.useEffect)((()=>{var e;(null==l?void 0:l[0])===a.id&&(null==N||null==(e=N.current)||e.focus())}),[N,l,a.id]);const H=(0,s.useCallback)((e=>d(a,e)),[a,d]),G=(0,s.useCallback)((()=>Pc(W,v)),[W,v]),Y=(0,s.useCallback)((()=>Pc(W)),[W]),J=(0,s.useMemo)((()=>({setDataMask:H,setFocusedFilter:G,unsetFocusedFilter:Y,setFilterActive:g})),[H,g,G,Y]),Q=Ed(a,null==(t=a.dataMask)?void 0:t.filterState),X=(0,s.useMemo)((()=>{var e;return{...null==(e=a.dataMask)?void 0:e.filterState,validateStatus:Q&&"error"}}),[null==(n=a.dataMask)?void 0:n.filterState,Q]);return F?(0,C.tZ)(go,{title:(0,c.t)("Cannot load filter"),body:F,level:"error"}):(0,C.tZ)(Nc,null,U?(0,C.tZ)(p.Z,{position:"inline-centered"}):(0,C.tZ)(jo.Z,{height:32,width:"100%",showOverflow:f,formData:_,parentRef:m,inputRef:N,queriesData:A?R:jc,chartType:y,behaviors:qc,filterState:X,ownState:null==(r=a.dataMask)?void 0:r.ownState,enableNoResults:null==w?void 0:w.enableNoResults,isRefreshing:V,hooks:J}))},zc=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.text)||(null==e||null==(n=e.meta)?void 0:n.defaultText)||""},Ac=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.sliceNameOverride)||(null==e||null==(n=e.meta)?void 0:n.sliceName)||(null==e?void 0:e.id)||""},Uc=y.iK.div`
  ${e=>{let{theme:t}=e;return C.iv`
    display: flex;
    align-items: center;
    margin: ${t.gridUnit}px 0;
    font-size: ${t.typography.sizes.s}px;

    &:first-of-type {
      margin-top: 0;
    }

    &:last-of-type {
      margin-bottom: 0;
    }

    & .ant-tooltip-open {
      display: inline-flex;
    }
  `}};
`,Lc=y.iK.span`
  ${e=>{let{theme:t}=e;return C.iv`
    color: ${t.colors.grayscale.base};
    padding-right: ${4*t.gridUnit}px;
    margin-right: auto;
    text-transform: uppercase;
    white-space: nowrap;
  `}};
`,Vc=y.iK.div`
  ${e=>{let{theme:t}=e;return C.iv`
    color: ${t.colors.grayscale.dark1};
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline;
  `}};
`,Kc=y.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,Wc=y.iK.span`
  text-decoration: underline;
  cursor: pointer;
`,Bc=y.iK.span`
  ${e=>{let{theme:t}=e;return C.iv`
    color: ${t.colors.primary.base};
  `}}
`,Hc=y.iK.ul`
  ${e=>{let{theme:t}=e;return C.iv`
    padding-left: ${3*t.gridUnit}px;
    margin-bottom: 0;
  `}};
`,Gc=y.iK.span`
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
`,Yc=y.iK.div`
  min-width: 0;
  display: inline-flex;
  white-space: nowrap;
`,Jc=e=>{var t,n;const[r,i]=(0,s.useState)(0),[o,a]=(0,s.useState)(!1),l=(0,s.useRef)({scrollWidth:0,parentElementWidth:0});return(0,s.useLayoutEffect)((()=>{var t;const n=e.current;if(!n)return;const{scrollWidth:r,clientWidth:o,childNodes:s}=n,d=l.current,c=(null==(t=n.parentElement)?void 0:t.clientWidth)||0;if(l.current={scrollWidth:r,parentElementWidth:c},d.parentElementWidth!==c||d.scrollWidth!==r)if(r>o){const e=o-6,t=s.length;let n=0,r=0;for(;n<e;)n+=s[r].offsetWidth,r+=1;r===t?(i(1),a(!1)):(i(t-r),a(!0))}else i(0)}),[null==(t=e.current)?void 0:t.offsetWidth,null==(n=e.current)?void 0:n.clientWidth,e]),[r,o]},Qc=e=>{let{title:t,children:n,...r}=e;return(0,C.tZ)(ne.u,ee()({title:t,placement:"bottom",overlayClassName:"filter-card-tooltip"},r),(0,C.tZ)(Yc,null,n))},Xc=(e,t)=>Array.isArray(e)&&e.length>0?(0,C.tZ)(s.Fragment,null,(0,C.tZ)(Gc,null,t,":"),(0,C.tZ)(Hc,null,e.map((e=>(0,C.tZ)("li",null,e))))):null,eu=s.memo((e=>{let{filter:t}=e;const n=(e=>{const t=(0,i.v9)((e=>e.dashboardLayout.present)),n=(()=>{const e=(0,i.v9)((e=>e.charts));return(0,s.useMemo)((()=>Object.values(e)),[e])})();return(0,s.useMemo)((()=>{let r;const i=t[Y._4].children[0];if(i.startsWith("TABS-")&&(r=t[i].children),0===e.scope.rootPath.length)return;if(0===e.scope.excluded.length&&(e.scope.rootPath[0]===Y._4||r&&r.every((t=>{var n;return a()(n=e.scope.rootPath).call(n,t)}))))return{all:[(0,c.t)("All charts")]};if(0===e.scope.excluded.length&&r)return{tabs:e.scope.rootPath.map((e=>zc(t[e]))).filter(Boolean)};const o=Object.values(t).filter((e=>e.type===f.dW));if(e.scope.rootPath[0]===Y._4)return{charts:n.filter((t=>{var n;return!a()(n=e.scope.excluded).call(n,t.id)})).map((e=>{const t=o.find((t=>t.meta.chartId===e.id));return Ac(t)})).filter(Boolean)};if(r){const r=[...e.scope.rootPath],i=o.filter((e=>e.parents.some((e=>a()(r).call(r,e)))));e.scope.excluded.forEach((e=>{const t=r.findIndex((t=>{var n,r;return null==(n=i.find((t=>t.meta.chartId===e)))?void 0:a()(r=n.parents).call(r,t)}));t>-1&&r.splice(t,1)}));const s=n.filter((t=>{var n;return!a()(n=e.scope.excluded).call(n,t.id)})).reduce(((e,t)=>{const n=i.find((e=>e.meta.chartId===t.id&&e.parents.every((e=>!a()(r).call(r,e)))));return n&&e.push(n),e}),[]);return{tabs:r.map((e=>zc(t[e]))).filter(Boolean),charts:s.map(Ac).filter(Boolean)}}}),[n,e.scope.excluded,e.scope.rootPath,t])})(t),r=(0,s.useRef)(null),[o,l]=Jc(r),d=(0,s.useMemo)((()=>0!==o&&n?n.all?(0,C.tZ)("span",null,(0,c.t)("All charts")):(0,C.tZ)("div",null,Xc(n.tabs,(0,c.t)("Tabs")),Xc(n.charts,(0,c.t)("Charts"))):null),[o,n]);return(0,C.tZ)(Uc,null,(0,C.tZ)(Lc,null,(0,c.t)("Scope")),(0,C.tZ)(Qc,{title:d},(0,C.tZ)(Vc,{ref:r},n?Object.values(n).flat().map(((e,t)=>(0,C.tZ)("span",null,0===t?e:`, ${e}`))):(0,c.t)("None")),l>0&&(0,C.tZ)(Bc,null,"+",o)))})),tu=e=>{let{dependency:t,hasSeparator:n}=e;const r=(0,i.I0)(),o=(0,s.useCallback)((()=>{r((0,Gt.E2)([t.id]))}),[t.id,r]);return(0,C.tZ)("span",null,n&&(0,C.tZ)("span",null,", "),(0,C.tZ)(Wc,{role:"button",onClick:o,tabIndex:0},t.name))},nu=s.memo((e=>{let{filter:t}=e;const n=(e=>{const t=(0,Ci.Z)(e.cascadeParentIds);return(0,i.v9)((e=>0===t.length?[]:t.reduce(((t,n)=>(t.push(e.nativeFilters.filters[n]),t)),[])))})(t),r=(0,s.useRef)(null),[o,a]=Jc(r),l=(0,y.Fg)(),d=(0,s.useMemo)((()=>o>0&&n?(0,C.tZ)(Hc,null,n.map((e=>(0,C.tZ)("li",null,(0,C.tZ)(tu,{dependency:e}))))):null),[o,n]);return Array.isArray(n)&&0!==n.length?(0,C.tZ)(Uc,null,(0,C.tZ)(Lc,{css:C.iv`
          display: inline-flex;
          align-items: center;
        `},(0,c.t)("Dependent on")," ",(0,C.tZ)(Qc,{title:(0,c.t)("Filter only displays values relevant to selections made in other filters.")},(0,C.tZ)(G.Z.Info,{iconSize:"m",iconColor:l.colors.grayscale.light1,css:C.iv`
              margin-left: ${l.gridUnit}px;
            `}))),(0,C.tZ)(Qc,{title:d},(0,C.tZ)(Vc,{ref:r},n.map(((e,t)=>(0,C.tZ)(tu,{dependency:e,hasSeparator:0!==t})))),a&&(0,C.tZ)(Bc,null,"+",o))):null})),ru=e=>{let{filter:t}=e;const n=(0,s.useRef)(null),[r]=Jc(n);return(0,C.tZ)(Uc,{css:e=>C.iv`
          margin-bottom: ${3*e.gridUnit}px;
        `},(0,C.tZ)(G.Z.FilterSmall,{css:e=>C.iv`
            margin-right: ${e.gridUnit}px;
          `}),(0,C.tZ)(Qc,{title:r?t.name:null},(0,C.tZ)(Kc,{ref:n},t.name)))},iu=e=>{let{filter:t}=e;const n=(0,s.useMemo)((()=>(0,ni.Z)().get(t.filterType)),[t.filterType]);return(0,C.tZ)(Uc,null,(0,C.tZ)(Lc,null,(0,c.t)("Filter type")),(0,C.tZ)(Vc,null,null==n?void 0:n.name))},ou=e=>{let{filter:t}=e;return(0,C.tZ)("div",null,(0,C.tZ)(ru,{filter:t}),(0,C.tZ)(iu,{filter:t}),(0,C.tZ)(eu,{filter:t}),(0,C.tZ)(nu,{filter:t}))},au=e=>{let{children:t,filter:n,getPopupContainer:r,isVisible:i=!0}=e;const[o,a]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{i||a(!1)}),[i]),(0,C.tZ)(hs.ZP,{placement:"right",overlayClassName:"filter-card-popover",mouseEnterDelay:.2,mouseLeaveDelay:.2,onVisibleChange:e=>{a(i&&e)},visible:i&&o,content:(0,C.tZ)(ou,{filter:n}),getPopupContainer:null!=r?r:()=>document.body,destroyTooltipOnHide:!0},t)},su=y.iK.div`
  position: absolute;
  right: 0;
`,lu=y.iK.h4`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.dark1}};
  margin: 0;
  overflow-wrap: break-word;
`,du=y.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,cu=(0,y.iK)(Pt.l0)`
  width: 100%;
  && .ant-form-item-label > label {
    text-transform: none;
    width: 100%;
    padding-right: ${e=>{let{theme:t}=e;return 11*t.gridUnit}}px;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,uu=(0,y.iK)(Pt.xJ)`
  .ant-form-item-label {
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }
  }
`,hu=y.iK.div`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.m}}px;
  display: flex;
`,pu=()=>(0,C.tZ)("span",{css:e=>({color:e.colors.error.base,fontSize:`${e.typography.sizes.s}px`,paddingLeft:"1px"})},"*"),fu=e=>{let{description:t}=e;return(0,C.tZ)(hu,null,(0,C.tZ)(ne.u,{title:t,placement:"right",overlayInnerStyle:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:20,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"}},(0,C.tZ)("i",{className:"fa fa-info-circle text-muted",css:e=>({paddingLeft:`${e.gridUnit}px`,cursor:"pointer"})})))},mu=e=>{var t,n,r;let{dataMaskSelected:i,filter:o,icon:a,onFilterSelectionChange:l,directPathToChild:d,inView:c,showOverflow:u,parentRef:h}=e;const[p,f]=(0,s.useState)(!1),{name:m="<undefined>"}=o,g=Ed(o,null==(t=o.dataMask)?void 0:t.filterState),v=!(null==(n=o.controlValues)||!n.enableEmptyFilter),b=(0,s.useMemo)((()=>(0,C.tZ)(du,null,(0,C.tZ)(lu,null,m),v&&(0,C.tZ)(pu,null),o.description&&o.description.trim()&&(0,C.tZ)(fu,{description:o.description}),(0,C.tZ)(su,null,a))),[m,v,o.description,a]),y=(0,s.useContext)(Mu);return(0,C.tZ)(cu,{layout:"vertical"},(0,C.tZ)(au,{filter:o,isVisible:!p&&!y},(0,C.tZ)("div",null,(0,C.tZ)(uu,{label:b,required:null==o||null==(r=o.controlValues)?void 0:r.enableEmptyFilter,validateStatus:g?"error":void 0},(0,C.tZ)($c,{dataMaskSelected:i,filter:o,showOverflow:u,directPathToChild:d,onFilterSelectionChange:l,inView:c,parentRef:h,setFilterActive:f})))))},gu=s.memo(mu),vu=y.iK.div`
  padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${e=>{let{theme:t}=e;return 27*t.gridUnit}}px;
`,bu=e=>{let{directPathToChild:t,dataMaskSelected:n,onFilterSelectionChange:r}=e;const o=qd(),l=(0,s.useMemo)((()=>Object.values(o)),[o]),d=(0,s.useMemo)((()=>{const e=new Array(l.length);for(let t=0;t<l.length;t+=1)e[t]=Ic();return e}),[l.length]),u=(0,s.useMemo)((()=>l.map((e=>({...e,dataMask:n[e.id]})))),[l,n]),h=new Set(u.map((e=>e.id))),[p,m]=function(e){const t=$i(),n=function(){const e=(0,i.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs})),t=function(){const e=qi();return t=>{const n=Object.values(e).find((e=>{var n;return(null==(n=e.meta)?void 0:n.chartId)===t}));return null==n?void 0:n.parents.filter((t=>e[t].type===f.gn))}}();return n=>{var r;return(0,Pi.nY)(n)||"chartsInScope"in n&&(null==(r=n.chartsInScope)?void 0:r.some((n=>{const r=t(n);return 0===(null==r?void 0:r.length)||(null==r?void 0:r.every((t=>a()(e).call(e,t))))})))}}();return(0,s.useMemo)((()=>{let r=[];const i=[];return t?e.forEach((e=>{n(e)?r.push(e):i.push(e)})):r=e,[r,i]}),[e,t,n])}(u),g=$i()&&u.length>0,v=(0,s.useCallback)((e=>{const i=u[e];return(0,Pi.nY)(i)?(0,C.tZ)("div",null,(0,C.tZ)("h3",null,i.title),(0,C.tZ)("p",null,i.description)):(0,C.tZ)(gu,{dataMaskSelected:n,filter:i,directPathToChild:t,onFilterSelectionChange:r,inView:!1})}),[u,JSON.stringify(n),t,r]);return(0,C.tZ)(vu,null,d.filter(((e,t)=>h.has(l[t].id))).map(((e,t)=>(0,C.tZ)(_c,{node:e},v(t)))),p.map((e=>{const t=l.findIndex((t=>t.id===e.id));return(0,C.tZ)(Ec,{node:d[t],inView:!0})})),g&&(0,C.tZ)(B.Ol,{ghost:!0,bordered:!0,expandIconPosition:"right",collapsible:0===m.length?"disabled":void 0,css:e=>(0,C.iv)("&.ant-collapse{margin-top:",p.length>0?6*e.gridUnit:0,"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:",2*e.gridUnit,"px;&>.ant-collapse-arrow{right:",e.gridUnit,"px;}}& .ant-collapse-content-box{padding:",4*e.gridUnit,"px 0 0;}}}","")},(0,C.tZ)(B.Ol.Panel,{header:(0,c.t)("Filters out of scope (%d)",m.length),key:"1"},m.map((e=>{const t=u.findIndex((t=>t.id===e.id));return(0,C.tZ)(Ec,{node:d[t],inView:!0})})))))},yu=s.memo(bu);var Cu=n(49484);const Su=y.iK.div`
  ${e=>{let{theme:t,width:n}=e;return C.iv`
    display: flex;
    flex-direction: column;
    align-items: center;

    position: fixed;
    z-index: 100;

    // filter bar width minus 1px for border
    width: ${n-1}px;
    bottom: 0;

    padding: ${4*t.gridUnit}px;
    padding-top: ${6*t.gridUnit}px;

    background: linear-gradient(
      ${(0,Cu.rgba)(t.colors.grayscale.light5,0)},
      ${t.colors.grayscale.light5} ${t.opacity.mediumLight}
    );

    pointer-events: none;

    & > button {
      pointer-events: auto;
    }

    & > .filter-apply-button {
      margin-bottom: ${3*t.gridUnit}px;
    }

    && > .filter-clear-all-button {
      color: ${t.colors.grayscale.base};
      margin-left: 0;
      &:hover {
        color: ${t.colors.primary.dark1};
      }

      &[disabled],
      &[disabled]:hover {
        color: ${t.colors.grayscale.light1};
      }
    }
  `}};
`,xu=e=>{let{width:t=nl.I6,onApply:n,onClearAll:r,dataMaskApplied:i,dataMaskSelected:o,isApplyDisabled:a}=e;const l=(0,s.useMemo)((()=>Object.values(i).some((e=>{var t,n,r;return!(0,Oa.Rw)(null==(t=o[e.id])||null==(n=t.filterState)?void 0:n.value)||!o[e.id]&&!(0,Oa.Rw)(null==(r=e.filterState)?void 0:r.value)}))),[i,o]);return(0,C.tZ)(Su,{width:t},(0,C.tZ)(H.Z,ee()({disabled:a,buttonStyle:"primary",htmlType:"submit",className:"filter-apply-button",onClick:n},wu("apply-button")),(0,c.t)("Apply filters")),(0,C.tZ)(H.Z,ee()({disabled:!l,buttonStyle:"link",buttonSize:"small",className:"filter-clear-all-button",onClick:r},wu("clear-button")),(0,c.t)("Clear all")))},wu=(0,Oi.Q)("filter-bar"),ku=y.iK.div`
  width: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;

  & .ant-tabs-top > .ant-tabs-nav {
    margin: 0;
  }
  &.open {
    width: ${e=>{let{width:t}=e;return t}}px; // arbitrary...
  }
`,Zu=y.iK.div`
  & .ant-typography-edit-content {
    left: 0;
    margin-top: 0;
    width: 100%;
  }
  position: absolute;
  top: 0;
  left: 0;
  flex-direction: column;
  flex-grow: 1;
  width: ${e=>{let{width:t}=e;return t}}px;
  background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
  border-right: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  border-bottom: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  min-height: 100%;
  display: none;
  &.open {
    display: flex;
  }
`,Ru=y.iK.div`
  position: absolute;
  top: ${e=>{let{offset:t}=e;return t}}px;
  left: 0;
  height: 100%;
  width: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;
  padding-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  display: none;
  text-align: center;
  &.open {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }
  svg {
    cursor: pointer;
  }
`,Tu=(0,y.iK)(G.Z.Collapse)`
  color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  margin-bottom: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
`,Fu=(0,y.iK)(G.Z.Filter)`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,Du=(0,y.iK)(B.D6)`
  & .ant-tabs-nav-list {
    width: 100%;
  }
  & .ant-tabs-tab {
    display: flex;
    justify-content: center;
    margin: 0;
    flex: 1;
  }

  & > .ant-tabs-nav .ant-tabs-nav-operations {
    display: none;
  }
`,_u=y.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;
`,Eu=[xt.KD.nativeFilters.name,xt.KD.permalinkKey.name],Iu=Z()((async(e,t,n,r,i)=>{var o;const{location:s}=e,{search:l}=s,d=new URLSearchParams(l),c=new URLSearchParams;let u;d.forEach(((e,t)=>{a()(Eu).call(Eu,t)||c.append(t,e)}));const h=(0,Zt.eY)(xt.KD.nativeFiltersKey),p=JSON.stringify(r);u=n&&h&&await(0,lc.TZ)(t,p,h,i)?h:await(0,lc.u7)(t,p,i),u&&c.set(xt.KD.nativeFiltersKey.name,u),a()(o=window.location.pathname).call(o,"/superset/dashboard")&&(e.location.pathname=window.location.pathname,e.replace({search:c.toString()}))}),Mi.M),Mu=(0,s.createContext)(!1),Ou=e=>{let{filtersOpen:t,toggleFiltersBar:n,directPathToChild:r,width:o,height:a,offset:l}=e;const d=(0,Hr.k6)(),h=$d(),[f,m]=(0,s.useState)(null),[g,b]=(0,Td.x)(h),y=(0,i.I0)(),[S,x]=(0,s.useState)(0),w=(0,Dd.z)(),k=jd(),Z=Object.values(k),[R,T]=(0,s.useState)(Rd.AllFilters),F=qd(),D=(0,wa.D)(F),_=Object.values(F),E=_.filter(Pi.kI),I=(0,i.v9)((e=>{let{dashboardInfo:t}=e;return null==t?void 0:t.id})),M=(0,i.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),[O,P]=(0,s.useState)(!1),N=(0,s.useRef)(),j=(0,s.useCallback)(((e,t)=>{b((n=>{var r,i,o;void 0!==(null==(r=t.filterState)?void 0:r.value)&&void 0===(null==(i=g[e.id])||null==(o=i.filterState)?void 0:o.value)&&e.requiredFirst&&y((0,ut.eG)(e.id,t)),n[e.id]={...(0,Fd.H)(e.id),...t}}))}),[g,y,b]);(0,s.useEffect)((()=>{if(D){const e={};Object.values(F).forEach((t=>{const n=null==D?void 0:D[t.id];if(!n)return;const r=t.filterType,i=t.targets,o=t.defaultDataMask,a=null==n?void 0:n.filterType,s=null==n?void 0:n.targets,l=null==n?void 0:n.defaultDataMask,d=r!==a,c=!Br()(i,s),u=!Br()(o,l);(d||c||u)&&(e[t.id]=(0,Fd.H)(t.id))})),Jt()(e)||(b((t=>({...t,...e}))),Object.keys(e).forEach((e=>y((0,ut.ze)(e)))))}}),[JSON.stringify(F),JSON.stringify(D)]);const q=JSON.stringify(h);(0,s.useEffect)((()=>{b((()=>h))}),[q,b]),(0,s.useEffect)((()=>{Iu(d,I,S,h,w)}),[I,q,d,S,w]);const $=(0,s.useCallback)((()=>{const e=Object.keys(g);x(1),e.forEach((e=>{g[e]&&y((0,ut.eG)(e,g[e]))}))}),[g,y]),z=(0,s.useCallback)((()=>{Object.keys(g).forEach((e=>{g[e]&&(y((0,ut.ze)(e)),b((t=>{var n;void 0!==(null==(n=t[e].filterState)?void 0:n.value)&&(t[e].filterState.value=void 0)})))}))}),[g,y,b]),A=(0,s.useCallback)((()=>n(!0)),[n]),U=(0,s.useCallback)(ge()((()=>{clearTimeout(N.current),P(!0),N.current=setTimeout((()=>{P(!1)}),300)}),200),[]);(0,s.useEffect)((()=>(document.onscroll=U,()=>{document.onscroll=null})),[U]),((e,t)=>{const n=qd(),r=$d();(0,s.useEffect)((()=>{Object.keys(e).forEach((e=>{n[e]||t((t=>{delete t[e]}))}))}),[r,e,n,t])})(g,b);const L=((e,t,n)=>{const r=Object.values(e),i=Object.values(t);return(0,Jr.JB)(_d(e),_d(t),{ignoreUndefined:!0})||r.length!==i.length||n.some((t=>{var n;return Ed(t,null==e||null==(n=e[null==t?void 0:t.id])?void 0:n.filterState)}))})(g,h,E),V=(()=>{const[e,t]=(0,s.useState)(!1),n=qd(),r=(0,s.useContext)(Us.MigrationContext);let o=(0,i.v9)((e=>e.charts)),a=0;if(!e)if(r===Q.Qi.REVIEWING){o=Od()(Nd()(o,(e=>{var t;return"filter_box"!==(null==(t=e.form_data)?void 0:t.viz_type)})),"id");const e=document.querySelectorAll('[data-test-viz-type="filter_box"]').length;a=document.querySelectorAll('[data-ui-anchor="chart"]').length-e}else a=document.querySelectorAll('[data-ui-anchor="chart"]').length;return(0,s.useEffect)((()=>{if(e)return;if(Object.values(n).find((e=>{let{requiredFirst:t}=e;return t})))return void t(!0);let r;0===a&&(r=setTimeout((()=>{t(!0)}),1e3)),a>0&&void 0!==r&&clearTimeout(r);const i=Object.values(o).filter((e=>{let{chartStatus:t}=e;return"loading"!==t})).length;a>0&&i>=a&&t(!0)}),[o,e,a]),e})(),K=(0,s.useMemo)((()=>({overflow:"auto",height:a,overscrollBehavior:"contain"})),[a]),W=E.length;return(0,C.tZ)(Mu.Provider,{value:O},(0,C.tZ)(ku,ee()({},wu(),{className:v()({open:t}),width:o}),(0,C.tZ)(Ru,ee()({},wu("collapsable"),{className:v()({open:!t}),onClick:A,offset:l}),(0,C.tZ)(Tu,ee()({},wu("expand-button"),{iconSize:"l"})),(0,C.tZ)(Fu,ee()({},wu("filter-icon"),{iconSize:"l"}))),(0,C.tZ)(Zu,{className:v()({open:t}),width:o},(0,C.tZ)(wc,{toggleFiltersBar:n}),V?(0,gt.cr)(u.T.DASHBOARD_NATIVE_FILTERS_SET)?(0,C.tZ)(Du,{centered:!0,onChange:T,defaultActiveKey:Rd.AllFilters,activeKey:f?Rd.AllFilters:void 0},(0,C.tZ)(B.D6.TabPane,{tab:(0,c.t)("All filters (%(filterCount)d)",{filterCount:W}),key:Rd.AllFilters,css:K},f&&(0,C.tZ)(gc,{dataMaskSelected:g,disabled:!L,onCancel:()=>m(null),filterSetId:f}),0===_.length?(0,C.tZ)(_u,null,(0,C.tZ)(rd.Tc,{title:(0,c.t)("No filters are currently added"),image:"filter.svg",description:M&&(0,c.t)("Click the button above to add a filter to the dashboard")})):(0,C.tZ)(yu,{dataMaskSelected:g,directPathToChild:r,onFilterSelectionChange:j})),(0,C.tZ)(B.D6.TabPane,{disabled:!!f,tab:(0,c.t)("Filter sets (%(filterSetCount)d)",{filterSetCount:Z.length}),key:Rd.FilterSets,css:K},(0,C.tZ)(sc,{onEditFilterSet:m,disabled:!L,dataMaskSelected:g,tab:R,onFilterSelectionChange:j}))):(0,C.tZ)("div",{css:K,onScroll:U},0===_.length?(0,C.tZ)(_u,null,(0,C.tZ)(rd.Tc,{title:(0,c.t)("No filters are currently added"),image:"filter.svg",description:M&&(0,c.t)("Click the button above to add a filter to the dashboard")})):(0,C.tZ)(yu,{dataMaskSelected:g,directPathToChild:r,onFilterSelectionChange:j})):(0,C.tZ)("div",{css:(0,C.iv)({height:a},"","")},(0,C.tZ)(p.Z,null)),(0,C.tZ)(xu,{width:o,onApply:$,onClearAll:z,dataMaskSelected:g,dataMaskApplied:h,isApplyDisabled:L}))))},Pu=s.memo(Ou),Nu=e=>{const t=e[Y._4],n=null==t?void 0:t.children[0];return n===Y.PV?e[Y._4]:e[n]},ju=(e,t)=>"ant-tabs-nav-wrap"===e.target.className||t.contains(e.target);var qu=n(81545),$u=n(78718),zu=n.n($u);const Au={depth:d().number.isRequired,editMode:d().bool.isRequired,gridComponent:J.cP.isRequired,handleComponentDrop:d().func.isRequired,isComponentVisible:d().bool.isRequired,resizeComponent:d().func.isRequired,setDirectPathToChild:d().func.isRequired,width:d().number.isRequired,dashboardId:d().number},Uu=e=>e.dropIndicatorProps&&(0,C.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),Lu=e=>e.dropIndicatorProps&&(0,C.tZ)("div",{className:"drop-indicator drop-indicator--top"}),Vu=y.iK.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
`;class Ku extends s.PureComponent{constructor(e){super(e),this.state={isResizing:!1,rowGuideTop:null},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.getRowGuidePosition=this.getRowGuidePosition.bind(this),this.setGridRef=this.setGridRef.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}getRowGuidePosition(e){return e&&this.grid?e.getBoundingClientRect().bottom-this.grid.getBoundingClientRect().top-2:null}setGridRef(e){this.grid=e}handleResizeStart(e){let{ref:t,direction:n}=e,r=null;"bottom"!==n&&"bottomRight"!==n||(r=this.getRowGuidePosition(t)),this.setState((()=>({isResizing:!0,rowGuideTop:r})))}handleResize(e){let{ref:t,direction:n}=e;"bottom"!==n&&"bottomRight"!==n||this.setState((()=>({rowGuideTop:this.getRowGuidePosition(t)})))}handleResizeStop(e){let{id:t,widthMultiple:n,heightMultiple:r}=e;this.props.resizeComponent({id:t,width:n,height:r}),this.setState((()=>({isResizing:!1,rowGuideTop:null})))}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleChangeTab(e){let{pathToTabIndex:t}=e;this.props.setDirectPathToChild(t)}render(){var e,t,n;const{gridComponent:r,handleComponentDrop:i,depth:o,width:a,isComponentVisible:l,editMode:d,canEdit:u,setEditMode:h,dashboardId:p}=this.props,m=(a+Y.es)/Y.cz-Y.es,{isResizing:g,rowGuideTop:v}=this.state,b=0===(null==r||null==(e=r.children)?void 0:e.length),y=b&&r.type===f.gn,S=d&&(0,C.tZ)(rd.XJ,{title:(0,c.t)("Drag and drop components and charts to the dashboard"),description:(0,c.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,C.tZ)(s.Fragment,null,(0,C.tZ)("i",{className:"fa fa-plus"}),(0,c.t)("Create a new chart")),buttonAction:()=>{window.open(`/chart/add?dashboard_id=${p}`,"_blank","noopener noreferrer")},image:"chart.svg"}),x=d?(0,C.tZ)(rd.XJ,{title:(0,c.t)("Drag and drop components to this tab"),description:(0,c.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,C.tZ)(s.Fragment,null,(0,C.tZ)("i",{className:"fa fa-plus"}),(0,c.t)("Create a new chart")),buttonAction:()=>{window.open(`/chart/add?dashboard_id=${p}`,"_blank","noopener noreferrer")},image:"chart.svg"}):(0,C.tZ)(rd.XJ,{title:(0,c.t)("There are no components added to this tab"),description:u&&(0,c.t)("You can add the components in the edit mode."),buttonText:u&&(0,c.t)("Edit the dashboard"),buttonAction:u&&(()=>{h(!0)}),image:"chart.svg"});return a<100?null:(0,C.tZ)(s.Fragment,null,b&&(0,C.tZ)(Vu,null,y?x:S),(0,C.tZ)("div",{className:"dashboard-grid",ref:this.setGridRef},(0,C.tZ)("div",{className:"grid-content"},d&&(0,C.tZ)(je,{component:r,depth:o,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-droptarget",editMode:!0},Uu),null==r||null==(t=r.children)?void 0:t.map(((e,t)=>(0,C.tZ)(Zd,{key:e,id:e,parentId:r.id,depth:o+1,index:t,availableColumnCount:Y.cz,columnWidth:m,isComponentVisible:l,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,onChangeTab:this.handleChangeTab}))),d&&(null==r||null==(n=r.children)?void 0:n.length)>0&&(0,C.tZ)(je,{component:r,depth:o,parentComponent:null,index:r.children.length,orientation:"column",onDrop:i,className:"empty-droptarget",editMode:!0},Lu),g&&Array(Y.cz).fill(null).map(((e,t)=>(0,C.tZ)("div",{key:`grid-column-${t}`,className:"grid-column-guide",style:{left:t*Y.es+t*m,width:m}}))),g&&v&&(0,C.tZ)("div",{className:"grid-row-guide",style:{top:v,width:a}}))))}}Ku.propTypes=Au,Ku.defaultProps={};const Wu=Ku,Bu=(0,i.$j)((function(e){let{dashboardState:t,dashboardInfo:n}=e;return{editMode:t.editMode,canEdit:n.dash_edit_perm,dashboardId:n.id}}),(function(e){return(0,r.DE)({handleComponentDrop:Pr._p,resizeComponent:Pr.iO,setDirectPathToChild:Gt.E2,setEditMode:Gt.Mb},e)}))(Wu);var Hu=n(51127),Gu=n.n(Hu);const Yu=e=>{let{topLevelTabs:t}=e;const n=(()=>{const e=(0,i.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters}));return(0,s.useMemo)((()=>e?Object.values(e).map((e=>zu()(e,["id","scope","type"]))):[]),[JSON.stringify(e)])})(),r=(0,i.I0)(),o=(0,i.v9)((e=>e.dashboardLayout.present)),a=(0,i.v9)((e=>e.dashboardInfo)),l=(0,i.v9)((e=>e.dashboardState.directPathToChild)),d=(0,i.v9)((e=>e.charts)),c=(0,s.useMemo)((()=>{const e=pd({currentComponent:Nu(o),directPathToChild:l});return e>-1?e:((e,t)=>Math.max(0,pd({currentComponent:Nu(e),directPathToChild:t})))(o,l)}),[o,l]);(0,s.useEffect)((()=>{if(!(0,u.c)(u.T.DASHBOARD_NATIVE_FILTERS)||0===n.length)return;const e=n.map((e=>{if(e.id.startsWith(ka.Ky))return{filterId:e.id,tabsInScope:[],chartsInScope:[]};const t=(0,oi.Q)(e.scope,d,o),n=(0,xo.Rz)(o,t);return{filterId:e.id,tabsInScope:Array.from(n),chartsInScope:t}}));r((0,Id.xk)(e))}),[n,o,r]);const h=(0,s.useCallback)((()=>{const e=a.metadata;if(null!=e&&e.color_scheme){const n={...e},i=null==n?void 0:n.color_scheme,o=(null==n?void 0:n.color_scheme_domain)||[],s=(0,qu.Z)(),l=s.get(i,!0)||void 0,d=(null==l?void 0:l.colors)||[],c=s.defaultKey,u=!!l,h=()=>{Ct.Z.put({endpoint:`/api/v1/dashboard/${a.id}`,headers:{"Content-Type":"application/json"},body:JSON.stringify({json_metadata:Gu()(n)})}).catch((e=>console.log(e)))},p=e=>{r((0,Gt.uW)(e))},f=()=>{r((0,Or.a8)({metadata:n})),h()};if(u)u&&!o.length&&(n.color_scheme_domain=d,f()),u&&o.length&&d.toString()!==o.toString()&&(n.color_scheme_domain=d,n.shared_label_colors={},p(i),f());else{var t;const e=(null==c?void 0:c.toString())||"supersetColors";n.color_scheme=e,n.color_scheme_domain=(null==(t=s.get(c))?void 0:t.colors)||[],n.shared_label_colors={},p(e),f()}}}),[d]);(0,ai.d)(h);const p=t?t.children:[Y.PV],f=Math.min(c,p.length-1),m=0===f?Y.PV:f.toString();return(0,C.tZ)("div",{className:"grid-container"},(0,C.tZ)(_,null,(e=>{let{width:t}=e;return(0,C.tZ)(x.ZP,{id:Y.PV,activeKey:m,renderTabBar:()=>(0,C.tZ)(s.Fragment,null),fullWidth:!1,animated:!1,allowOverflow:!0},p.map(((e,n)=>(0,C.tZ)(x.ZP.TabPane,{key:0===n?Y.PV:n.toString()},(0,C.tZ)(Bu,{gridComponent:o[e],depth:Y.Mu+1,width:t,isComponentVisible:n===c})))))})))};var Ju=n(61337);const Qu=y.iK.div`
  display: grid;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  flex: 1;
  /* Special cases */

  /* A row within a column has inset hover menu */
  .dragdroppable-column .dragdroppable-row .hover-menu--left {
    left: -12px;
    background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
    border: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  }

  .dashboard-component-tabs {
    position: relative;
  }

  /* A column within a column or tabs has inset hover menu */
  .dragdroppable-column .dragdroppable-column .hover-menu--top,
  .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
    top: -12px;
    background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
    border: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  }

  /* move Tabs hover menu to top near actual Tabs */
  .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
    top: 0;
    transform: unset;
    background: transparent;
  }

  /* push Chart actions to upper right */
  .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
  .dragdroppable .dashboard-component-header .hover-menu--top {
    right: 8px;
    top: 8px;
    background: transparent;
    border: none;
    transform: unset;
    left: unset;
  }
  div:hover > .hover-menu-container .hover-menu,
  .hover-menu-container .hover-menu:hover {
    opacity: 1;
  }
`,Xu=y.iK.div`
  grid-column: 1;
  grid-row: 1 / span 2;
  z-index: 11;
  width: ${e=>{let{width:t}=e;return t}}px;
`,eh=y.iK.div`
  position: sticky;
  top: -1px;
  width: ${e=>{let{width:t}=e;return t}}px;
  flex: 0 0 ${e=>{let{width:t}=e;return t}}px;
`,th=y.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: sticky;
  top: 0;
  z-index: 100;
  max-width: 100vw;
`,nh=y.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${e=>{let{fullSizeChartId:t}=e;return t&&"z-index: 101;"}}
`,rh=y.iK.div`
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  height: auto;
  flex: 1;

  .grid-container .dashboard-component-tabs {
    box-shadow: none;
    padding-left: 0;
  }

  .grid-container {
    /* without this, the grid will not get smaller upon toggling the builder panel on */
    width: 0;
    flex: 1;
    position: relative;
    margin-top: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
    margin-right: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;
    margin-bottom: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
    margin-left: ${e=>{let{theme:t,dashboardFiltersOpen:n,editMode:r,nativeFiltersEnabled:i}=e;return n||r||!i?8*t.gridUnit:0}}px;

    ${e=>{let{editMode:t,theme:n}=e;return t&&`\n      max-width: calc(100% - ${nl.XX+16*n.gridUnit}px);\n    `}}
  }

  .dashboard-builder-sidepane {
    width: ${nl.XX}px;
    z-index: 1;
  }

  .dashboard-component-chart-holder {
    // transitionable traits to show filter relevance
    transition: opacity ${e=>{let{theme:t}=e;return t.transitionTiming}}s,
      border-color ${e=>{let{theme:t}=e;return t.transitionTiming}}s,
      box-shadow ${e=>{let{theme:t}=e;return t.transitionTiming}}s;
    border: 0 solid transparent;
  }
`,ih=y.iK.div`
  position: absolute;

  :hover .filterbar-resizer::after {
    background-color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }

  .filterbar-resizer {
    // @z-index-above-sticky-header (100) + 1 = 101
    z-index: 101;
  }

  .filterbar-resizer::after {
    display: block;
    content: '';
    width: 1px;
    height: 100%;
    margin: 0 auto;
  }
`,oh=()=>{var e,t;const r=(0,i.I0)(),o=(0,Xr.fG)(),l=(0,i.v9)((e=>{let{dashboardInfo:t}=e;return`${t.id}`})),d=(0,i.v9)((e=>e.dashboardLayout.present)),h=(0,i.v9)((e=>e.dashboardState.editMode)),f=(0,i.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),m=(0,i.v9)((e=>e.dashboardState.directPathToChild)),g=(0,i.v9)((e=>e.dashboardState.fullSizeChartId)),y=(0,s.useCallback)((e=>{let{pathToTabIndex:t}=e;r((0,Gt.E2)(t))}),[r]),x=(0,s.useCallback)((()=>{r((0,Pr.g3)());const e=fd(Nu(d),0);r((0,Gt.E2)(e))}),[d,r]),w=(0,s.useCallback)((e=>r((0,Pr._p)(e))),[r]),k=s.useRef(null),Z=d[Y._4],R=null==Z?void 0:Z.children[0],T=R!==Y.PV?d[R]:void 0,F=(0,Zt.eY)(xt.KD.standalone),D=F===Y._B.REPORT,_=o.hideTitle||F===Y._B.HIDE_NAV_AND_TITLE||D,[E,I]=(0,s.useState)(0);(0,s.useEffect)((()=>{var e,t;let r;return I((null==(e=k.current)||null==(t=e.getBoundingClientRect())?void 0:t.height)||0),void 0!==n.g.ResizeObserver&&k.current&&(r=new ResizeObserver((e=>{I((t=>{var n,r;return(null==e||null==(n=e[0])||null==(r=n.contentRect)?void 0:r.height)||t}))})),r.observe(k.current)),()=>{var e;null==(e=r)||e.disconnect()}}),[]);const{showDashboard:M,dashboardFiltersOpen:O,toggleDashboardFiltersOpen:P,nativeFiltersEnabled:N}=(()=>{const e=(0,s.useContext)(Us.MigrationContext),[t,n]=(0,s.useState)(!1),r=(0,i.v9)((e=>{var t,n;return(null==(t=(0,Zt.eY)(xt.KD.showFilters))||t)&&(null==(n=e.dashboardInfo.metadata)?void 0:n.show_native_filters)})),o=(0,i.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),l=qd(),d=Object.values(l),c=(0,Zt.eY)(xt.KD.expandFilters),[h,p]=(0,s.useState)(null!=c?c:!!d.length),f=r&&(0,gt.cr)(u.T.DASHBOARD_NATIVE_FILTERS)&&(o||!o&&0!==d.length),m=d.filter((e=>e.requiredFirst)),g=$d(),v=t||!f||!(f&&m.length&&m.find((e=>{var t,n;let{id:r}=e;return void 0===(null==(t=g[r])||null==(n=t.filterState)?void 0:n.value)}))),b=(0,s.useCallback)((e=>{p(null!=e?e:!h)}),[h]);return(0,s.useEffect)((()=>{var t;!1===c||0===d.length&&f&&a()(t=["CONVERTED","REVIEWING","NOOP"]).call(t,e)?b(!1):b(!0)}),[d.length,e]),(0,s.useEffect)((()=>{v&&n(!0)}),[v]),{showDashboard:v,dashboardFiltersOpen:h,toggleDashboardFiltersOpen:b,nativeFiltersEnabled:f}})(),[j,q]=function(e){const t=(0,s.useRef)(),[n,r]=(0,s.useState)(nl.I6);return(0,s.useEffect)((()=>{var n;t.current=null!=(n=t.current)?n:(0,Ju.rV)(Ju.dR.dashboard__custom_filter_bar_widths,{}),t.current[e]&&r(t.current[e])}),[e]),[n,function(n){r(n),(0,Ju.LS)(Ju.dR.dashboard__custom_filter_bar_widths,{...t.current,[e]:n})}]}(l),$=O?j:nl.gz,[z,A]=function(e){const t=(0,s.useRef)(null),[n,r]=(0,s.useState)(!1),i=e=>{const[t]=e;r(t.intersectionRatio<1)};return(0,s.useEffect)((()=>{const n=new IntersectionObserver(i,e),r=t.current;return r&&n.observe(r),()=>{r&&n.unobserve(r)}}),[t,e]),[t,n]}({threshold:[1]}),U=(0,gt.cr)(u.T.DASHBOARD_NATIVE_FILTERS_SET),L=`calc(100vh - ${nl.UN+(A||F?0:nl.Ky)+(U?nl.a7:0)}px)`,V=O?0:E+20,K=(0,s.useMemo)((()=>({marginLeft:O||h||!N?0:-32})),[O,h,N]),W=(0,s.useRef)(T);(0,s.useEffect)((()=>{var e,t,n;const i=null==(e=W.current)||null==(t=e.children)?void 0:t.length,o=null==T||null==(n=T.children)?void 0:n.length;if(void 0!==i&&void 0!==o&&o>i){const e=fd(Nu(d),o-1);r((0,Gt.E2)(e))}W.current=T}),[T]);const B=(0,s.useCallback)((e=>{let{dropIndicatorProps:t}=e;return(0,C.tZ)("div",null,!_&&(0,C.tZ)($r,null),t&&(0,C.tZ)("div",t),!D&&T&&!o.hideNav&&(0,C.tZ)(Il,{shouldFocus:ju,menuItems:[(0,C.tZ)(Ur,{icon:(0,C.tZ)(G.Z.FallOutlined,{iconSize:"xl"}),label:"Collapse tab content",onClick:x})],editMode:h},(0,C.tZ)(Zd,{id:null==T?void 0:T.id,parentId:Y._4,depth:Y.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:y})))}),[h,y,x,_,D,T,o.hideNav]);return(0,C.tZ)(Qu,null,N&&!h&&(0,C.tZ)(s.Fragment,null,(0,C.tZ)(ih,null,(0,C.tZ)(b.e,{enable:{right:O},handleClasses:{right:"filterbar-resizer"},size:{width:$,height:"100vh"},minWidth:nl.I6,maxWidth:nl.aF,onResizeStop:(e,t,n,r)=>q($+r.width)})),(0,C.tZ)(Xu,{width:$},(0,C.tZ)(eh,{ref:z,width:$},(0,C.tZ)(S.Z,null,(0,C.tZ)(Pu,{filtersOpen:O,toggleFiltersBar:P,directPathToChild:m,width:$,height:L,offset:V}))))),(0,C.tZ)(th,{ref:k},(0,C.tZ)(je,{component:Z,parentComponent:null,depth:Y.Mu,index:0,orientation:"column",onDrop:w,editMode:h,disableDragDrop:!!T,style:K},B)),(0,C.tZ)(nh,{fullSizeChartId:g},(0,C.tZ)(C.xB,{styles:C.iv`
            // @z-index-above-dashboard-header (100) + 1 = 101
            ${g&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
          `}),!h&&!T&&0===(null==(e=d[Y.PV])||null==(t=e.children)?void 0:t.length)&&(0,C.tZ)(rd.XJ,{title:(0,c.t)("There are no charts added to this dashboard"),description:f&&(0,c.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:f&&(0,c.t)("Edit the dashboard"),buttonAction:()=>r((0,Gt.Mb)(!0)),image:"dashboard.svg"}),(0,C.tZ)("div",{className:v()("dashboard",h&&"dashboard--editing")},(0,C.tZ)(rh,{className:"dashboard-content",dashboardFiltersOpen:O,editMode:h,nativeFiltersEnabled:N},M?(0,C.tZ)(Yu,{topLevelTabs:T}):(0,C.tZ)(p.Z,null),h&&(0,C.tZ)(ct,{isStandalone:!!F,topOffset:E})))))},ah=[f.dW,f.xh,f.t];function sh(e){return!Object.values(e).some((e=>{let{type:t}=e;return t&&a()(ah).call(ah,t)}))}const lh={actions:d().shape({addSliceToDashboard:d().func.isRequired,removeSliceFromDashboard:d().func.isRequired,triggerQuery:d().func.isRequired,logEvent:d().func.isRequired,clearDataMaskState:d().func.isRequired}).isRequired,dashboardInfo:J.$X.isRequired,dashboardState:J.DZ.isRequired,charts:d().objectOf(J.$6).isRequired,slices:d().objectOf(J.Rw).isRequired,activeFilters:d().object.isRequired,chartConfiguration:d().object.isRequired,datasources:d().object.isRequired,ownDataCharts:d().object.isRequired,layout:d().object.isRequired,impressionId:d().string.isRequired,initMessages:d().array,timeout:d().number,userId:d().string};class dh extends s.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",dh.unload):window.removeEventListener("beforeunload",dh.unload)}static unload(){const e=(0,c.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,n;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(n=e.ownDataCharts)?n:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=document.getElementById("app"),t=(null==e?void 0:e.getAttribute("data-bootstrap"))||"{}",{dashboardState:n,layout:r}=this.props,i={is_soft_navigation:vt.Yd.timeOriginOffset>0,is_edit_mode:n.editMode,mount_duration:vt.Yd.getTimestamp(),is_empty:sh(r),is_published:n.isPublished,bootstrap_data_length:t.length},o=(0,sl.Z)();o&&(i.target_id=o),this.props.actions.logEvent(vt.Wl,i),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:vt.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=m(this.props.layout),n=m(e.layout);this.props.dashboardInfo.id===e.dashboardInfo.id&&(t.length<n.length?n.filter((e=>-1===t.indexOf(e))).forEach((t=>{return this.props.actions.addSliceToDashboard(t,(n=e.layout,r=t,Object.values(n).find((e=>e&&e.type===f.dW&&e.meta&&e.meta.chartId===r))));var n,r})):t.length>n.length&&t.filter((e=>-1===n.indexOf(e))).forEach((e=>this.props.actions.removeSliceFromDashboard(e))))}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:n,appliedOwnDataCharts:r}=this,{activeFilters:i,ownDataCharts:o,chartConfiguration:a}=this.props;(0,u.c)(u.T.DASHBOARD_CROSS_FILTERS)&&!a||(t||(0,Jr.JB)(r,o,{ignoreUndefined:!0})&&(0,Jr.JB)(n,i,{ignoreUndefined:!0})||this.applyFilters(),e?dh.onBeforeUnload(!0):dh.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:vt.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(vt.Ev,{...this.visibilityEventData,duration:vt.Yd.getTimestamp()-e})}}getAllCharts(){return Object.values(this.props.charts)}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:n}=this.props,r=Object.keys(t),i=Object.keys(e),o=new Set(r.concat(i)),s=((e,t)=>{const n=Object.keys(e),r=Object.keys(t),i=(o=n,s=r,[...o.filter((e=>!a()(s).call(s,e))),...s.filter((e=>!a()(o).call(o,e)))]).filter((n=>e[n]||t[n]));var o,s;return new Set([...n,...r]).forEach((n=>{(0,Jr.JB)(e[n],t[n])||i.push(n)})),[...new Set(i)]})(n,this.appliedOwnDataCharts);[...o].forEach((n=>{if(!a()(r).call(r,n)&&a()(i).call(i,n))s.push(...e[n].scope);else if(a()(i).call(i,n)){if((0,Jr.JB)(e[n].values,t[n].values,{ignoreUndefined:!0})||s.push(...t[n].scope),!(0,Jr.JB)(e[n].scope,t[n].scope)){const r=(t[n].scope||[]).concat(e[n].scope||[]);s.push(...r)}}else s.push(...t[n].scope)})),this.refreshCharts([...new Set(s)]),this.appliedFilters=t,this.appliedOwnDataCharts=n}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){return this.context.loading?(0,C.tZ)(p.Z,null):(0,C.tZ)(s.Fragment,null,(0,C.tZ)(oh,null))}}dh.contextType=h.Zn,dh.propTypes=lh,dh.defaultProps={initMessages:[],timeout:60,userId:""};const ch=dh;var uh=n(50810),hh=n(87915);const ph=(0,i.$j)((function(e){var t,n,r,i,o;const{datasources:a,sliceEntities:s,charts:l,dataMask:d,dashboardInfo:c,dashboardState:u,dashboardLayout:h,impressionId:p,nativeFilters:f}=e;return{initMessages:null==(t=c.common)?void 0:t.flash_messages,timeout:null==(n=c.common)||null==(r=n.conf)?void 0:r.SUPERSET_WEBSERVER_TIMEOUT,userId:c.userId,dashboardInfo:c,dashboardState:u,charts:l,datasources:a,activeFilters:{...(0,bn.De)(),...(0,hh.g)({chartConfiguration:null==(i=c.metadata)?void 0:i.chart_configuration,nativeFilters:f.filters,dataMask:d,allSliceIds:u.sliceIds})},chartConfiguration:null==(o=c.metadata)?void 0:o.chart_configuration,ownDataCharts:(0,hh.U)(d,"ownState"),slices:s.slices,layout:h.present,impressionId:p}}),(function(e){return{actions:(0,r.DE)({setDatasources:uh.Fy,clearDataMaskState:ut.sh,addSliceToDashboard:Gt.Pi,removeSliceFromDashboard:Gt.rL,triggerQuery:Vr.triggerQuery,logEvent:jr.logEvent},e)}}))(ch)},90057:(e,t,n)=>{"use strict";n.d(t,{x:()=>o,C:()=>a});var r=n(18172),i=n(67294);function o(e){var t=(0,i.useState)((function(){return(0,r.vV)("function"==typeof e?e():e,!0)})),n=t[1];return[t[0],(0,i.useCallback)((function(e){n("function"==typeof e?(0,r.ZP)(e):(0,r.vV)(e))}),[])]}function a(e,t,n){var o=(0,i.useMemo)((function(){return(0,r.ZP)(e)}),[e]);return(0,i.useReducer)(o,t,n)}}}]);
//# sourceMappingURL=1c2cabebf09fa34ae42b.chunk.js.map